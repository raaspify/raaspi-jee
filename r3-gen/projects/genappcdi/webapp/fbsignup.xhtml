<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:fb="http://www.facebook.com/2008/fbml"
                template="layout/rtemplate.xhtml">
<!-- not used, replaced by socialLogin. Generated By gen-fbsignup.xhtml.ftl on 28-Jul-2023 8:03:49 PM
-->
<ui:define name="body">
    <h:messages globalOnly="true" styleClass="message"/>
   
 <h:form id="register">
     <p:remoteCommand immediate="true" name="onFbLogin" ajaxSingle="true" action="#{yxxxuh566xwwqqwxxxxxuserHome.onFbLogin()}"
              onclick="rc([{name: 'id', value: '#{yxxxuh566xwwqqwxxxxxuserHome.fbUid}'},
                                   {name: 'email', value: '#{yxxxuh566xwwqqwxxxxxuserHome.fbEmail}'},
                                   {name: 'name', value: '#{yxxxuh566xwwqqwxxxxxuserHome.fbName}',
                                   {name: 'first_name', value: '#{yxxxuh566xwwqqwxxxxxuserHome.fbFirst_Name}',
                                   {name: 'last_name', value: '#{yxxxuh566xwwqqwxxxxxuserHome.fbLast_Name}',
                                   {name: 'gender', value: '#{#{yxxxuh566xwwqqwxxxxxuserHome.fbGender}',
                                   {name: 'agree', value: '#{yxxxuh566xwwqqwxxxxxuserHome.fbName},
                                   {name: 'name', value: '#{yxxxuh566xwwqqwxxxxxuserHome.agreedToTermsOfUsefb}',])">
     </p:remoteCommand>

<h:outputStylesheet>
</h:outputStylesheet>
<script>
  // This is called with the results from from FB.getLoginStatus().
  function statusChangeCallback(response) {
    console.log('statusChangeCallback');
    console.log(response);
    // The response object is returned with a status field that lets the
    // app know the current login status of the person.
    // Full docs on the response object can be found in the documentation
    // for FB.getLoginStatus().
    if (response.status === 'connected') {
      // Logged into your app and Facebook.
      testAPI();
    } else if (response.status === 'not_authorized') {
      // The person is logged into Facebook, but not your app.
      document.getElementById('status').innerHTML = 'Please log ' +
        'into this app.';
    } else {
      // The person is not logged into Facebook, so we're not sure if
      // they are logged into this app or not.
      document.getElementById('status').innerHTML = 'Please log ' +
        'into Facebook.';
    }
  }

  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }

  window.fbAsyncInit = function() {
  var aid;
   //alert(window.location.href);
  if (window.location.href.indexOf(".l3r") > -1) {
   aid = "1493497040950348";
  } else {
   aid = "462928240562239";
  }
   //alert(aid);
  FB.init({
    appId      : aid,
    cookie     : true,  // enable cookies to allow the server to access 
                        // the session
    xfbml      : true,  // parse social plugins on this page
    version    : 'v2.4' // use version 2.2
  });
  //appid if myflowp.3re..   462928240562239
  // Now that we've initialized the JavaScript SDK, we call 
  // FB.getLoginStatus().  This function gets the state of the
  // person visiting this page and can return one of three states to
  // the callback you provide.  They can be:
  //
  // 1. Logged into your app ('connected')
  // 2. Logged into Facebook, but not your app ('not_authorized')
  // 3. Not logged into Facebook and can't tell if they are logged into
  //    your app or not.
  //
  // These three cases are handled in the callback function.

  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });

  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));

  // Here we run a very simple test of the Graph API after login is
  // successful.  See statusChangeCallback() for when this call is made.
  function testAPI() {
    console.log('Welcome!  Fetching your information.... ');
    FB.api('/me', function(response) {
      console.log('Successful FB login for: ' + response.name);
      if(!document.getElementById('register:agreedToTermsfb').checked){
        document.getElementById('status').innerHTML = response.name+' Please Agree to Terms, to continue ' ;
        Logout();
      }else{
      onFbLogin(response.id, response.email, response.name, response.first_name, response.last_name, response.gender,document.getElementById('register:agreedToTermsfb').checked);
      document.getElementById('status').innerHTML = 'Welcome Facebook User '+response.name ;
      //final response to user will come from server
      }
    });
  }
  function Logout() {
  FB.logout(function () { document.location.reload(); });
  }

</script>

	<p:toolbar height="26" itemSeparator="grid">
	  <p:toolbarGroup>
<ui:remove>
/// add a new method in controlusageperiods?
              <h:outputText value="Business Date Rolled" rendered="#{lxxxeh177xwwqqhxxxxxcontrolusagebyperiodsHome.managed}"/> 
</ui:remove>
	  </p:toolbarGroup>
	  <p:toolbarGroup location="#{yxxxuh566xwwqqwxxxxxuserHome.mobile?'left':'right'}">
         <h:outputText value="Last Signed As " rendered="#{!identity.loggedIn}"/> 
         <h:outputText value="#{customIdentity.username}"/> 
         <h:outputText value="#{messages.Today} "/> 
         <h:outputText value="#{authenticator.getCurrcaldates()}"/> 
        <h:button id="lbdone" image="./img/home_24.png"  alt="Cancel" value="Cancel" propagation="end"  outcome="/home.xhtml" />
         <h:outputText id="QueryLabel" value="#{messages.searchTerm}" />
         <h:inputText id="Query" value="put search here" size="15" />
         <h:commandButton id="r3Search" action="/home.xhtml"  image="/img/Findblue16.png"
            value="#{messages.searchButton}" />
         <h:link id="Cart" outcome="/checkout.xhtml" value="Cart" propagation="none"  rendered="#{identity.loggedIn and !customIdentity.product=='s'}"  >
          <h:graphicImage value="/img/Cart32.png" styleClass="pic"/>
         </h:link>
		   <h:graphicImage id="Helpt" value="/img/help.gif" styleClass="pic">
             <p:tooltip > <span style="white-space: nowrap"> <h:inputTextarea  cols="70" rows="10" readonly="true"  value="#{messages['signupHelp']}"/></span> </rich:tooltip> 
             </h:graphicImage>
	  </p:toolbarGroup>
       <h:messages globalOnly="true" styleClass="message" id="globalMessages"/>
	</p:toolbar>
    
  <p:accordionPanel switchType="client" itemInactiveLeftIcon="/img/control_add16.png">

  <p:tab title="#{messages.or_login_signup_with_fb}" leftInactiveIcon="/img/fb29.png" > 
            <h:selectBooleanCheckbox id="agreedToTermsfb" value="#{yxxxuh566xwwqqwxxxxxuserHome.agreedToTermsOfUsefb}"/>
            <h:outputText value="#{messages.agree_to_terms}" escape="false"/>
            <h:commandLink value=" " id="termsOfUseLinkfb" onclick="PF('termsOfUse').show()">
            &nbsp;<h:outputText value=" #{messages['read']}"/>
            </h:commandLink><br/><br/>
            <h:outputText value="#{messages.or_login_signup_with_fb}"/>
             <fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
             </fb:login-button>
             <div id="status">
             </div>
   </p:tab> 
                
  </p:accordionPanel>
          <br/><br/><br/><h:panelGroup>
            <h:outputText value="#{messages.signup_done_logon_now}" style="margin-right: 18px;" rendered ="#{(request.requestURI.contains('signup.'))}"/>
            <h:link id="loginb"  styleClass="hdrLink"  outcome="/login.xhtml" icon="/img/LogIn16.png" iconClass="pic" rendered="#{not identity.loggedIn}" value="#{messages.login}" >
             <p:tooltip id="loginTip" attached="true" for="loginb" >
              <h:outputText value="#{messages.login_tip}" rendered ="#{(request.requestURI.contains('signup.'))}"/>
             </p:tooltip>
            </h:link>
            <h:button  value="Cancel" propagation="end" outcome="/home.xhtml" />
          </h:panelGroup>
       <h:messages globalOnly="false" styleClass="message" />

 </h:form>

<h:form>

 <p:dialog id="termsOfUse" width="640" height="480" >
  <f:facet name="header"><h:outputText value="#{messages.terms_of_use}"/></f:facet>
  <f:facet name="controls">
   <h:form>
    <a4j:commandButton onclick="PF('termsOfUse').hide()" type="image" image="/img/Cancel16.png"/>
   </h:form>
  </f:facet>
  <ui:include src="signupTerms.xhtml"/>
  <h:panelGroup style="width: 600px; text-align: center;">
    <h:form>
      <p:commandButton value="#{messages.ok}" onclick="PF('termsOfUse').hide()"/>
    </h:form>
  </h:panelGroup>
 </p:dialog>
</h:form>


 </ui:define> 
</ui:composition>



