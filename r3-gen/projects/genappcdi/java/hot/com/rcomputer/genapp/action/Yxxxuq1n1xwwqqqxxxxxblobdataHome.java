


/** Generated By EntityHome.java.ftl on 26-May-2024 9:52:17 PM
*Entity Home
*parameters passed: action.package and model.package
*/

package com.rcomputer.genapp.action;
import com.rcomputer.genapp.model.*;
import org.apache.deltaspike.data.api.AbstractEntityRepository;
import org.apache.deltaspike.data.api.Repository;
import org.picketlink.Identity;
import org.picketlink.credential.DefaultLoginCredentials;
import org.picketlink.idm.IdentityManagementException;
import org.picketlink.authentication.AuthenticationException;
import org.picketlink.common.exceptions.PicketLinkException;

import java.math.BigDecimal;
import java.math.RoundingMode;
import java.util.Date;
import java.util.Calendar;
import java.util.Locale;
import java.util.Currency;
import java.util.Collection;
import java.lang.String;
import java.lang.StringBuilder;
import java.text.SimpleDateFormat;
import java.text.NumberFormat;
import javax.faces.application.FacesMessage;
import javax.faces.event.ValueChangeEvent;
import javax.faces.model.SelectItem;
import javax.faces.model.SelectItemGroup;
import javax.annotation.PostConstruct;
import javax.faces.view.ViewScoped;
import javax.inject.Inject;
import javax.transaction.Transactional;
import javax.faces.event.ActionEvent;
import javax.inject.Named;
import javax.enterprise.inject.Instance;
import javax.faces.event.AjaxBehaviorEvent;
import java.util.Iterator;
import java.util.List;
import java.util.ArrayList;
import java.util.Arrays;
import javax.persistence.*;
import javax.faces.context.ExternalContext;
import javax.faces.context.FacesContext;
import javax.faces.component.UIComponent;
import javax.faces.validator.ValidatorException;
import java.io.IOException;
import java.io.OutputStream;
 import java.io.StringReader;
 import java.io.InputStreamReader;

import java.io.FileWriter;
import java.io.BufferedWriter;
import java.io.Serializable;
import java.io.Writer;

import java.nio.charset.StandardCharsets;
import java.nio.file.Paths;
import java.nio.file.Files;
import java.nio.file.Path;


import java.util.logging.Logger;
import java.util.ResourceBundle;



//move these under genCandidate
//import java.io.File; model already has File class, use qualified java.io.File instead of import
import java.io.StringWriter;
import org.apache.tools.ant.Project;
import org.apache.commons.beanutils.BeanUtils;
import org.apache.commons.text.StringEscapeUtils;
import org.apache.tools.ant.ProjectHelper;
import javax.servlet.Servlet;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.util.HashMap;
import java.util.Map;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javax.servlet.http.Part;





 import java.awt.image.BufferedImage;
 import java.awt.Graphics2D;
 import java.io.ByteArrayInputStream;
 import java.io.ByteArrayOutputStream;
 import javax.imageio.ImageIO;
 import net.coobird.thumbnailator.*;
 import org.jsoup.Jsoup;
 //put conditional import
 import org.jsoup.nodes.Document;
 import org.jsoup.nodes.Element;
 import org.jsoup.select.Elements;
 import org.jsoup.safety.Whitelist;
 import org.jsoup.nodes.TextNode;
 import org.jsoup.nodes.Attributes; 
 import org.jsoup.nodes.Attribute; 
 import java.net.URL;
 import java.io.InputStream;
 import java.io.OutputStream;

 import com.opencsv.CSVParser;
 import com.opencsv.CSVParserBuilder;
 import com.opencsv.CSVReader;
 import com.opencsv.CSVReaderBuilder;
 import com.opencsv.CSVWriter;
 import com.opencsv.bean.ColumnPositionMappingStrategy;
 import com.opencsv.bean.HeaderColumnNameTranslateMappingStrategy;
 import com.opencsv.bean.HeaderColumnNameMappingStrategy;
 import com.opencsv.bean.CsvToBean;
 import com.opencsv.bean.CsvToBeanBuilder;
 import com.opencsv.bean.StatefulBeanToCsv; 
 import com.opencsv.bean.StatefulBeanToCsvBuilder; 
 import java.io.FileOutputStream;

import java.io.FileOutputStream;
import java.util.Base64;


//assign is used to be able to add import dynamically
import com.rcomputer.genapp.model.*;


/* The following may not be needed, use generic fiedname from above like deliveryField
*/
//jay0 z3xxeqxxbvnxxxxxxxxxqtyordrd


  //jay2 zqxxbvnxxxxxxxxxqtyordrd
/*
 pojo ie entity has component properties for all composite key fields and entity proprties for all other fields.
 If an entity property is a foreign key then the property name will show the foreign entity not the actual field name.
 Use a filter like c2h.isManyToOne(property) and  column = property.columnIterator.next() to get the actual column name.
 or use parentPojo.identifierProperty.name to get the key field property name or use
 jay5 if !c2h.isCollection(property) && !isToOne(property)
  if c2j.isComponent(property)
   foreach componentProperty in property.value.propertyIterator in list.java.ftl
 
 If a persistence class has a foreign key more than once then the property name has the foreign entity plus Byxxxx to qualify
 The component properties have the identifierProperty iterator holding each key. 
 In case the key is non composite ie a single field then it will not be part of any component and will be part of properties
 Component properties seem to be tied to xxxId.java whereas non component properties are tied to xxx.java
 composite key fields declared via  Primary Key columns will appear only in component/xxId/java. If key field is a foreign 
 field then it is also declared via Foreign Key and will appear in entity properties/xxx.java. However in xxx.java
 the column name will not be shown, instead foreign Pojo class will be shown. Column iterator can be used to get
 the column name. If there are more than one fields pointing to same pojo then it will show as xxxByzz
 For those key fields which are foreign fields we need to generate validateandselect method. Currently generation 
 is hard coded by checking function of the pojo, it can be automated by xchecking component property columnname against entity ptoperty column name
 and if match the entity property name will be the pojo which needs to be validated and selected.
 The same logic can be used in editproperty.ftl to automate puting validateandSelect method call  
*/
/* 
in case of composite keys
*/ 
  /*
  In case of composite keys and key auto generated

  */

/**
* This is Action Home class 
* @author 3r Computer Systems  
* @version 2.0
*/

@Named("yxxxuq1n1xwwqqqxxxxxblobdataHome")
@ViewScoped
@Transactional
public  class Yxxxuq1n1xwwqqqxxxxxblobdataHome implements Serializable
{
   @Inject File file;
   @Inject R3RestClient r3RestClient;

   @Inject SqlAdminSupport sqlAdminSupport;
   @Inject SkinBean skinBean;
    @Inject CustomIdentity customIdentity; 
        @Inject
        private Identity identity;
	@Inject
	Xxxxch82bxhhhhhxxxxxeditlogHome xxxxch82bxhhhhhxxxxxeditlogHome;
	private Xxxxch82bxhhhhhxxxxxeditlog xxxxch82bxhhhhhxxxxxeditlog;


	@Inject
	Fpxxfq1a5xwwqqhxxxxxitemHome fpxxfq1a5xwwqqhxxxxxitemHome;
	private Fpxxfq1a5xwwqqhxxxxxitem fpxxfq1a5xwwqqhxxxxxitem;
	@Inject
	Fpxxfq1a5xwwqqhxxxxxitemList fpxxfq1a5xwwqqhxxxxxitemList;
	@Inject
	Yxxxuh566xwwqqwxxxxxuserHome yxxxuh566xwwqqwxxxxxuserHome;
	@Inject
        Yxxxch522xhhxxhxxxxxclientHome yxxxch522xhhxxhxxxxxclientHome;
        Yxxxch522xhhxxhxxxxxclient yxxxch522xhhxxhxxxxxclient;

   


   @Inject 
   DefaultLoginCredentials credentials;
   //@Inject Authenticator authenticator; not sure what problem injecting may be due to @picketlink
   private boolean nextShow = false;
   boolean mailRelayOff=true; 
   Boolean smtpError=false;
    private FacesContext facesContext=null;
    private ServletContext context=null;
    private HttpServletRequest req=null;
    private HttpServletResponse resp=null;
    private String userAgentStrO=null;
    private String userAgentStr=null;
    private String userIP=null;
    private String urlName=null;
    private int urlPort=0;
    private ExternalContext externalContext=null;
    private HttpSession session=null;
    private String skinCode=null;
    private String replyToMatCode = null;
    private String replyToMatSidS = null;
    private String descriptionValue =null;
    private String startValue = null;
    private ResourceBundle bundle=null;
    int count = 0;
    int countD=0;
    int countB=0;
    private int excpCount=0;
    Boolean currConv=false;
    int importdone=0;
    String linesA[]=null;
	private final int limit_max_size = 10240000;
	private final String limit_type_file = "gif|jpg|png|jpeg|txt|csv|jpeg";
	private String path_to = "resources" + java.io.File.separator + "uploads";

    private int uploadsAvailable = 3;
    private int uploadsDoneCount = 0;
    private boolean autoUpload = false;
    private boolean useFlash = false;
    private Boolean show;
    private Part fileU;





     private List<File> files = new ArrayList<File>(); // multiple uploaded files
    @PostConstruct
    public void initialize() {
    try{
      facesContext = FacesContext.getCurrentInstance(); 
      // bypass if came from servlet
     if(facesContext !=null){
      bundle = facesContext.getApplication().getResourceBundle(facesContext, "messages");
      ///SEVERITY_INFO, "any string in quotes"+e.getMessage+bundle.getString("id_password_not_matching")
      externalContext = facesContext.getExternalContext(); 

      context = (ServletContext)FacesContext.getCurrentInstance().getExternalContext().getContext(); 
      req = (HttpServletRequest) externalContext.getRequest(); 
      session = req.getSession();
      urlName=((javax.servlet.http.HttpServletRequest) externalContext.getRequest()).getServerName();
      urlPort=((javax.servlet.http.HttpServletRequest) externalContext.getRequest()).getServerPort();
      resp = (HttpServletResponse) externalContext.getResponse(); 
      userAgentStrO = req.getHeader("user-agent");  
      userAgentStr = userAgentStrO;  
      userIP = req.getHeader("X-FORWARDED-FOR");  //get from req header
      if (userIP == null) {  
       userIP = req.getRemoteAddr();  //get from socket connection
      }
          urlIndex=urlName.lastIndexOf(".");
          if (urlIndex == -1){
            urlIndex=urlName.length();
          }       
          if (urlName.contains("www.")){
           owner2Code=urlName.substring(4,urlIndex);
          }else{
           owner2Code=urlName.substring(0,urlIndex);
          }
          //extract subdomain if used. if subdomain, masterSiteCode will have a value
         if(!customIdentity.getMasterSiteCode().isEmpty()){
          owner2Code=owner2Code.replace("."+customIdentity.getMasterSiteCode(),"");
         }
      if (userIP == null) {  
       userIP = req.getRemoteAddr();  
       if (userIP == null) {  
        userIP = "noIP";  
       }      
      }
      masterSiteCode=customIdentity.getMasterSiteCode();
      masterSiteUrl=customIdentity.getMasterSiteUrl();

      Arrays.fill(checkMapI, Boolean.FALSE);
      Arrays.fill(checkMapT, Boolean.FALSE);
     
     }
      ownerCode=customIdentity.getOwner();
      ownerCddCode=ownerCode.substring(ownerCode.length()-3,ownerCode.length() );
      productCode=customIdentity.getProduct();
      subProductCode=customIdentity.getSubProduct();

      if (customIdentity.getMobileView().length() > 0){
       userAgentStr=customIdentity.getMobileView();
      }
       if(this.instance !=null){
       this.instance.setA1xxuxxxbv49xxxxxxxxfromkey("3R-TOP-LEFT-C");
       }
     }catch(Exception e){
      //log error
      excpCount=excpCount+1;
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,e.getMessage(),""));
    }


    }
   private Logger log = Logger.getLogger(Yxxxuq1n1xwwqqqxxxxxblobdata.class.getCanonicalName());
   //facesMessages being injected so  //FacesMessages.add can be used instead of  //FacesMessages.instance().add
   // using seam facesmessages allow using el expressions , java facesmessage does not allow EL expression
   @PersistenceContext(unitName = "genappcdi")
   private EntityManager entityManager;
   private Integer id=null;
   private String cartPoStatus="x";
   String timeStamp="";
   private boolean changeDone=false;
   private boolean skipValidation=false;
     private Boolean[] checkMapI=new Boolean[6];
     private Boolean[] checkMapT=new Boolean[6];
      private byte[] mailingBytes1 = null;
      private byte[] mailingBytes2 = null;
      private byte[] mailingBytes3 = null;
      private byte[] mailingBytes4 = null;
      private byte[] mailingBytes5 = null;
      private byte[] mailingBytes = null;
      private String mailingText = null;
      private String mailingText1 = null;
      private String mailingText2 = null;
      private String mailingText3 = null;
      private String mailingText4 = null;
      private String mailingText5 = null;
      private String mailingBytes1TypeMime = null;
      private String mailingBytes2TypeMime = null;
      private String mailingBytes3TypeMime = null;
      private String mailingBytes4TypeMime = null;
      private String mailingBytes5TypeMime = null;
      private String ownerCode="sss";
      private String subProductCode="";
      private String ownerCddCode="";
      private String productCode="";
      FacesMessage msg =new FacesMessage("");





   // cartpostatus =e comes from method extended_persist ie copynsave
   // cartPostatus also comes from cposts in method cartpersist
     // cartPostatus=cposts is o if add and currentCount holds last line #, u if remove, c if change for existing and for both c & u 
     // currentCount holds first time call or not to decide on initializing order totals to zeroes if first time
     // currentDetailline will be used to hold the value to pass to showrun()

	@Inject
	Yxxxuq1n1xwwqqqxxxxxblobdataList yxxxuq1n1xwwqqqxxxxxblobdataList;
        private Yxxxuq1n1xwwqqqxxxxxblobdata yxxxuq1n1xwwqqqxxxxxblobdatali;
	@Inject
	Yxxxuq591xwwqqhxxxxxrate1fHome yxxxuq591xwwqqhxxxxxrate1fHome;
	private Yxxxuq591xwwqqhxxxxxrate1f yxxxuq591xwwqqhxxxxxrate1f;
	@Inject
	Yxxxch575xwwqqhxxxxxuserproflHome yxxxch575xwwqqhxxxxxuserproflHome;
	private Yxxxch575xwwqqhxxxxxuserprofl yxxxch575xwwqqhxxxxxuserprofl;











      //CustomIdentity customIdentity = (CustomIdentity)Component.getInstance(CustomIdentity.class); 
      //SkinBean skinBean = (SkinBean)Component.getInstance(SkinBean.class); 
      //ShoppingCartBean r3Cart = (ShoppingCartBean)Component.getInstance(ShoppingCartBean.class); 
      private boolean doRollUp=true;
      private String owner2Code="";
      private String masterSiteCode="";
      private String masterSiteUrl="";
      private String owner2CodeS="";
      private int urlIndex=0;
      int duplDropped=0;
      int importAdded=0;

     private BigDecimal keyedQuantity = new BigDecimal("1.0");
     private BigDecimal detailbaseamt = new BigDecimal("0.0");
     private BigDecimal detailbaseamtO = new BigDecimal("0.0");
     private BigDecimal totalbaseamt = new BigDecimal("0.0");
     private BigDecimal totaloutstanding = new BigDecimal("0.0");
     private BigDecimal totalamountin = new BigDecimal("0.0");
     private BigDecimal postingAmount = new BigDecimal("0.0");
     private BigDecimal chqAmount = new BigDecimal("0.0");
     private BigDecimal amountIn = new BigDecimal("0.0");
     private String chqVerbose="";
     private String tax1Cert="";
     private String tax2Cert="";
     private String tax3Cert="";
                BigDecimal cdisc=BigDecimal.ZERO;
                BigDecimal cselp=BigDecimal.ZERO;
                BigDecimal newOrdPrice=BigDecimal.ZERO;
        private BigDecimal change=BigDecimal.ZERO;//nov29 2919
	private BigDecimal totalmis = BigDecimal.ZERO;
	private BigDecimal totaldel = BigDecimal.ZERO;
	private BigDecimal totalqty = BigDecimal.ZERO;//totalxxxx,amountTotal means parent and includes all details
	private BigDecimal totaltax1 = BigDecimal.ZERO;
	private BigDecimal totaltax2 = BigDecimal.ZERO;
	private BigDecimal totaltax3 = BigDecimal.ZERO;
	private BigDecimal qtyOrdPrev = BigDecimal.ZERO;//
	private BigDecimal amountTotal = BigDecimal.ZERO;//amountTotal is sum of detaillt 
	private BigDecimal qtyTotal = BigDecimal.ZERO;//same as qtytotal or detailqty  then get rid of it
	private BigDecimal qtyTotalNew = BigDecimal.ZERO;
        private BigDecimal tax1RateValue=new BigDecimal("0.0");
        private BigDecimal tax2RateValue=new BigDecimal("0.0");
        private BigDecimal tax3RateValue=new BigDecimal("0.0");
        private BigDecimal tax1RateValueS=new BigDecimal("0.0");
        private BigDecimal tax2RateValueS=new BigDecimal("0.0");
        private BigDecimal tax3RateValueS=new BigDecimal("0.0");
        private BigDecimal tax1RateValueH=new BigDecimal("0.0");
        private BigDecimal tax2RateValueH=new BigDecimal("0.0");
        private BigDecimal tax3RateValueH=new BigDecimal("0.0");
        private BigDecimal detailLt = new BigDecimal("0.0");//is it same as amountTotal
        private BigDecimal detailLtO = new BigDecimal("0.0");
	private BigDecimal detailMis = BigDecimal.ZERO;
	private BigDecimal detailDel = BigDecimal.ZERO;
	private BigDecimal detailQty = BigDecimal.ZERO;
	private BigDecimal detailTax1 = BigDecimal.ZERO;
	private BigDecimal detailTax2 = BigDecimal.ZERO;
	private BigDecimal detailTax3 = BigDecimal.ZERO;
	private BigDecimal detailMisO = BigDecimal.ZERO;
	private BigDecimal detailDelO = BigDecimal.ZERO;
	private BigDecimal detailTax1O = BigDecimal.ZERO;
	private BigDecimal detailTax2O = BigDecimal.ZERO;
	private BigDecimal detailTax3O = BigDecimal.ZERO;
        BigDecimal qtyOrdO=BigDecimal.ZERO;
        String iShipCode="";//size of item
        String tShipCode="";//shipment mode for item


     	private boolean applyTax1 = false;
	private boolean applyTax2 = false;
	private boolean applyTax3 = false;

      String integrationAccountSet="";
      private BigDecimal temp = new BigDecimal("0.0");
      private String key="";
      private String subKey="";
      private String subKeyFirst="";
      private String slobkeyhash="";
      private String keysv="";
      // make it session variable later
      private int currentPeriod=1;
      private String divcode="";
      private String depcode="";
      private String accountn="";
      private String companycode="";
      private Calendar calendar = Calendar.getInstance();
      private Calendar calendare = Calendar.getInstance();
      private Calendar calendarly = Calendar.getInstance();
      private Date currbusdate = calendar.getTime();
      private Date dobSave = calendar.getTime();
      private int mnsorder=0;
      private int arSeqn=0;
      private int apSeqn=0;
      private int icSeqn=0;
      private int paSeqn=0;
      private int joSeqn=0;
      private int glSeqn=0;
     private int subarSeqn = 0;
      private int subapSeqn=0;
      private int subicSeqn=0;
      private int subpaSeqn=0;
      private int subjoSeqn=0;
      private int subglSeqn=0;

      private int mprinted=512;
      private int mdel=256;
      private int mmark=128;
      private int munmark=1023;
      private int mconsign=64;
      private int minvoiced=64;
      private int mnoMail=64;
      //  can be used for other status, use it for 1st entry in group,account or to mark a row as editable etc 
      //               where line field is not there 
      // mconsign should apply to item type not status ?? also means order invoiced
      private int mpartial=32;
      private int mshipped=32;
      private int mreceived=32;
      private int mpaid=16;
      // in case of venartha vpayment goes 16(paid)->8(closed by chq) but venartha itself becomes 16(paid by chq)
      private int mclosed=8;
      private int mreturn=4;//return,investigation,dispute,  
      private int mcopy=2;//copied or Picked from PicklList not customer picked
      private int mtoPay=2;//online order toPay status but items can be added at backOffice
      // copy means record was copied from another 
      //open becomes active ie some activity happened against the open record , mutually exclusive

      private int mactive=1;
      private int mordered=1;
      private int mopen=0;
      private int mquoted=0;
      // open means record created
      // use setXx(getXx()| mcopy)) to set copy flag leaving other bits as is 
      // use setXx(getXx()& _mcopy)) to clear copy flag leaving other bits as is 
      // the following shows which bit counting 0 as the right most bit 
      // used as if bitset(status,_matcive)
      // or as iif(bitset(status,_mmark),.t.,.f.)
      //_mactive=0  && 0th bit from right starting at 0 bit, value 1
      /***
      *transaction flow and status (in brackets) changes
      *Ecommerce:sales checkout by customer 
      *customer: checkout to order active(1)to and paypal payment/authorize toinvoice(64) and system changes order invoiced(64)
      *system:created order and invoice, got order shipment information from paypal and puts a hold payment or takes payment and creates payment record
      *agent:  convert invoice to shipping notclosed(8) invoiceto to shipment active(1) to Add B/O and and inform invoice dept and wait or set as shipped(32)
      *agent: if needed, process invoicing:invoice (64) and shipment B/O? investigate. Add B/O to invoice, inform shipment, wait. 
      *agent: convert invoice to payment:invoice (64) and its ordertoshipment ahipped(32) invoicetopayment(16?). Capture or capture with credit.
      *system: paymenttoorder,shipment,invoice,payment itself closed(8)  
      * 
      *Ecommerce:invoice payment by customer
      * order,invoices created by agent on phone order etc
      * option of payment online given to customer
      *customer: enters email,invoice amount and invoice number. If matches   
      *system: process the payment and creates payment record or puts a hold payment but no payment record?
      *agent: rest ie shipping, payment same as manual or Ecommerce sales check out
      *
      *Ecommerce:POS checkout by agent for customer (item entries can be by customer)
      *
      *Manual: Done by agent request over phone/email/case request folder
      *sales:  create quote active(1)
      *sales:  create order(1) from quote or manually create order active(1) 
      *shipping: notclosed(8) orderto to shipment active(1) to Add B/O and inform order and wait or shipped(32)
      *invoicing: invoice (64) and shipment B/O? investigate. Add B/O to invoice, inform shipment, wait. 
      *Payment:invoice (64) and its order to shipment shipped(32) invoice to payment(16?).Take payment and with credit.
      *payment: make order,shipment,invoice,payment itself closed(8)   

      *Ecommerce invoice payment
      *invoice can be from ecommerce or manually done 
      *customer: invoice (64) and invoice number and amount matches, then system creates payment(16?)
      *payment: make order,shipment,invoice,payment itself closed(8) ???  
      */


      private int _mopen=0;
      //0th bit ,numeric value 0
      private int _mactive=0;
      // && 0th bit ,numeric value 1
      private int _mcopy=1;
      //   && 1th bit ,numeric value 2
      private int _mreturn=2;
      // && 2nd bit                4 
      private int _mclosed=3;
      // && 3rd                    8 
      private int _mpaid=4;
      //   && 4th                   16
      private int _mpartial=5;
      private int _mshipped=5;
      // && 5th                   32 
      private int _mconsign=6;
      private int _minvoiced=6;
      private int _mnoMail=6;
      // && 6th                   64
      private int _mmark=7;
      //    && 7th                   128
      private int _mdel=8;
      //     && 8th                    256 
      private int _mprinted=9;
      // && 9th                   512 
     private boolean fromJsf =true;

     private boolean buttonPressed =false;
     private String buttonPressedLabel ="+ Upload";
     private String upLoadPurpose ="ad";
     private String discountType ="pe";
     private int useSeq=-1;

     private boolean hideChosen =false;
     private String lobDataType=" ";
     private String temps=" ";
     private Integer sidValue=0;
     private boolean entityUpdated =false;
     private boolean entityDeleted =false;
     private String eMailingAddress="";
     private String targetVendor="";
     private boolean mergedPayment=false;
     private String position="";
     private String overRideValue="";
     private String overRideValueS="";
     private String notesToPass="";
     private BigDecimal priceOverRide = new BigDecimal("0.0");
     private String yxxxuq1n1xwwqqqxxxxxblobdataFrom="";
     private String prefix=" ";
     private Integer tempCount=0;
     SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
     private boolean importChosen =false;
     private Yxxxuq1n1xwwqqqxxxxxblobdata instance=null;
     private String hostingAt = "lo";//op for openshift, aw for amazon aws, hero for heroku, lo for Local 
     //web.xml context param to define hosting env and use getServletContext().getInitParameter(hostingAt) 
     //
     

/*
 If same field from a foreign table is used more than once, it can cause duplicate entries for @Inject
 By is used to supress the duplicate
*/
//page parameters start here from not used, existing xxxxFrom used, delete below later -->
        private String from="";
	public void setFrom(String from) {
		this.from = from;
	}

	public String getFrom() {
           
		return from;
	}

//rest goes here
    public void setYxxxuq1n1xwwqqqxxxxxblobdataA0xxuobxbxxxxxxxxxxxsid(Integer id)
    {
      // setId will fetch the record and Instance will point to it
      setId(id);
      if(getInstance() !=null && !getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM") && !getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals(owner2Code)){
       try{
        //different owner other than SYSTEM, dont let it go through, to do why exception not caught
        setId(0);
       } catch (Exception e) {
        log.severe("Error passing bad sid "+ e.getMessage());
        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          FacesMessage.SEVERITY_ERROR,bundle.getString("cannot")+" "+ bundle.getString("get")+" "+bundle.getString("record")+" "+e.getMessage(),""));


       }
      }
    }

    public Integer getYxxxuq1n1xwwqqqxxxxxblobdataA0xxuobxbxxxxxxxxxxxsid()
    {

        return (Integer) getId();
    }

   /**
    * Returns true if the id of the object managed is known.
    */
   public boolean isIdDefined()
   {
      return getId()!=null && !"".equals( getId() );
   }
     public boolean isFromJsf() {
         return fromJsf;//default true
     }

     public void setFromJsf(boolean fromJsf){
      this.fromJsf=fromJsf;
     }


    public boolean isChangeDone(){
     return changeDone;
    } 

    public void setChangeDone(boolean changeDone){
      this.changeDone=changeDone;
    } 


  protected Yxxxuq1n1xwwqqqxxxxxblobdata createInstance()

  {
      // jay add logic to check client flag for debug mode and bypass below if debug
      //setCreatedMessage(createValueExpression(""));
      //setDeletedMessage(createValueExpression(""));
      //setUpdatedMessage(createValueExpression(""));

       //Yxxxuq1n1xwwqqqxxxxxblobdata yxxxuq1n1xwwqqqxxxxxblobdata = new Yxxxuq1n1xwwqqqxxxxxblobdata();
       //scope for this method only
       Yxxxuq1n1xwwqqqxxxxxblobdata yxxxuq1n1xwwqqqxxxxxblobdata=null;
       if (instance == null) {
            try {
                instance = new Yxxxuq1n1xwwqqqxxxxxblobdata();
                yxxxuq1n1xwwqqqxxxxxblobdata=instance;

            }
            catch (Exception e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
                return null;
            }
       }else{
       //came to createInstance, but it may exists for some existing error conditions, so ignore and continue
            try {
                instance = new Yxxxuq1n1xwwqqqxxxxxblobdata();
                yxxxuq1n1xwwqqqxxxxxblobdata=instance;

            }
            catch (Exception e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
                return null;
            }
       

       }


   /*
   This is the place to preinitialize the entity variables to display in jsf pages
   */



  

  
		yxxxuq1n1xwwqqqxxxxxblobdata.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata");

  

  
		yxxxuq1n1xwwqqqxxxxxblobdata.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");

  
		yxxxuq1n1xwwqqqxxxxxblobdata.setA3xxexnsbvxxxxxxxxxxsequence(1);

  

  

  

  
		yxxxuq1n1xwwqqqxxxxxblobdata.setZ1xxzzfxhhxxxxxxxxxxstatusfl(0);

  
		yxxxuq1n1xwwqqqxxxxxblobdata.setZ2xxcztxlxxxxxxxxxxxstatusfldt(calendar.getTime());

  
		yxxxuq1n1xwwqqqxxxxxblobdata.setZ3xxutoxlhxxxxxxxxxxowner(ownerCode);

  
		yxxxuq1n1xwwqqqxxxxxblobdata.setZzxxu2oxxhxxxxxxxxxxowner2(owner2Code);
   return yxxxuq1n1xwwqqqxxxxxblobdata;
  }

	@Inject
	Yxxxuq1m1xwwqqqxxxxxclobdataHome yxxxuq1m1xwwqqqxxxxxclobdataHome;
	private Yxxxuq1m1xwwqqqxxxxxclobdata yxxxuq1m1xwwqqqxxxxxclobdata;
	private Yxxxuq1m1xwwqqqxxxxxclobdata yxxxuq1m1xwwqqqxxxxxclobdata2;
	@Inject
	Yxxxuq1m1xwwqqqxxxxxclobdataList yxxxuq1m1xwwqqqxxxxxclobdataList;


	@Inject
	Yxxxuq1n1xwwqqqxxxxxblobdataHome yxxxuq1n1xwwqqqxxxxxblobdataHome;
	private Yxxxuq1n1xwwqqqxxxxxblobdata yxxxuq1n1xwwqqqxxxxxblobdata;



      String msgb = "";
      byte[] bmsg = null;
      byte[] bmsgb = null;
     private String  startk1  = "";
     private String  endk1  = "";
     private String  startk2  = "";
     private String  endk2  = "";
     private String  startk3  = "";
     private String  endk3  = "";
	private Boolean dataIsClob = false;
	private Boolean dataIsBlob = false;




/**
* method pre-initializes entities and gets invoked via jsf f:viewAction  
*/    
    public void wire()
    {
// ManyToOne will capture the Foreign Key Fields and the foreign Entity Name
// 
     if(this.instance !=null && (this.instance.getB1xxuzbxbvxxxxxxxxxxdata()!=null || yxxxuq1n1xwwqqqxxxxxblobdataHome.isManaged())){
      this.upLoadPurpose="re"; 
     }


    }
    
    public boolean isWired()
    {
     return true;
}

    
    public Yxxxuq1n1xwwqqqxxxxxblobdata getDefinedInstance()
    {
        if(isIdDefined()){
         if(getInstance() == null || getInstance().getA0xxuobxbxxxxxxxxxxxsid()==null){
          return null;///need to check when this happens, it seems can happen if the entity already exists and again calls getdefine
         }
         if(getInstance().getA0xxuobxbxxxxxxxxxxxsid().equals(getId())){
          return getInstance();
         }else{
          return yxxxuq1n1xwwqqqxxxxxblobdataList.getSidToEntity(getId());
         }
        }else{
         return null;
        }
    }

       private Map<Integer, Boolean> checked = new HashMap<Integer, Boolean>();

public Map<Integer, Boolean> getChecked() {  
return checked;  
}  

/**
* method is used to check the numeric status field value and return a descriptive value
* @param status
* int value
* @return a String value 
*/    

    public String describeStatus(int status){
    if (status==0){
     return "open";
    }
    
    if (status==1){
     return "active";
    }
    if (status==32){
     return "shipped";
    }
    if (status==64){
     return "invoiced";
    }
    if (status==8){
     return "closed";
    }
    if (status==16){
     return "paid";
    }



    return ""+status; 
   }

    public String markCompleted() {
           this.instance.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
           // add logic to check elligble to close
           this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl( mclosed );
     return "completed";
    }
    public String markCompletedAll() {
           // add logic put a series of query to get related records and mark them closed
           this.instance.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
           // add logic to check elligble to close
           this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(mclosed );
     return "completedAll";
    }


	public String getEMailingAddress() {
              if (eMailingAddress ==null || eMailingAddress.isEmpty()){  
                //prefill if empty
              }
		return eMailingAddress;
	}
     
	public void setEMailingAddress(String eMailingAddress) {
		this.eMailingAddress = eMailingAddress;
	}

	public String getShowPosition() {
	  return position;
	}
     
	public void setShowPosition(String position) {
		this.position = position;
	}


	public String getValueOverRide() {
	  return overRideValue;
	}
     
	public void setValueOverRide(String overRideValue) {
		this.overRideValue = overRideValue;
	}


	public String getValueOverRideS() {
	  return overRideValueS;
	}
     
	public void setValueOverRideS(String overRideValueS) {
		this.overRideValueS = overRideValueS;
	}


	public BigDecimal getPriceOverRide() {
	  return priceOverRide;
	}
	public void setPriceOverRide(BigDecimal priceOverRide) {
		this.priceOverRide = priceOverRide;
	}

     

	public String getNotesToPass() {
		return notesToPass;
	}
     
	public void setNotesToPass(String notesToPass) {
		this.notesToPass = notesToPass;
	}



	public String getYxxxuq1n1xwwqqqxxxxxblobdataFrom() {
		return yxxxuq1n1xwwqqqxxxxxblobdataFrom;
	}
     
	public void setYxxxuq1n1xwwqqqxxxxxblobdataFrom(String entityFrom) {
		this.yxxxuq1n1xwwqqqxxxxxblobdataFrom = entityFrom;
	}



     public String getPrefix() {
      return prefix;
    }

   public void setPrefix(String prefix) {
     this.prefix=prefix;
   }
   public Boolean[] getCheckMapI() {
    return this.checkMapI;
   }
   public void setCheckMapI(Boolean[] checkMapI){
                this.checkMapI=checkMapI;
   }
   public Boolean[] getCheckMapT() {
    return this.checkMapT;
   }
        public void setCheckMapT(Boolean[] checkMapT){
                this.checkMapT=checkMapT;
        }
	public void setMailingImage1(byte[] mailingBytes) {
		this.mailingBytes1 = mailingBytes;
	}

	public byte[] getMailingImage2() {
           
		return mailingBytes2;
	}

	public void setMailingImage2(byte[] mailingBytes) {
		this.mailingBytes2 = mailingBytes;
	}
	public byte[] getMailingImage3() {
           
		return mailingBytes3;
	}

	public void setMailingImage3(byte[] mailingBytes) {
		this.mailingBytes3 = mailingBytes;
	}
	public byte[] getMailingImage4() {
           
		return mailingBytes4;
	}

	public void setMailingImage4(byte[] mailingBytes) {
		this.mailingBytes4 = mailingBytes;
	}

	public byte[] getMailingImage5() {
           
		return mailingBytes5;
	}

	public void setMailingImage5(byte[] mailingBytes) {
		this.mailingBytes5 = mailingBytes;
	}

	public void setMailingText(String mailingText) {
		this.mailingText = mailingText;
	}

	public String getMailingText1() {
           
		return mailingText1;
	}

	public void setMailingText1(String mailingText) {
		this.mailingText1 = mailingText;
	}

	public String getMailingText2() {
           
		return mailingText2;
	}

	public void setMailingText2(String mailingText) {
		this.mailingText2 = mailingText;
	}
	public String getMailingText3() {
           
		return mailingText3;
	}

	public void setMailingText3(String mailingText) {
		this.mailingText3 = mailingText;
	}
	public String getMailingText4() {
           
		return mailingText4;
	}
	public void setMailingText4(String mailingText) {
		this.mailingText4 = mailingText;
	}



	public String getMailingText5() {
           
		return mailingText5;
	}
	public void setMailingText5(String mailingText) {
		this.mailingText5 = mailingText;
	}

	public String getMailingImage1TypeMime() {
           
		return mailingBytes1TypeMime;
	}

	public void setMailingImage1TypeMime(String mailingTypeMime ) {
		this.mailingBytes1TypeMime = mailingTypeMime;
	}

	public String getMailingImage2TypeMime() {
           
		return mailingBytes2TypeMime;
	}

	public void setMailingImage2TypeMime(String mailingTypeMime ) {
		this.mailingBytes2TypeMime = mailingTypeMime;
	}
	public String getMailingImage3TypeMime() {
           
		return mailingBytes3TypeMime;
	}

	public void setMailingImage3TypeMime(String mailingTypeMime ) {
		this.mailingBytes3TypeMime = mailingTypeMime;
	}

	public String getMailingImage4TypeMime() {
           
		return mailingBytes4TypeMime;
	}

	public void setMailingImage4TypeMime(String mailingTypeMime ) {
		this.mailingBytes4TypeMime = mailingTypeMime;
	}

	public String getMailingImage5TypeMime() {
           
		return mailingBytes5TypeMime;
	}

	public void setMailingImage5TypeMime(String mailingTypeMime ) {
		this.mailingBytes5TypeMime = mailingTypeMime;
	}


    /**
    * The following method is proxy for file.fileUpload to allow using 
    * requestScoped for raaspi file class
    * @see "file class"
    * 
    */

    public String callFileUpload(String purpose){
     file.fileUpload(purpose);
     return "";
    }



    /**
    * The following method used r3restclient.xhtml to ???
    * @param args none bur flag restentity is set to true
    * @return String set by persist
    * @exception None 
    * @see "persist()"
    * 
    */

    public String persistRest() {
     restEntity=true;
     return persist();
    }



    public String persist(String owner2Code) {
     // override owner2Code temporarily and will get reset in next invocation of the bean
     owner2CodeS = this.owner2Code;
     this.owner2Code=owner2Code;
     // no need to rollup because all values are zero also avoids owner2Code issue for SYSTEM records
     doRollUp=false;
     return persist();
    }

/***
* creates key unless already exists as in from rest like shopify, or order created via cart or skip key validation
* key could be created from subkeys or auto generated based on reveng.xml
* based on entity needs fill up with entered values. Item will have type, taxable or not. 
* if txn then call showrunt > createcdetails and showrunt (updates parent instance values)
* persistrunt (puts values to totals for persist) , updatecustomer or vendor,
* common part begins
* set clob/blob pointer to the instance
* if child item then superupdate parent
* persist any new clob/blob, update existing clob/blob
* persist current instance and then details 
* seq starts from 0 and xxList.getNextSeqAvailable is used for next one. 
* seq -1 used  for storing removed image to allow undo
* or in case 3R-TOP-BKGR -1 means use color instead of any image
* qualifier 1 if shopping items. Non shopping or not related to items can have qualifier PIC etc.
*@param none, values passed through variables
*@see "extended_persist"
*/
    public String persist() {


      


       // we need to check whether validation has set bcontinue has false, if so clear it and return
       if (!bcontinue){
             bcontinue=true;
             return null;
       }



       if(!owner2Code.equals("SYSTEM") && !owner2Code.equals(masterSiteCode) && !getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals(owner2Code)){
        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
         FacesMessage.SEVERITY_ERROR,bundle.getString("If")+" "+bundle.getString("non")+" "+bundle.getString("owned")+" "+bundle.getString("record")+", "+bundle.getString("edit")+" "+ bundle.getString("not")+" "+bundle.getString("allowed"),""));
         log.severe("persist_error_owner "+owner2Code +" / "+ getInstance().getZzxxu2oxxhxxxxxxxxxxowner2());
         bcontinue=false;
         return null;
       }
       //instance already exists with site owner2, so change it now
       if(owner2Code.equals("SYSTEM")){
        this.instance.setZzxxu2oxxhxxxxxxxxxxowner2("SYSTEM");
       }

      slobkeyhash=" ";

          /* If AutoGen is yes all natural keys will get caught here.
           The following comment if not autogen
           non composite key , composite keys will not get detected here because the property name will show as id 
           The logic further below this will probe  the pojo.identifier to dig out the column values for flag k,n 
           this.instance.getA0xxukbdlvxxxxxxxxxxfromtable()  this.instance.setA0xxukbdlvxxxxxxxxxxfromtable
           org.hibernate.mapping.Column(fromtable)
           2
          */
            if (this.instance.getA0xxukbdlvxxxxxxxxxxfromtable()!=null){
             // check and disallow or warn if duplicate keyed key via validate, no need to check here again
             // except special cases where validation was not done like csv data
             this.instance.setA0xxukbdlvxxxxxxxxxxfromtable(this.instance.getA0xxukbdlvxxxxxxxxxxfromtable());
            }



       if (!bcontinue){
             return null;
       }
// if calling method has try then calling method try will catch the exception
       try {
        // a0xxuobxbxxxxxxxxxxxsid
        // last in the loop centityName ->   centityKeyFieldName ->  entityKeyFieldName -> a0xxukbdlvxxxxxxxxxxfromtable
        if (!restEntity && !cartPoPicked){
             // subkey so far is companyName (!empty)+lastName||ss+firstname||ss+ss(companyName empty)+phone #s ||ss etc ss means 
             // time stamp seconds
             // first 16 characters need to be broken into parts if name involved otherwise long last name makes it hard to distinguish key values
             // because ss is used same lastname and firstname will still produce different 16 characters if any phone #s etc are missing 
             // entityKeyFieldName -> a0xxukbdlvxxxxxxxxxxfromtable
             // key set but return if the natural key already exists except for clob and blob where duplicates ok because
             // of non key seq is used to differentiate. So check if same seq
             // also apply initCap inside keyExists since we have access to the instance there
             //jay subkey  kfrcl N kk this.instance.getA0xxukbdlvxxxxxxxxxxfromtable() 
              // Set keyed in value(s) to uppercase
               
          } 
                int i=0;
                // blobdata entity iterator used by clobdata persist or when called by master entity persist
                 String sFromTable="";
                 String sQualifier="";
                 String sFromKey="";
                 String sKey="";
                 Integer sSequence=0;
                //below for blobdata persist but can originate from other entities like Item
                String clobImgUrl="";// support to be added for clob/blob
               // changed logic since now we can key in -M ib clob/blob edit plus dupl should allways be checked
               // if coming from non blob then, this instance was already created but not saved, so bypass
                key=this.instance.getA1xxuxxxbv49xxxxxxxxfromkey();// instance gets initielized
                subKey="";
                 List<Yxxxuq1n1xwwqqqxxxxxblobdata> results = entityManager
		 .createQuery(
			"select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where cc.a0xxukbdlvxxxxxxxxxxfromtable=:blobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:blobdatafromkey and cc.a3xxexnsbvxxxxxxxxxxsequence=:blobdatasequence and cc.a2xxuxxxbv50xxxxxxxxqualifier=:blobdataqualifier and (cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 or cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2S ) order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
		           .setParameter("blobdatafromtable", this.instance.getA0xxukbdlvxxxxxxxxxxfromtable()).setParameter("blobdatafromkey", this.instance.getA1xxuxxxbv49xxxxxxxxfromkey())
                            .setParameter("owner2", owner2Code).setParameter("owner2S", "SYSTEM").setParameter("blobdatasequence",this.instance.getA3xxexnsbvxxxxxxxxxxsequence())
                             .setParameter("blobdataqualifier",this.instance.getA2xxuxxxbv50xxxxxxxxqualifier()).getResultList();
		 if(!results.isEmpty() ){
                   FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("binary")+" "+bundle.getString("data")+" "+bundle.getString("already")+" "+bundle.getString("exists")+" "+bundle.getString("for")+" "+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+" "+this.instance.getA2xxuxxxbv50xxxxxxxxqualifier()+" "+this.instance.getA3xxexnsbvxxxxxxxxxxsequence()+" "+this.instance.getZzxxu2oxxhxxxxxxxxxxowner2(),""));
                   bcontinue=false;
                   return null;
                 }
                 if(!this.instance.getA0xxukbdlvxxxxxxxxxxfromtable().equals("blobdata")){
                  superdotpersist();// avoid calling persist() which will cause extra persist 
                  return "persisted";                 }
                  Iterator<File> itr = this.getFiles().iterator();
                Integer attachment=0;
                if(itr.hasNext() ){
                 while (itr.hasNext()) {
                  file = itr.next();
                  dataIsClob=false;
                  dataIsBlob=false;
                  temps=file.getMime();
			  if ("image/bmp".equals(temps)) {
				lobDataType = "bmp";
			  } else if ("image/jpeg".equals(temps)) {
				lobDataType = "jpg";
			  } else if ("image/gif".equals(temps)) {
				lobDataType = "gif";
			  } else if ("image/png".equals(temps)) {
				lobDataType = "png";
			  } else if ("text/xml".equals(temps)) {
				lobDataType = "xml";
			  } else if ("application/msword".equals(temps)) {
				lobDataType = "doc";
			  } else if ("text/plain".equals(temps)) {
				lobDataType = "txt";
			  } else if ("text/html".equals(temps)) {
				lobDataType = "html";
			  } else if ("application/pdf".equals(temps)) {
				lobDataType = "pdf";
			  } else if ("application/vnd.ms-excel".equals(temps)) {
				lobDataType = "xls";
			  } else if ("application/vnd.ms-powerpoint".equals(temps)) {
				lobDataType = "ppt";
			 } else if ("audio/mpeg".equals(temps)) {
				lobDataType = "mp3";
			 } else if ("video/mp4".equals(temps)) {
				lobDataType = "mp4";
			  } else {
				lobDataType = "unkn";
			  }
                  attachment++;// attachment incrase 
                  if(attachment > 0){
                   if(!this.instance.getA0xxukbdlvxxxxxxxxxxfromtable().equals("blobdata")){
                    sFromTable=this.instance.getA0xxukbdlvxxxxxxxxxxfromtable();
                    sFromKey=this.instance.getA1xxuxxxbv49xxxxxxxxfromkey();
                    sQualifier=this.instance.getA2xxuxxxbv50xxxxxxxxqualifier();
                    sSequence=this.instance.getA3xxexnsbvxxxxxxxxxxsequence();
                   }else{
                    sKey=this.instance.getA1xxuxxxbv49xxxxxxxxfromkey();// entered value
                   }
                   // if instance was originally created from Item etc then fromkey/table , qualifier,type  will be lost but need to be restored 
                   this.clearInstance();// support multiple uploads and save, avoid lazy loading
                   this.instance = this.getInstance();
                   this.setInstance(this.instance);
                   if(!sFromTable.equals("")){
                    this.instance.setA0xxukbdlvxxxxxxxxxxfromtable(sFromTable);
                    this.instance.setA1xxuxxxbv49xxxxxxxxfromkey(sFromKey);
                    this.instance.setA2xxuxxxbv50xxxxxxxxqualifier(sQualifier);
                    this.instance.setA3xxexnsbvxxxxxxxxxxsequence(sSequence);
                   }else{
                    this.instance.setA1xxuxxxbv49xxxxxxxxfromkey(sKey);
                    this.instance.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
                    this.instance.setA3xxexnsbvxxxxxxxxxxsequence(attachment-1);
                   }
                  }
                  this.instance.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
                  if(this.instance.getA4xxexxxbvxxxxxxxxxxtype() !=null && !this.instance.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                   this.instance.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                  }
                  if(this.instance.getA4xxexxxbvxxxxxxxxxxtype() !=null && this.instance.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                   this.instance.setA4xxexxxbvxxxxxxxxxxtype("asis"+lobDataType);
                  }
                  if(this.instance.getA4xxexxxbvxxxxxxxxxxtype() ==null ){   
                   this.instance.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                  }
                  superdotpersist();
                 }//end of while
                }//next itr 
                  //superdotpersist();
                  i++;
               /*
                  timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                  FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+bundle.getString("Blobdata")+" "+bundle.getString("as")+" ("+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+") "+"at"+" "+timeStamp,""));
               */
            // if manual entry was done instead of using options then capture it in userprofile
 	    Yxxxuh566xwwqqwxxxxxuser user = null;




             setChangeDone(true);
             importAdded=importAdded+1;
             return "persisted";
       } catch ( Exception e){
         String context="key="+key+",subKey="+subKey;
         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
           FacesMessage.SEVERITY_ERROR," "+"Blobdata"+" "+context+" "+ bundle.getString("error")+" "+bundle.getString("cause")+"- "+e.getMessage(),""));
               bcontinue=false;
               return null;
       }

    }

    public String superUpdate() {
        //this is used to update statusfldate before calling superdotupdate which is the jpa merge
        //flow is (allowupdate() if needed)-update()-(sperupdate() if statusdt needs change-superdotupdate())
        // or -superdotupdate()
        //setUpdatedMessage(createValueExpression(""));
      // allow raaspi to delete SYSTEM records
      if((getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM") && !owner2Code.equals(masterSiteCode)) || (!getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM") && !getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals(owner2Code))){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
         FacesMessage.SEVERITY_ERROR,bundle.getString("If")+" "+bundle.getString("non")+" "+bundle.getString("owned")+", "+bundle.getString("update")+" "+ bundle.getString("not")+" "+bundle.getString("allowed"),""));

                 bcontinue=false;
                 return null;
      }


       if (!bcontinue){
        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
         FacesMessage.SEVERITY_ERROR,bundle.getString("error")+", "+ bundle.getString("not")+" "+bundle.getString("continue"),""));



             return null;
       }
           this.instance.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
           superdotupdate(); 
           setChangeDone(true);
           timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
          /* too much info
           FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
            FacesMessage.SEVERITY_INFO,bundle.getString("updated")+" "+bundle.getString("selected")+" "+"Blobdata"+" "+"at"+" "+timeStamp,""));
           */

           return "superUpdated"; 

    }

    public String updateRest(String descript) {
           superdotupdate();//superdotupdate does not change any date field
           setChangeDone(true);
           timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
           FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
            FacesMessage.SEVERITY_INFO,bundle.getString("updated")+" "+"Blobdata"+" "+descript+" "+bundle.getString("record")+" "+bundle.getString("at")+" "+timeStamp,""));
            return "updated"; 
       }


    public String allowUpdate() {
       ////setUpdatedMessage(createValueExpression(""));
     // allowupdate is used by method calls only and not directly by jsf 
     // there are cases like item stat or customer order we need to allow non owned records to be updated
     // for this to work, make sure entityHome is cleared,use instance itself or setinstance is done with the variable holding instance values and then this is called
            superdotupdate();
            setChangeDone(true);
        /* use customIdentity.getClientMsgLev 
           timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
           FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
            FacesMessage.SEVERITY_INFO,bundle.getString("updated")+" "+bundle.getString("selected")+" "+"Blobdata"+" "+"at"+" "+timeStamp,""));
        */
            return "updated"; 
       }




    /**
    * used by xxEdit.xhtml for updating multiple items for master entities which have details, example order,invoice,glentries
    * mimics ItemHome updateProductsToOrder method (used for shopping cart) logic to handle multiItems
    *@see "addWithDetails used by xxEdit to add new, or update or add detail"
    *@see "updateProductsToOrder used by shopping cart add"
    *add logic to adjust invoice, payment details and paypal etc payment due ie either credit or adjust hold
    */
    public String updateDetailsAll() {
     // before this method is called, very 1st item (common use case) was already saved as detail via addWithDetails method 
     // and flag more was set
     // flow for more items via this method, is as follows
     // first update the current detail ie 2nd or later item and persist it, initialise lastitemline back to 0 and
     // set more to false. The details now has multiple items and user may have flagged one or more to be removed
     // or qty may have changed, so rechecks by looping through details ie lineitems,
     // if checked for remove then subtract qty from item and remove from order details. 
     // call cartpersist with param u for undo or remove which
     //  since no detail value for this will stay, dont call updatecdetails but call
     //  (1) showrunt 
     //  (2) persistrunt
     //  (3) remove() detail and make it null to avoid keet as dirty 
     //  (4) update order itself 
     // if not ckecked , then call ordersHome cartpersist with currentCartedPO detail sid,c as change option 
     // and tempCount (1 means first call)
     // cartPersist for c will get the detail  and call
     //  (1) update() parent which in turn updates details 
     //  (1.1) updatecdetails which updates the order detail qty based on itemTempQty (itemDetailsBrowse view has this)
     //  (1.2) showrunt which recalculates both details and order itself based on quantity or say tax value( a cart can be idle for days)
     //  (1.3) persistrunt which resets all the values for the order itself (detail values done in showrunt) using values calculated in showrunt
     //     each showrunt for a detail will recalculate both its own value and its master but persistrunt simply copies the variable values into properties
     //  (1.4) update() detail instance  
     //  (1.5) update order
     //  (1.6) extra logic added to avoid totals getting wrong
     //   updateParentFromDetails() which loops through all details and recalculates totals and updates parent instance
     //   not sure why the detail was superupdated again     
     // coming back from cartperist
     //  (6) adjust posting if invoice/payment by calling posting with net changes for baseamount etc
     // increment tempcount and go to top of loop
     //tempCount=this.getLastItemLine()-1; 
     Integer tempRemoveCount=0;
     String  currentCartedPO="";
     Integer currentCartedPOSID;

       return "update";
    }










   
    /***
    * update is used by ui like xxxEdit and xxxEditEasy and has logic to prevent cross user updates 
    * update normally updates the entity for which the update was issued, but sometimes related updates are done like
    * 1. for transactions the details,item,customer/vendor are updated before calling entity updated
    *  like order,shipment etc are updated.
    *  If different owner then allowupdate() is used
    * 2. for usagebyperiods, rollupgroup is also updated but same owner  
    * 3. for entities like item,customer which has docmnt fileld for clob/blob data
    *  clob/blob has docmnt field but holds actual data wheres other entities like Item,Customer has 
    *  their hashed key field value in docmnt field. The sid key value not available until item gets created.
    *  There is logic to allow VW (visitor)or DH (Demo User) to change only own user records.
    *  verify posting not needed here because invoice/payment updates are done via updatedetailsall
    *  do not allow user to delete own user record or update own role/level/restrict/allow settings to prevent no one
    *  be left with enough rights , prevent via jsf rendered do not show if owner same as logon id
    * 
    * @param none but values come via variables
    * @return String null or some string value 
    * @exception various

    * Add logic to handle key value change > new hash code > update item as well as clob/blob fromKey
    * Change logic for clob/blob all over to not use seq 0, reserve it store removed value. Seq starts from 1
    * if more than 1 img why both add and replace not shown. If add put the new one with ++seq
    */
    public String update() {
     if(customIdentity.hasRole("VH") || customIdentity.hasRole("PH")) {
     } 


      boolean dataReplaced=false;
      byte[] bytes = null;
      //setUpdatedMessage(createValueExpression(""));
      // allow raaspi to delete SYSTEM records
      if((getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM") && !customIdentity.isMasterSite()) || (!getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM") && !getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals(owner2Code))){
       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
        FacesMessage.SEVERITY_INFO,bundle.getString("Gallery")+"/ "+bundle.getString("non")+" "+bundle.getString("owned")+" "+bundle.getString("records")+" "+bundle.getString("update")+" "+ bundle.getString("not")+" "+bundle.getString("allowed"),""));
        //bcontinue=false;
        return null;
      }
      // allow user to change its own doc (image) if product is forum
      // in user edit make only doc property as editable all others read only
      // similarly allow users to change their own customer info like address, name etc , but send an email to original value to inform
      if (((customIdentity.getRestrict1() != null && customIdentity.getRestrict1().equals("D")) || customIdentity.hasRole("VW")) && (!getInstance().getZ3xxutoxlhxxxxxxxxxxowner().equals(ownerCode) && getInstance().getA0xxuobxbxxxxxxxxxxxsid() != customIdentity.getUserSid() )  ){ 
       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
        FacesMessage.SEVERITY_INFO,bundle.getString("If")+" "+bundle.getString("non")+" "+bundle.getString("owned")+", "+bundle.getString("update")+" "+ bundle.getString("not")+" "+bundle.getString("allowed"),""));
        //bcontinue=false;
        return null;
      }
        entityUpdated =false;
        String fromTable="";
        String qualifier="";
       if (!bcontinue){
        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
         FacesMessage.SEVERITY_ERROR,bundle.getString("error")+", "+ bundle.getString("not")+" "+bundle.getString("continue"),""));
         return null;
       }
         this.instance.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
       if(file !=null){
        //this.clearUploadData();// to allow new upload , jay remove this since it ctears any uploaded file. clear using button if needed
       }
             //Below is common to all type of keys coming from above b1xxuzbxbvxxxxxxxxxxdata  Y
            //jay add logic to delete existing docs, below will add new ones -done

           /* not all entities have document ie clob/blob */
             /* non clob/blob container like item,customer whose data has pointer to actual data */ 
             //docmntOriginalValue is used to hold the clob/blob current data value, new value is under file object via fileUpLoad
              // in case of only blob update
              byte[] docmntOriginalValue=this.instance.getB1xxuzbxbvxxxxxxxxxxdata();
              yxxxuq1n1xwwqqqxxxxxblobdata=this.getInstance();
                String clobImgUrl="";// support to be added for clob/blob
                  //blobdata iterator used for update()  
                  /* blob container whose data has the actual data */ 
                  fromTable=this.instance.getA0xxukbdlvxxxxxxxxxxfromtable();
                  slobkeyhash=this.instance.getA1xxuxxxbv49xxxxxxxxfromkey();
                  qualifier=this.instance.getA2xxuxxxbv50xxxxxxxxqualifier();
                  Iterator<File> itr = this.getFiles().iterator();
                // update may not involve loading a new file rather updating the existing data qualifier etc, so set default value
                dataIsBlob = true;
                while (itr.hasNext()) {
                 // key values for direct add/modify to clob/blob is restricted via drop down list and are not generated
                 // when a blob/clob is attached to other entities like item or customer
                 dataReplaced=true;
                 file = itr.next();
                 if (file.getMime().equals("text/plain") || file.getMime().equals("text/xml")
                         || lobDataType.equals("html")) {
                         dataIsClob = true;
                 } else {
                  dataIsBlob = true;
                 }
                }//end of while
            /* continuing after file/clobImgUrl,following for items/customers etc , clob/blob does not have document */
                int i=0;
                Integer attachment=0;
                int jay=0;
                // currenly only one doc can be uploaded so iteration is for only 1 if any upload, it can be 0 as well
                // in case of clob data can come from file upload or from ckeditor
                 //jay itr loop here based on number of file objects in files arraylist ie arraylist size
                 // there could be 2 cases- one parent entity does not have any clob or blob or 2nd it has 
                 // we need to check column docmnt in parent 
                  if (docmntOriginalValue == null  || (docmntOriginalValue != null && docmntOriginalValue.length < 1) ){
                   // existing blob data is empty, new data under file
                   if (dataIsClob) {
                    yxxxuq1m1xwwqqqxxxxxclobdata = yxxxuq1m1xwwqqqxxxxxclobdataHome.getInstance();
                    yxxxuq1m1xwwqqqxxxxxclobdataHome.setInstance(yxxxuq1m1xwwqqqxxxxxclobdata);
                    // instance already has values for natural keys fromtable,fromkey,qualifier and seq
                    // leave seq as is unless 0 or less
                    if (yxxxuq1m1xwwqqqxxxxxclobdata.getA3xxexnsbvxxxxxxxxxxsequence() < 1){
                     //yxxxuq1m1xwwqqqxxxxxclobdata.setA3xxexnsbvxxxxxxxxxxsequence(1);
                    }
                   }else{
                     yxxxuq1n1xwwqqqxxxxxblobdata = yxxxuq1n1xwwqqqxxxxxblobdataHome.getInstance();
                     yxxxuq1n1xwwqqqxxxxxblobdataHome.setInstance(yxxxuq1n1xwwqqqxxxxxblobdata);//why
                    // instance already has values for natural keys fromtable,fromkey,qualifier and seq
                    if (yxxxuq1n1xwwqqqxxxxxblobdata.getA3xxexnsbvxxxxxxxxxxsequence() < 1){
                     //yxxxuq1n1xwwqqqxxxxxblobdata.setA3xxexnsbvxxxxxxxxxxsequence(1);
                    }
                   }
                  }else{
                   //clob/blob already exists and being replaced or left alone and new one being appended
                   // if same session clob/blob entity already exists otherwise use entityquery
                   // added a checkbox for append or replace existing clob/blob entry, upLoadPurpose value is ad or re
                   //sequence gets incremented if more pictures are uploaded to add
                   // sequence is meant for viewing sequence and may be richfaces pick list can be used
                   // check and use max qualifier as there could be many already
                   if (dataIsClob) {
                    if (yxxxuq1m1xwwqqqxxxxxclobdata == null){
                     try {
                      List<Yxxxuq1m1xwwqqqxxxxxclobdata> results = entityManager
                      .createQuery(
                         "select cc from Yxxxuq1m1xwwqqqxxxxxclobdata cc where cc.a0xxukcdlvxxxxxxxxxxfromtable=:clobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:clobdatafromkey and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2  order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
                         .setParameter("clobdatafromtable", fromTable).setParameter(
                          "clobdatafromkey", slobkeyhash).setParameter("owner2", owner2Code).getResultList();
                      if(!results.isEmpty()){
                       attachment=results.size();
                       yxxxuq1m1xwwqqqxxxxxclobdata= results.get(attachment-1);
                       //yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(new String(file.getData()));
                       if(file.getData() !=null){// if not from ckeditor                   
                        String uploadedText=file.getText();
                        String jay2=uploadedText;
                        try{
                         uploadedText=this.sanitize(uploadedText);
                         uploadedText=jay2;
                        } catch ( Exception e){
                         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                         FacesMessage.SEVERITY_INFO," "+"invalid"+" "+" "+bundle.getString("content")+",  "+e.getMessage(),""));
                         return null;
                        }
                        yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(uploadedText);
                       }
                       yxxxuq1m1xwwqqqxxxxxclobdataHome.getInstance();
                       yxxxuq1m1xwwqqqxxxxxclobdataHome.setInstance(yxxxuq1m1xwwqqqxxxxxclobdata);
                      }else{
                       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                        FacesMessage.SEVERITY_INFO,"clob_result_empty",""));
                        // this means clob/blob to be replaced is gone or was never created, so why not log the error and continue as add
                        log.severe("Error retrieving clob");
                        return null;
                      }
                     } catch (NoResultException nre) {
                         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                          FacesMessage.SEVERITY_INFO,"no_clob_record",""));
                       return null;
                     } catch (Exception e) {
                        log.severe("Error persisting clob"+ e);
                        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                         FacesMessage.SEVERITY_INFO,"clob_persist_error" + e.getMessage(),""));
                      //return null;
                      upLoadPurpose="ad";
                     }
                    }
                   }
                   else{
                    if (yxxxuq1n1xwwqqqxxxxxblobdata == null){
                     try {
                            List<Yxxxuq1n1xwwqqqxxxxxblobdata> results = entityManager
                              .createQuery(
                               "select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where cc.a0xxukbdlvxxxxxxxxxxfromtable=:blobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:blobdatafromkey and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
                                .setParameter("blobdatafromtable", fromTable).setParameter(
                                "blobdatafromkey", slobkeyhash).setParameter("owner2", owner2Code).getResultList();
		             if(!results.isEmpty()){
                              // results include the new instance to be persisted
                              attachment=results.size();
                              yxxxuq1n1xwwqqqxxxxxblobdata= results.get(attachment-1);
                              yxxxuq1n1xwwqqqxxxxxblobdata.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
                              yxxxuq1n1xwwqqqxxxxxblobdataHome.getInstance();
                              yxxxuq1n1xwwqqqxxxxxblobdataHome.setInstance(yxxxuq1n1xwwqqqxxxxxblobdata);
                             }else{
                              FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,"blob_result_empty",""));
                              // this means clob/blob to be replaced is gone or was never created, so why not log the error and continue as add
                              log.severe("Error retrieving blob");
                              //return null;
                              upLoadPurpose="ad";
                           }
                          } catch (NoResultException nre) {
                            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,"no_blob_record",""));
                            return null;
                          } catch (Exception e) {
	 	            log.severe("Error persisting blob"+ e);
                            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,"blob_persist_error" + e.getMessage(),""));

                            return null;
                          }
                    }
                   }

                   if (dataIsClob && "ad".equals(upLoadPurpose)) {
                    yxxxuq1m1xwwqqqxxxxxclobdataHome.clearInstance();
                    yxxxuq1m1xwwqqqxxxxxclobdata = yxxxuq1m1xwwqqqxxxxxclobdataHome.getInstance();
                    if (yxxxuq1m1xwwqqqxxxxxclobdata.getA3xxexnsbvxxxxxxxxxxsequence() > 0){
                      if(useSeq==-1){
                       jay=  yxxxuq1m1xwwqqqxxxxxclobdataList.getNextSeqAvailable("clobdata","C"+slobkeyhash,qualifier,0);
                      }else{
                       jay=useSeq; 
                      }
                     yxxxuq1m1xwwqqqxxxxxclobdata.setA3xxexnsbvxxxxxxxxxxsequence(jay);
                    }
                   }   
                   if (dataIsBlob && "ad".equals(upLoadPurpose)) {
                     yxxxuq1n1xwwqqqxxxxxblobdataHome.clearInstance();
                     yxxxuq1n1xwwqqqxxxxxblobdata = yxxxuq1n1xwwqqqxxxxxblobdataHome.getInstance();
                    if (yxxxuq1n1xwwqqqxxxxxblobdata.getA3xxexnsbvxxxxxxxxxxsequence() > 0){
                      if(useSeq==-1){
                       jay=  yxxxuq1n1xwwqqqxxxxxblobdataList.getNextSeqAvailable("blobdata","B"+slobkeyhash,qualifier,0);
                      }else{
                       jay=useSeq; 
                      }
                     yxxxuq1n1xwwqqqxxxxxblobdata.setA3xxexnsbvxxxxxxxxxxsequence(jay);
                    }
                   }
                  }
                  // common below ie for update for new docmnt or w existing doc

                  if (dataIsClob && "ad".equals(upLoadPurpose)) {
                     if(file.getData() !=null){// if not from ckeditor                   
                      String uploadedText=file.getText();
                      String jay2=uploadedText;
                      try{
                       uploadedText=this.sanitize(uploadedText);
                       uploadedText=jay2;
                      } catch ( Exception e){
                       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                        FacesMessage.SEVERITY_INFO," "+"invalid"+" "+" "+bundle.getString("content")+",  "+e.getMessage(),""));
                       return null;
                      }
                      yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(uploadedText);
                     }

                   yxxxuq1m1xwwqqqxxxxxclobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                   yxxxuq1m1xwwqqqxxxxxclobdata.setA0xxukcdlvxxxxxxxxxxfromtable(fromTable);
                   yxxxuq1m1xwwqqqxxxxxclobdata.setA1xxuxxxbv49xxxxxxxxfromkey(slobkeyhash);
                   yxxxuq1m1xwwqqqxxxxxclobdata.setA2xxuxxxbv50xxxxxxxxqualifier(qualifier);
                   yxxxuq1m1xwwqqqxxxxxclobdata.setY3xxuxznbvxxxxxxxxxxnotes(file.getName());
                    yxxxuq1m1xwwqqqxxxxxclobdataHome.setInstance(yxxxuq1m1xwwqqqxxxxxclobdata);
                    yxxxuq1m1xwwqqqxxxxxclobdataHome.persist();
                    timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                    FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                     FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+bundle.getString("Blobdata")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+slobkeyhash+") "+"at"+" "+timeStamp,""));
                  }
                  if (dataIsClob && "re".equals(upLoadPurpose)) {
                     if(file.getData() !=null){// if not from ckeditor                   
                      String uploadedText=file.getText();
                      String jay2=uploadedText;
                      try{
                       uploadedText=this.sanitize(uploadedText);
                       uploadedText=jay2;
                      } catch ( Exception e){
                       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                        FacesMessage.SEVERITY_INFO," "+"invalid"+" "+" "+bundle.getString("content")+",  "+e.getMessage(),""));
                       return null;
                      }
                      yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(uploadedText);
                     }

                    yxxxuq1m1xwwqqqxxxxxclobdata.setY3xxuxznbvxxxxxxxxxxnotes(file.getName());
                    yxxxuq1m1xwwqqqxxxxxclobdataHome.setInstance(yxxxuq1m1xwwqqqxxxxxclobdata);

                    yxxxuq1m1xwwqqqxxxxxclobdataHome.superUpdate(); 
                    timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                    FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                     FacesMessage.SEVERITY_INFO,bundle.getString("updated")+" "+bundle.getString("Clobdata")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+slobkeyhash+") "+"at"+" "+timeStamp,""));

                  }
                  if (dataIsBlob && "ad".equals(upLoadPurpose)) {
                   if (clobImgUrl.isEmpty()){
                    if(file.getData() !=null){
                     yxxxuq1n1xwwqqqxxxxxblobdata.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());// use only if uploaded
                    }
                    if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() !=null && !yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                     yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                    }
                    if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() !=null && yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                     yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype("asis"+lobDataType);
                    }
                    if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() ==null ){   
                     yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                    }
                   }
                  yxxxuq1n1xwwqqqxxxxxblobdata.setA0xxukbdlvxxxxxxxxxxfromtable(fromTable);
                  yxxxuq1n1xwwqqqxxxxxblobdata.setA1xxuxxxbv49xxxxxxxxfromkey(slobkeyhash);
                  yxxxuq1n1xwwqqqxxxxxblobdata.setA2xxuxxxbv50xxxxxxxxqualifier(qualifier);
                  yxxxuq1n1xwwqqqxxxxxblobdata.setY3xxuxznbvxxxxxxxxxxnotes(file.getName());
                   yxxxuq1n1xwwqqqxxxxxblobdataHome.setInstance(yxxxuq1n1xwwqqqxxxxxblobdata);
                   yxxxuq1n1xwwqqqxxxxxblobdataHome.persist();
                   timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                   FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                    FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+bundle.getString("Blobdata")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+slobkeyhash+") "+"at"+" "+timeStamp,""));

                  }
                  if (yxxxuq1n1xwwqqqxxxxxblobdata !=null && dataIsBlob && "re".equals(upLoadPurpose)) {
                   if (clobImgUrl.isEmpty()){
                    if(file.getData() !=null){
                     yxxxuq1n1xwwqqqxxxxxblobdata.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
                    }
                    if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() !=null && !yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                    yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                    }
                    if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() !=null && yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                    yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype("asis"+lobDataType);
                    }
                    if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() ==null ){   
                    yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                    }
                   }
                   yxxxuq1n1xwwqqqxxxxxblobdata.setY3xxuxznbvxxxxxxxxxxnotes(file.getName());

                   // in case of clob/blob the superUpdate will repeat further dowm, add ftl logic to skip this
                   yxxxuq1n1xwwqqqxxxxxblobdataHome.setInstance(yxxxuq1n1xwwqqqxxxxxblobdata);
                   yxxxuq1n1xwwqqqxxxxxblobdataHome.superUpdate();
                   timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                   FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                    FacesMessage.SEVERITY_INFO,bundle.getString("updated")+" "+bundle.getString("Blobdata")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+slobkeyhash+") "+"at"+" "+timeStamp,""));
                  }
                //}old while now pushed up as end of while loop
                // in case an update is done after this save, will allow fresh upload
                if(dataReplaced){
                 clearUploadData();
                }else{
                  if(fromTable.isEmpty() || !fromTable.equals("blobdata")){
                   //continue, allow other changes  
                  }else{
                    FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                     FacesMessage.SEVERITY_INFO,bundle.getString("update")+" "+bundle.getString("bypassed")+", "+bundle.getString("no")+" "+bundle.getString("file")+" "+bundle.getString("uploaded"),""));
                    FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                     FacesMessage.SEVERITY_INFO,bundle.getString("either")+" "+bundle.getString("upload")+" "+bundle.getString("new")+" "+bundle.getString("or")+" "+bundle.getString("re-upload")+" "+bundle.getString("existing"),""));
                    return null;
                  }
                } 
           //end of documentField != "" ie item/customer and non clob/blob 

            // in update key value is always changed to reflect any change in description etc but also uses
            // current time, so key will always change. Do not use key value instead use sid no as int or as string

           entityUpdated =true;
           setChangeDone(true);
           // better to return and show msg not sure why the redirect was there 
           // changedone did not work either because it got reinitilized and no change msg was being shown
           //or look into using jsf flush msg
           return "updated"; 
           //String viewId = FacesContext.getCurrentInstance().getViewRoot().getViewId();
           //return viewId + "?faces-redirect=true";// refresh

    }
    public String allowRemoveSystem(Yxxxuq1n1xwwqqqxxxxxblobdata row) {
     try{
         this.setInstance(row);
         superdotremove();
           entityDeleted =true;
           setChangeDone(true);
           timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
           FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          FacesMessage.SEVERITY_INFO,bundle.getString("deleted")+" "+bundle.getString("selected")+" "+bundle.getString("entity")+" "+"at"+" "+timeStamp,""));
           return "removed"; 
     } catch ( Exception e){
          FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
           FacesMessage.SEVERITY_INFO,bundle.getString("delete")+" "+ bundle.getString("error")+" "+e.getMessage(),""));

     }
           return null;
    }
    public String allowFading(Yxxxuq1n1xwwqqqxxxxxblobdata row) {
     try{
         this.setInstance(row);
         if(this.instance.getA4xxexxxbvxxxxxxxxxxtype() !=null && !this.instance.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
          this.instance.setA4xxexxxbvxxxxxxxxxxtype(this.instance.getA4xxexxxbvxxxxxxxxxxtype()+"asis");
         }
         this.setInstance(row);
         superdotupdate();
           setChangeDone(true);
           timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
           FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          FacesMessage.SEVERITY_INFO,bundle.getString("updated")+" "+bundle.getString("selected")+" "+bundle.getString("entity")+" "+"at"+" "+timeStamp,""));
           return "removed"; 
        } catch ( Exception e){
          FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
           FacesMessage.SEVERITY_INFO,bundle.getString("update")+" "+ bundle.getString("error")+" "+e.getMessage(),""));

        }
           return null;
    }
    public String removeFading(Yxxxuq1n1xwwqqqxxxxxblobdata row) {
     try{
         this.setInstance(row);
         if(this.instance.getA4xxexxxbvxxxxxxxxxxtype() !=null && this.instance.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
          this.instance.setA4xxexxxbvxxxxxxxxxxtype(this.instance.getA4xxexxxbvxxxxxxxxxxtype().replace("asis",""));
         }
         this.setInstance(row);
         superdotupdate();
           setChangeDone(true);
           timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
           FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          FacesMessage.SEVERITY_INFO,bundle.getString("updated")+" "+bundle.getString("selected")+" "+bundle.getString("entity")+" "+"at"+" "+timeStamp,""));
           return "removed"; 
     } catch ( Exception e){
          FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
           FacesMessage.SEVERITY_INFO,bundle.getString("update")+" "+ bundle.getString("error")+" "+e.getMessage(),""));

        }
           return null;
    }



    public String remove() {
     //jay added logic to delete related entities ie if a demo user is deleted then created employee should be deleted and/or
     // add logic to use employee resultlist rather than singleresult
     // useful for debugging validation failure and also to remove child entities first automatically(logic to be added)
     // some reversing logic needed for transactions aw well
     // allow raaspi user UH to delete SYSTEM records , needed for bad resource and blob etc
       //setDeletedMessage(createValueExpression(""));
        entityDeleted =false;
      // whats about other details like itemjobdetails etc?? 
      // add logic to adjust posting if invoice/payment
      // allow raaspi to delete SYSTEM records
      if((getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM") && !owner2Code.equals("myflowp") && !owner2Code.equals(masterSiteCode)) || (!getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM") && !getInstance().getZzxxu2oxxhxxxxxxxxxxowner2().equals(owner2Code))){
        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
         FacesMessage.SEVERITY_ERROR,bundle.getString("delete")+" "+ bundle.getString("not")+" "+bundle.getString("allowed"),""));

                 bcontinue=false;
                 return null;
      }
      if (((customIdentity.getRestrict1() != null && customIdentity.getRestrict1().equals("D")) || customIdentity.hasRole("VW")) && !getInstance().getZ3xxutoxlhxxxxxxxxxxowner().equals(ownerCode)  ){ 
        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
         FacesMessage.SEVERITY_ERROR,bundle.getString("delete")+" "+ bundle.getString("not")+" "+bundle.getString("allowed"),""));

                 bcontinue=false;
                 return null;
      }

        // entities without details ,function bd
        try {
         superdotremove();
        } catch ( Exception e){
          FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
           FacesMessage.SEVERITY_INFO,bundle.getString("delete")+" "+ bundle.getString("error")+" "+e.getMessage(),""));

           return null;
        }

           entityDeleted =true;
           setChangeDone(true);
           timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
           FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          FacesMessage.SEVERITY_INFO,bundle.getString("deleted")+" "+bundle.getString("selected")+" "+"Blobdata"+" "+"at"+" "+timeStamp,""));
           return "removed"; 



    }


    /**
    * save in clobdata key being accounts,import,csv,1 note when calling clobdata needes extra character before import
    * The following methods supports import of csv data into entities.
    * A file containing csv data is uploaded in clob db under clob key kkkqqqseq where ttt is dollar{entityName}
    * kkk is "dollar{entityName} like accounts" and qqq is "csv" seq is 1
    * The csv data must have the first row containing name of target table columns corresponding to csv data
    * if there is data but no target column name then ,,
    * a template containing the matching column names can be downloaded using import wizard 
    * importCsvData method copies 
    * @param args -option one is to pass clob key  
    * @return none void type
    * @exception None.
    * @see " "
    * in the table called options, column called value will have filter value which will dictate whether it will be hidden,visible or 
    * to use the specified value rather than value in column called options
    * to hide a value in column called options for say activity entity put h=1a. to hide for both item and activity put value= h=1a,18
    * to show a value in column called options for say activity entity put s=1a. to show for both item and activity put value= s=1a,18
    * to show based on locale put in pupose ca=manual-cheque us=manual-check  in value put ca=m us=m
    * to use value rather than whats in options colimn, use v=xxx where xxx is the value.
    */



    /**
    * persist true means came from copynsave ie convert order to invoice etc , false comes from show outstanding and resets totals but no copy
    * called by xxEdit convertToxx button to copy existing entity say order date into new invoice along with the details
    * Similar function as AddWithDetails or AddProductsToOrder but they are interactive, this one loops through existing data
    * Flow:loops through each copy from item like quote,order or invoice
    *       persist -> showTempRunt -> createcDetails ->setParent sets parent totals (loops through as parent details created)
    *          -> PersistRunT prepares Totals for persist -> actual persist of parent and then detail instance
    *      loop back for each item to be copied
    *
    *@see "R3RestClient SyncData where series of order data comes as json values    "
    */



public BufferedImage rotateClockwise90(String action) {
// this converts all images to jpg, jay better to check field type to get value , if empty then jpg
//jpg/png (bits) ->file(byte[] array ->Image(bufferedImage) by ImageIO.Read
//90 degree angle is Math.PI / 2, 180 degrees would be Math.PI
    byte[] imageData=null;
    BufferedImage dest=null;
    //if instance.xxxdata() is null it could be not loaded yet, so use query to eager load
    if(this.getInstance().getB1xxuzbxbvxxxxxxxxxxdata()==null){
     imageData=this.getBlobdata(this.getInstance().getA0xxukbdlvxxxxxxxxxxfromtable(),'B'+this.getInstance().getA1xxuxxxbv49xxxxxxxxfromkey(),this.getInstance().getA2xxuxxxbv50xxxxxxxxqualifier(),this.getInstance().getA3xxexnsbvxxxxxxxxxxsequence());
    }else{
     imageData=this.getInstance().getB1xxuzbxbvxxxxxxxxxxdata();//already retrieved
    }   
    ByteArrayInputStream in = new ByteArrayInputStream(imageData);
    String jayImageFormat="jpg";
    int imageType=5;
    try {
     BufferedImage src = ImageIO.read(in);
     int width = src.getWidth();
     int height = src.getHeight();
     imageType = src.getType();
     if(imageType == 0) imageType = 5;
     dest = new BufferedImage(height, width, imageType);
     Graphics2D graphics2D = dest.createGraphics();
     graphics2D.translate((height - width) / 2, (height - width) / 2);
     graphics2D.rotate(Math.PI / 2, height / 2, width / 2);
     graphics2D.drawRenderedImage(src, null);
     //BufferedImage originalImage = ImageIO.read(item.getInputStream());
     //BufferedImage thumbnail = Thumbnails.of(originalImage)
     //   .size(700, 700)
     //   .asBufferedImage();
     ByteArrayOutputStream baos = new ByteArrayOutputStream();
     ImageIO.write( dest, jayImageFormat, baos );
     baos.flush();
     byte[] imageInByte = baos.toByteArray();
     baos.close();
     yxxxuq1n1xwwqqqxxxxxblobdata=this.getInstance();
     yxxxuq1n1xwwqqqxxxxxblobdata.setB1xxuzbxbvxxxxxxxxxxdata(imageInByte);
     if(action.equals("n")){//not used but tested
      yxxxuq1n1xwwqqqxxxxxblobdata.setA0xxuobxbxxxxxxxxxxxsid(null);
      yxxxuq1n1xwwqqqxxxxxblobdata.setA1xxuxxxbv49xxxxxxxxfromkey(id+"-copy");// copy logic from entityHome
      yxxxuq1n1xwwqqqxxxxxblobdataHome.clearInstance();
      yxxxuq1n1xwwqqqxxxxxblobdataHome.setInstance(yxxxuq1n1xwwqqqxxxxxblobdata);
      yxxxuq1n1xwwqqqxxxxxblobdataHome.superdotpersist();
     }else{
      yxxxuq1n1xwwqqqxxxxxblobdataHome.setInstance(yxxxuq1n1xwwqqqxxxxxblobdata);
      yxxxuq1n1xwwqqqxxxxxblobdataHome.superdotupdate();
     }
                 timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+bundle.getString("rotated")+" "+bundle.getString("image")+" "+bundle.getString("at")+" "+timeStamp+", "+bundle.getString("reload")+" "+bundle.getString("to")+" "+bundle.getString("see")+" "+bundle.getString("change"),""));


    }catch (Exception e){
   	   //log.severe("rotate image error "+e);
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_INFO,bundle.getString("rotate")+" "+bundle.getString("image")+" "+bundle.getString("error")+" "+bundle.getString("for")+" "+bundle.getString("image")+" "+bundle.getString("type")+" "+bundle.getString("value")+" "+imageType+" ,"+e,""));

           return null;
    }

    return dest;
}







    public String getImageLocation(String reference,String location){
       String path="/img/frostedWindow.jpg";
       lobDataType="jpg";
       switch(location){
        case "PRODUCT-1":
         if(reference.equals("eerb")){
          path = "/img/bakery.jpg";
          break;
         }
         if(reference.equals("eecl")){
          path = "/img/clothing.jpg";
          break;
         }
         path="/img/productxx.png"; 
         lobDataType="png";
         break;
        case "PRODUCT-2":
         if(reference.equals("eerb")){
          path = "/img/bakery2.jpg";
          break;
         }
         path="/img/product2xx.jpg"; 
         break;
        case "NEWS-1":
         if(reference.startsWith("ee") || reference.startsWith("o") ){
          path = "/img/news.jpg";
          break;
         }
         path="/img/newsxx.jpg"; 
         break;
        case "ABOUT-1":
         if(reference.startsWith("o") ){
          path = "/img/aboutalt.jpg";
          break;
         }
         path="/img/aboutxx.jpg"; 
         break;
        case "CONTACTUS-1":
         if(reference.startsWith("ee") || reference.startsWith("o") ){
          path = "/img/contactus.jpg";
          break;
         }
         path="/img/contactusxx.jpg"; 
         break;
        case "RESELLERS-1":
          path = "/img/reseller.jpg";
          break;
        case "ATTACHMENT-1":
         path="/img/attachment.png"; 
         lobDataType="png";
         break;
        case "3R-TOP-BKGR-":
         if(reference.startsWith("eerb")){
          path = "/img/top-bkgreerb.jpg";
          break;
         }
         if(reference.startsWith("eecl")){
          path = "/img/top-bkgreecl.jpg";
          break;
         }
         path="/img/topbkgrxx.jpg"; 
         break;
        case "3R-TOP-LEFT-":
         if(reference.startsWith("eerb")){
          path = "/img/top-lefteerb.jpg";
          break;
         }
         if(reference.startsWith("o")){
          path = "/img/top-lefto.jpg";
          break;
         }
         path="/img/topleftxx.png"; 
         lobDataType="png";
         break;
        case "3R-MID-TOP-":
         if(reference.equals("eecl")){
          path = "/img/midtopeecl.jpg";
          break;
         }
         if(reference.startsWith("ef") || reference.startsWith("el")){
          path = "/img/midtopwel.jpg";
          break;
         }
         if(reference.startsWith("saia") ){
          path = "/img/midtopsaia.jpg";
          break;
         }
         if(reference.startsWith("scic") ){
          path = "/img/midtopscic.jpg";
          break;
         }
         path="/img/midtopxx.jpg"; 
         break;
       }
       return path;

    }

    public String persistUpLoadedImageAsImage1() {
     this.instance.setA1xxuxxxbv49xxxxxxxxfromkey("3R-TOP-BKGR-M");     
     this.instance.setA3xxexnsbvxxxxxxxxxxsequence(1);     
     persistUpLoadedImage();
     return "";
    }

    public String persistUpLoadedImageAsImage2() {
     this.instance.setA1xxuxxxbv49xxxxxxxxfromkey("3R-TOP-BKGR-M");     
     this.instance.setA3xxexnsbvxxxxxxxxxxsequence(2);     
     persistUpLoadedImage();
     return "";
    }

    public String publishUpLoadedImageAsImage1() {
     this.instance.setA3xxexnsbvxxxxxxxxxxsequence(1);     
     makePermGraphics(this.instance, "B3R-TOP-BKGR-C");
                 timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("published")+" "+bundle.getString("image1")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+"3R-TOP-BKGR-C, seq 1"+") "+"at"+" "+timeStamp,""));
     return "";
    }
    public String publishPreviewImageAsImage1() {
     //get preview Instance
     this.instance.setA3xxexnsbvxxxxxxxxxxsequence(1);     
     makePermGraphics(this.instance, "B3R-TOP-BKGR-C");
                 timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("published")+" "+bundle.getString("image1")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+"3R-TOP-BKGR-C, seq 1"+") "+"at"+" "+timeStamp,""));
     return "";
    }


    public String publishUpLoadedImageAsImage2() {
     this.instance.setA3xxexnsbvxxxxxxxxxxsequence(2);     
     makePermGraphics(this.instance, "B3R-TOP-BKGR-C");
                 timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("published")+" "+bundle.getString("image2")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+"3R-TOP-BKGR-C, seq 2"+") "+"at"+" "+timeStamp,""));
     return "";
    }

    public String persistUpLoadedImage1AsSystem(){
     this.instance.setA1xxuxxxbv49xxxxxxxxfromkey("3R-TOP-BKGR-M");     
     this.instance.setA3xxexnsbvxxxxxxxxxxsequence(1);     
     this.instance.setA2xxuxxxbv50xxxxxxxxqualifier(yxxxuq1m1xwwqqqxxxxxclobdataHome.getContentTheme());
     persistUpLoadedImageAsSystem();
     return "";
    }
    public String persistUpLoadedImage2AsSystem(){
     this.instance.setA1xxuxxxbv49xxxxxxxxfromkey("3R-TOP-BKGR-M");     
     this.instance.setA3xxexnsbvxxxxxxxxxxsequence(2);     
     this.instance.setA2xxuxxxbv50xxxxxxxxqualifier(yxxxuq1m1xwwqqqxxxxxclobdataHome.getContentTheme());
     persistUpLoadedImageAsSystem();
     return "";
    }


    public String persistUpLoadedImagesAsSystem(){
     bcontinue=true;
     customIdentity.setKeyValue("");
     customIdentity.setKeyValue2("");
     customIdentity.setKeyValue3("");

     String aName=customIdentity.getHoldValue();
     if (aName == null || aName.isEmpty()){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("Image")+" "+bundle.getString("name")+" "+aName+" "+bundle.getString("empty"),""));
      return null;
     }
     if(file.getLength() == 0){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("uploaded")+" "+bundle.getString("file")+" "+bundle.getString("is")+" "+bundle.getString("empty"),""));
      return null;
     }

   // copied from persist for multi
    try{
                int i=0;
                String type="";
                Integer attachment=0;
                dataIsBlob = true;
                  Iterator<File> itr = this.getFiles().iterator();
                while (itr.hasNext()) {
                          file = itr.next();
                          temps=file.getMime();
			  if ("image/bmp".equals(temps)) {
				lobDataType = "bmp";
			  } else if ("image/jpeg".equals(temps)) {
				lobDataType = "jpg";
			  } else if ("image/gif".equals(temps)) {
				lobDataType = "gif";
			  } else if ("image/png".equals(temps)) {
				lobDataType = "png";
			  } else if ("text/xml".equals(temps)) {
				lobDataType = "xml";
			  } else if ("application/msword".equals(temps)) {
				lobDataType = "doc";
			  } else if ("text/plain".equals(temps)) {
				lobDataType = "txt";
			  } else if ("text/html".equals(temps)) {
				lobDataType = "html";
			  } else if ("application/pdf".equals(temps)) {
				lobDataType = "pdf";
			  } else if ("application/vnd.ms-excel".equals(temps)) {
				lobDataType = "xls";
			  } else if ("application/vnd.ms-powerpoint".equals(temps)) {
				lobDataType = "ppt";
			 } else if ("audio/mpeg".equals(temps)) {
				lobDataType = "mp3";
			 } else if ("video/mp4".equals(temps)) {
				lobDataType = "mp4";
			 } else {
				lobDataType = "unkn";
			 }

                  subKey="";
                  type=lobDataType;
                  //jay itr loop here based on number of file objects in files arraylist ie arraylist size
                  if(i==0){
                    aName=customIdentity.getHoldValue();
                  }
                  if(i==1){
                   aName=customIdentity.getHoldValue2();
                  }
                  if(i==2){
                   aName=customIdentity.getHoldValue3();
                  }
                  subKey=subKey+aName+type;
                  timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
                  subKey=subKey+timeStamp.substring(17,18);
                  int subL=subKey.length();
                  if (subL !=0){
                   String subKeyh=Integer.toString(subKey.hashCode());
                   if (subL > 25){
                    subKey=subKey.substring(0,11)+subKey.substring(subL-5,subL)+subKeyh;
                   }
                   else {
                    subKey=subKey+subKeyh;
                   }
                  }

                  key=subKey;
                  if (key.length() > 32){
                   key=key.substring(0,32);
                  }
                  if ( (aName+Integer.toString(key.hashCode())).length() >35){
                   slobkeyhash=(aName+Integer.toString(key.hashCode())).substring(0,34);
                  }else{
                   slobkeyhash=aName+Integer.toString(key.hashCode());
                  }

                  attachment++;
                  yxxxuq1n1xwwqqqxxxxxblobdataHome.clearInstance();
                  yxxxuq1n1xwwqqqxxxxxblobdata = yxxxuq1n1xwwqqqxxxxxblobdataHome.getInstance();
                  yxxxuq1n1xwwqqqxxxxxblobdataHome.setInstance(yxxxuq1n1xwwqqqxxxxxblobdata);
                  yxxxuq1n1xwwqqqxxxxxblobdata.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata");
                  yxxxuq1n1xwwqqqxxxxxblobdata.setA1xxuxxxbv49xxxxxxxxfromkey(slobkeyhash);
                  yxxxuq1n1xwwqqqxxxxxblobdata.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
                  yxxxuq1n1xwwqqqxxxxxblobdata.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
                  if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() !=null && !yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                   yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                  }
                  if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() !=null && yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                   //replace beyond asis with new type if any
                   yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype("asis"+lobDataType);
                  }
                  if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() ==null ){   
                   yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                  }
                  yxxxuq1n1xwwqqqxxxxxblobdata.setZzxxu2oxxhxxxxxxxxxxowner2("SYSTEM");

                  yxxxuq1n1xwwqqqxxxxxblobdataHome.superdotpersist();// persist has a loop to persist blob
                  if(i==0){
                    customIdentity.setKeyValue(slobkeyhash);
                  }
                  if(i==1){
                   customIdentity.setKeyValue2(slobkeyhash);
                  }
                  if(i==2){
                   customIdentity.setKeyValue3(slobkeyhash);
                  }

                  i++;
                }

    } catch ( Exception e){
         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          FacesMessage.SEVERITY_INFO," "+"Image"+" "+" "+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+" "+ bundle.getString("error")+" "+bundle.getString("cause")+"- "+e.getMessage(),""));

               bcontinue=false;
               return null;
    }



     if(bcontinue){
                 timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                  FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+file.getLength()+" "+bundle.getString("starting")+" "+bundle.getString("Blobdata")+" "+bundle.getString("in")+" "+bundle.getString("gallery")+" "+bundle.getString("as")+" ("+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+") "+"at"+" "+timeStamp,""));
     }else{
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("if")+" "+bundle.getString("already")+" "+bundle.getString("exists")+", "+bundle.getString("browse")+"/"+bundle.getString("search")+" "+bundle.getString("to")+", "+bundle.getString("locate")+" "+bundle.getString("and")+" "+bundle.getString("update")+"/"+bundle.getString("delete"),""));
     }
     //clear uploaded data otherwise another save will fail as detached entity
     this.clearUploadData();
     customIdentity.setHoldValue("");
     customIdentity.setHoldValue2("");
     customIdentity.setHoldValue3("");

     return "";
    }

    public String persistUpLoadedImageAsSystem(){

     bcontinue=true;
     this.getInstance();
     this.instance.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata"); 
     if (this.instance.getA1xxuxxxbv49xxxxxxxxfromkey() == null || this.instance.getA1xxuxxxbv49xxxxxxxxfromkey().isEmpty()){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("Image")+" "+bundle.getString("key")+" "+bundle.getString("value")+" "+bundle.getString("empty"),""));
      return null;
     }
     //can be theme or PIC
     if(yxxxuq1m1xwwqqqxxxxxclobdataHome.getContentTheme()!=null && !yxxxuq1m1xwwqqqxxxxxclobdataHome.getContentTheme().isEmpty() ){
     }else{
      this.instance.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
     }
     if(file.getLength() == 0){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("uploaded")+" "+bundle.getString("file")+" "+bundle.getString("is")+" "+bundle.getString("empty"),""));
      return null;
     }
     this.instance.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
     this.instance.setZzxxu2oxxhxxxxxxxxxxowner2("SYSTEM");
     yxxxuq1n1xwwqqqxxxxxblobdata=this.instance;
     try{
      this.persist("SYSTEM");//clob/blob persist does not give msg
     } catch (Exception e) {
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("cannot")+" "+ bundle.getString("save")+" "+bundle.getString("record")+" "+e.getMessage(),""));
     }
     if(bcontinue){
                 timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+file.getLength()+" "+bundle.getString("starting")+" "+bundle.getString("Blobdata")+" "+bundle.getString("in")+" "+bundle.getString("gallery")+" "+bundle.getString("as")+" ("+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+") "+"at"+" "+timeStamp,""));
     }else{
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("if")+" "+bundle.getString("already")+" "+bundle.getString("exists")+", "+bundle.getString("browse")+"/"+bundle.getString("search")+" "+bundle.getString("to")+", "+bundle.getString("locate")+" "+bundle.getString("and")+" "+bundle.getString("update")+"/"+bundle.getString("delete"),""));
     }
     //clear uploaded data otherwise another save will fail as detached entity
     this.clearUploadData();
     customIdentity.setHoldValue("");
     customIdentity.setHoldValue2("");
     customIdentity.setHoldValue3("");

     return "";
    }

    public String persistUpLoadedImageAndItem(String type,String parentKey){
     bcontinue=true;
     customIdentity.setKeyValue("");
     customIdentity.setKeyValue2("");
     customIdentity.setKeyValue3("");

    String[] holdKey;
    holdKey=new String[3];

     //create item instance along with docmnt key with prefix and then create blobdata instance with fromtable as item 
     // and fromkey as docmnt less prefix
    try{
     fpxxfq1a5xwwqqhxxxxxitem=fpxxfq1a5xwwqqhxxxxxitemHome.getInstance();
     fpxxfq1a5xwwqqhxxxxxitem.setZ2xxcsxrlxxxxxxxxxxxdateadded(calendar.getTime());
     //String aName=this.instance.getA1xxuxxxbv49xxxxxxxxfromkey();
     String aName=customIdentity.getHoldValue();
     if (type.equals("PI-D") && (aName == null || aName.isEmpty())){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("Image")+" "+bundle.getString("name")+" "+aName+" "+bundle.getString("empty"),""));
      return null;
     }
     if(type.equals("PI-L1")){
      aName=this.instance.getA0xxukbdlvxxxxxxxxxxfromtable();
     }
     if(type.equals("PI-L1") && aName.isEmpty()){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("Image")+" "+bundle.getString("album")+" "+aName+" "+bundle.getString("empty"),""));
      return null;
     }
     if(file.getLength() == 0){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("uploaded")+" "+bundle.getString("file")+" "+bundle.getString("is")+" "+bundle.getString("empty"),""));
      return null;
     }
     if(parentKey.isEmpty()){
      parentKey=overRideValue;
     }
     if ((parentKey == null || parentKey.isEmpty()) && type.equals("PI-D") ){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("Album")+" / "+bundle.getString("Category")+" "+bundle.getString("empty"),""));
      return null;
     }
                int i=0;
                Integer attachment=0;
                dataIsBlob = true;
                Iterator<File> itr = yxxxuq1n1xwwqqqxxxxxblobdataHome.getFiles().iterator();
                while (itr.hasNext()) {
                  subKey="";
                  file = itr.next();
                  //jay itr loop here based on number of file objects in files arraylist ie arraylist size
                  attachment++;
                  if(i==0){
                   if(type.equals("PI-D")){
                    aName=customIdentity.getHoldValue();
                   }
                  }
                  if(i==1){
                   aName=customIdentity.getHoldValue2();
                  }
                  if(i==2){
                   aName=customIdentity.getHoldValue3();
                  }
                  fpxxfq1a5xwwqqhxxxxxitemHome.clearInstance();
                  fpxxfq1a5xwwqqhxxxxxitem = fpxxfq1a5xwwqqhxxxxxitemHome.getInstance();
                  if(i==0){// moved here after instance gets created
                   if(yxxxuq1m1xwwqqqxxxxxclobdataHome.getContentVendor() !=null && !yxxxuq1m1xwwqqqxxxxxclobdataHome.getContentVendor().isEmpty()){
                    fpxxfq1a5xwwqqhxxxxxitem.setY2xxuxxrbvxxxxxxxxxxmisccode1(yxxxuq1m1xwwqqqxxxxxclobdataHome.getContentVendor()); 
                    fpxxfq1a5xwwqqhxxxxxitem.setY3xxuxxrbvxxxxxxxxxxmisccode2(yxxxuq1m1xwwqqqxxxxxclobdataHome.getContentTheme()); 
                   } 
                  }
                  fpxxfq1a5xwwqqhxxxxxitem.setB1xxuszsbvxxxxxxxxxxdescript(aName); 
                  fpxxfq1a5xwwqqhxxxxxitem.setC6xxusxrbv16xxxxxxxxtype(type);
                  subKey=subKey+aName+type;
                  timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
                  subKey=subKey+timeStamp.substring(17,18);
                  subKey=subKey+fpxxfq1a5xwwqqhxxxxxitem.getZ2xxcsxrlxxxxxxxxxxxdateadded().toString().substring(0,10)+fpxxfq1a5xwwqqhxxxxxitem.getZ2xxcsxrlxxxxxxxxxxxdateadded().toString().substring(fpxxfq1a5xwwqqhxxxxxitem.getZ2xxcsxrlxxxxxxxxxxxdateadded().toString().length()-6);
                  int subL=subKey.length();
                  if (subL !=0){
                   String subKeyh=Integer.toString(subKey.hashCode());
                   if (subL > 25){
                    subKey=subKey.substring(0,11)+subKey.substring(subL-5,subL)+subKeyh;
                   }
                   else {
                    subKey=subKey+subKeyh;
                   }
                  }

                  key=subKey;
                  if (key.length() > 32){
                   key=key.substring(0,32);
                  }
                  fpxxfq1a5xwwqqhxxxxxitem.setA0xxukixbxxxxxxxxxxxmatcode(key); 
                  slobkeyhash=Integer.toString(key.hashCode());
                  holdKey[i]=slobkeyhash;
                  fpxxfq1a5xwwqqhxxxxxitem.setW8xxuzdrbvxxxxxxxxxxdocmnt("B"+slobkeyhash); 
                  if(type.equals("PI-D")){
                   fpxxfq1a5xwwqqhxxxxxitem.setFpxxfq1a5xwwqqhxxxxxitem(fpxxfq1a5xwwqqhxxxxxitemList.getKeyToEntity(parentKey)); 
                  }     
                  //fpxxfq1a5xwwqqhxxxxxitem.setZzxxu2oxxhxxxxxxxxxxowner2("SYSTEM");//only themes need shared
                  fpxxfq1a5xwwqqhxxxxxitemHome.setInstance(fpxxfq1a5xwwqqhxxxxxitem);  

                  fpxxfq1a5xwwqqhxxxxxitemHome.superdotpersist();// use superdot to avoid persist has a loop to persist blob
                  if(bcontinue){
                   timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                   FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                    FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+bundle.getString("item")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+key+") "+"at"+" "+timeStamp,""));
                  }

                  i++;// 
                }


    } catch ( Exception e){
         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
            FacesMessage.SEVERITY_INFO," "+"Item"+" "+" "+bundle.getString("key")+" "+ bundle.getString("error")+" "+bundle.getString("cause")+"- "+e.getMessage(),""));


               bcontinue=false;
               return null;
    }
   // now take care of related clob/blob
    try{
                int i=0;
                Integer attachment=0;
                dataIsBlob = true;
                  Iterator<File> itr = this.getFiles().iterator();
                while (itr.hasNext()) {
                  file = itr.next();
                  //jay itr loop here based on number of file objects in files arraylist ie arraylist size
                  attachment++;
                  yxxxuq1n1xwwqqqxxxxxblobdataHome.clearInstance();
                  yxxxuq1n1xwwqqqxxxxxblobdata = yxxxuq1n1xwwqqqxxxxxblobdataHome.getInstance();
                  yxxxuq1n1xwwqqqxxxxxblobdataHome.setInstance(yxxxuq1n1xwwqqqxxxxxblobdata);
                  yxxxuq1n1xwwqqqxxxxxblobdata.setA0xxukbdlvxxxxxxxxxxfromtable("FPXXFQ1A5XWWQQHXXXXXITEM");
                  yxxxuq1n1xwwqqqxxxxxblobdata.setA1xxuxxxbv49xxxxxxxxfromkey(holdKey[i]);
                  yxxxuq1n1xwwqqqxxxxxblobdata.setA2xxuxxxbv50xxxxxxxxqualifier("1");
                  yxxxuq1n1xwwqqqxxxxxblobdata.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
                  if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() !=null && !yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                   yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                  }
                  if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() !=null && yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                   //replace beyond asis with new type if any
                   yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype("asis"+lobDataType);
                  }
                  if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() ==null ){   
                   yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                  }

                  yxxxuq1n1xwwqqqxxxxxblobdataHome.superdotpersist();// persist has a loop to persist blob
                  if(i==0){
                    customIdentity.setKeyValue(holdKey[i]);
                  }
                  if(i==1){
                   customIdentity.setKeyValue2(holdKey[i]);
                  }
                  if(i==2){
                   customIdentity.setKeyValue3(holdKey[i]);
                  }

                  i++;// 
                }

    } catch ( Exception e){
         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
           FacesMessage.SEVERITY_INFO," "+"Image"+" "+" "+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+" "+ bundle.getString("error")+" "+bundle.getString("cause")+"- "+e.getMessage(),""));

               bcontinue=false;
               return null;
    }
     if(bcontinue){
                 timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                    FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+this.getFiles().size()+" "+bundle.getString("starting")+" "+bundle.getString("Blobdata")+" "+bundle.getString("in")+" "+bundle.getString("gallery")+" "+bundle.getString("as")+" ("+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+") "+"at"+" "+timeStamp,""));

     }
     //clear uploaded data otherwise another save will fail as detached entity
     this.clearUploadData();
     customIdentity.setHoldValue("");
     customIdentity.setHoldValue2("");
     customIdentity.setHoldValue3("");
     return "";
    }

    public String persistUpLoadedImageAsMember(){
    //not used but seems meant for shared images
     bcontinue=true;
     this.getInstance();
     this.instance.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata"); 
     if (this.instance.getA1xxuxxxbv49xxxxxxxxfromkey() == null || this.instance.getA1xxuxxxbv49xxxxxxxxfromkey().isEmpty()){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("Image")+" "+bundle.getString("key")+" "+bundle.getString("value")+" "+bundle.getString("empty"),""));
      return null;
     }
     this.instance.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
                  if(this.getFiles().size() == 0){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("uploaded")+" "+bundle.getString("file")+" "+bundle.getString("is")+" "+bundle.getString("empty"),""));
      return null;
     }
     this.instance.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
     this.instance.setZzxxu2oxxhxxxxxxxxxxowner2("SYSTEM");
     yxxxuq1n1xwwqqqxxxxxblobdata=this.instance;
     this.persist("SYSTEM");//clob/blob persist does not give msg
     if(bcontinue){
                 timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+bundle.getString("Blobdata")+" "+bundle.getString("in")+" "+bundle.getString("gallery")+" "+bundle.getString("as")+" ("+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+") "+"at"+" "+timeStamp,""));
     }
     //clear uploaded data otherwise another save will fail as detached entity
     this.clearUploadData();
     return "";
    }

    public String persistUpLoadedImage() {
     bcontinue=true;
     this.getInstance();
     this.instance.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata"); 
     if (this.instance.getA1xxuxxxbv49xxxxxxxxfromkey() == null || this.instance.getA1xxuxxxbv49xxxxxxxxfromkey().isEmpty()){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("Image")+" "+bundle.getString("key")+" "+bundle.getString("value")+" "+bundle.getString("empty"),""));
      return null;
     }
     this.instance.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
                  if(this.getFiles().size() == 0){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("uploaded")+" "+bundle.getString("file")+" "+bundle.getString("is")+" "+bundle.getString("empty"),""));
      return null;
     }
     this.instance.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
     yxxxuq1n1xwwqqqxxxxxblobdata=this.instance;
     try{
      this.persist();//clob/blob persist does not give msg
     } catch (Exception e) {
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("cannot")+" "+ bundle.getString("save")+" "+bundle.getString("record")+" "+e.getMessage(),""));
     }
     if(bcontinue){
      timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+bundle.getString("Blobdata")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+") "+"at"+" "+timeStamp,""));
     }else{
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("if")+" "+bundle.getString("already")+" "+bundle.getString("exists")+", "+bundle.getString("browse")+"/"+bundle.getString("search")+" "+bundle.getString("to")+", "+bundle.getString("locate")+" "+bundle.getString("and")+" "+bundle.getString("update")+"/"+bundle.getString("delete"),""));
     }
     //clear uploaded data otherwise another save will fail as detached entity
     this.clearUploadData();
     return "";
    }

    public String persistUpLoadedImages() {
     bcontinue=true;
     customIdentity.setKeyValue("");//clear any old image key values
     customIdentity.setKeyValue2("");
     customIdentity.setKeyValue3("");

     String aName=customIdentity.getHoldValue();
     if (aName == null || aName.isEmpty()){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("Image")+" "+bundle.getString("name")+" "+aName+" "+bundle.getString("empty"),""));
      return null;
     }
                  if(this.getFiles().size() == 0){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_ERROR,bundle.getString("uploaded")+" "+bundle.getString("file")+" "+bundle.getString("is")+" "+bundle.getString("empty"),""));
      return null;
     }
    try{
                int i=0;
                String type="";

                Integer attachment=0;
                dataIsBlob = true;
                  Iterator<File> itr = this.getFiles().iterator();
                while (itr.hasNext()) {
                          file = itr.next();
                          temps=file.getMime();
			  if ("image/bmp".equals(temps)) {
				lobDataType = "bmp";
			  } else if ("image/jpeg".equals(temps)) {
				lobDataType = "jpg";
			  } else if ("image/gif".equals(temps)) {
				lobDataType = "gif";
			  } else if ("image/png".equals(temps)) {
				lobDataType = "png";
			  } else if ("text/xml".equals(temps)) {
				lobDataType = "xml";
			  } else if ("application/msword".equals(temps)) {
				lobDataType = "doc";
			  } else if ("text/plain".equals(temps)) {
				lobDataType = "txt";
			  } else if ("text/html".equals(temps)) {
				lobDataType = "html";
			  } else if ("application/pdf".equals(temps)) {
				lobDataType = "pdf";
			  } else if ("application/vnd.ms-excel".equals(temps)) {
				lobDataType = "xls";
			  } else if ("application/vnd.ms-powerpoint".equals(temps)) {
				lobDataType = "ppt";
			 } else if ("audio/mpeg".equals(temps)) {
				lobDataType = "mp3";
			 } else if ("video/mp4".equals(temps)) {
				lobDataType = "mp4";
			 } else {
				lobDataType = "unkn";
			 }

                  subKey="";
                  type=lobDataType;
                  //jay itr loop here based on number of file objects in files arraylist ie arraylist size
                  if(i==0){
                    aName=customIdentity.getHoldValue();
                  }
                  if(i==1){
                   aName=customIdentity.getHoldValue2();
                  }
                  if(i==2){
                   aName=customIdentity.getHoldValue3();
                  }
                  subKey=subKey+aName+type;
                  timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
                  subKey=subKey+timeStamp.substring(17,18);
                  int subL=subKey.length();
                  if (subL !=0){
                   String subKeyh=Integer.toString(subKey.hashCode());
                   if (subL > 25){
                    subKey=subKey.substring(0,11)+subKey.substring(subL-5,subL)+subKeyh;
                   }
                   else {
                    subKey=subKey+subKeyh;
                   }
                  }

                  key=subKey;
                  if (key.length() > 32){
                   key=key.substring(0,32);
                  }
                  if( (aName+Integer.toString(key.hashCode())).length() >35){
                   slobkeyhash=(aName+Integer.toString(key.hashCode())).substring(0,34);
                  }else{
                   slobkeyhash=aName+Integer.toString(key.hashCode());
                  }
                  attachment++;
                  yxxxuq1n1xwwqqqxxxxxblobdataHome.clearInstance();
                 yxxxuq1n1xwwqqqxxxxxblobdata = yxxxuq1n1xwwqqqxxxxxblobdataHome.getInstance();
                 yxxxuq1n1xwwqqqxxxxxblobdataHome.setInstance(yxxxuq1n1xwwqqqxxxxxblobdata);
                 yxxxuq1n1xwwqqqxxxxxblobdata.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata");
                 yxxxuq1n1xwwqqqxxxxxblobdata.setA1xxuxxxbv49xxxxxxxxfromkey(slobkeyhash);
                 yxxxuq1n1xwwqqqxxxxxblobdata.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
                  yxxxuq1n1xwwqqqxxxxxblobdata.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
                  if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() !=null && !yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                   yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                  }
                  if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() !=null && yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype().toLowerCase().contains("asis")){   
                   //replace beyond asis with new type if any
                   yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype("asis"+lobDataType);
                  }
                  if(yxxxuq1n1xwwqqqxxxxxblobdata.getA4xxexxxbvxxxxxxxxxxtype() ==null ){   
                   yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
                  }

                  yxxxuq1n1xwwqqqxxxxxblobdataHome.superdotpersist();// persist has a loop to persist blob

                  if(i==0){
                    customIdentity.setKeyValue(slobkeyhash);
                  }
                  if(i==1){
                   customIdentity.setKeyValue2(slobkeyhash);
                  }
                  if(i==2){
                   customIdentity.setKeyValue3(slobkeyhash);
                  }

                  i++;// 
                }

    } catch ( Exception e){
         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO," "+"Image"+" "+" "+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+" "+ bundle.getString("error")+" "+bundle.getString("cause")+"- "+e.getMessage(),""));

               bcontinue=false;
               return null;
    }



     if(bcontinue){
                 timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("saved")+" "+this.getFiles().size()+" "+bundle.getString("starting")+" "+bundle.getString("Blobdata")+" "+bundle.getString("in")+" "+bundle.getString("gallery")+" "+bundle.getString("as")+" ("+this.instance.getA1xxuxxxbv49xxxxxxxxfromkey()+") "+"at"+" "+timeStamp,""));

     }else{
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("if")+" "+bundle.getString("already")+" "+bundle.getString("exists")+", "+bundle.getString("browse")+"/"+bundle.getString("search")+" "+bundle.getString("to")+", "+bundle.getString("locate")+" "+bundle.getString("and")+" "+bundle.getString("update")+"/"+bundle.getString("delete"),""));
     }
     //clear uploaded data otherwise another save will fail as detached entity
     this.clearUploadData();
     customIdentity.setHoldValue("");
     customIdentity.setHoldValue2("");
     customIdentity.setHoldValue3("");

     return "";
    }

    public String makeTempGraphicsFromTheme(String theme,String position){
            //try both seq 1 and 2
            // source(blobdata)  is system and qualifier as theme name and key XX-M , target(current) is owner2 site, qualifier PIC and key XX-M
            try{
             Yxxxuq1n1xwwqqqxxxxxblobdata blobdata = yxxxuq1n1xwwqqqxxxxxblobdataList.getSystemBlobDataInstance("blobdata",position,theme,1);
             if (blobdata == null){
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("nothing")+" "+bundle.getString("to")+" "+bundle.getString("load")+" "+bundle.getString("from")+" "+theme+" "+", "+position+" "+bundle.getString("seq 1"),""));
             }else{
              Yxxxuq1n1xwwqqqxxxxxblobdata current = yxxxuq1n1xwwqqqxxxxxblobdataList.getUserBlobDataInstance("blobdata",position,"PIC",1);
              if (current == null){
               // create if does not exist
               this.clearInstance();
               current=this.getInstance(); 
               current.setB1xxuzbxbvxxxxxxxxxxdata(blobdata.getB1xxuzbxbvxxxxxxxxxxdata());
               current.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata");
               current.setA1xxuxxxbv49xxxxxxxxfromkey(position.substring(1));
               current.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
               current.setA3xxexnsbvxxxxxxxxxxsequence(1);
               current.setA4xxexxxbvxxxxxxxxxxtype(blobdata.getA4xxexxxbvxxxxxxxxxxtype());
               current.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
               current.setZ3xxutoxlhxxxxxxxxxxowner(ownerCode);
               current.setZzxxu2oxxhxxxxxxxxxxowner2(owner2Code);
               this.setInstance(current);
               this.persist();
              }else{
                current.setB1xxuzbxbvxxxxxxxxxxdata(blobdata.getB1xxuzbxbvxxxxxxxxxxdata());
                current.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
                this.setInstance(current);
                superdotupdate();
              }
              timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
              FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("copied")+" "+bundle.getString("image1")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+position+") "+"at"+" "+timeStamp,""));
             }
            }
            catch ( Exception e){
            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("load")+" "+bundle.getString("theme")+" "+bundle.getString("image1")+" "+bundle.getString("error")+" "+e.getMessage(),""));
            }  
            //seq 2
            try{
             Yxxxuq1n1xwwqqqxxxxxblobdata blobdata = yxxxuq1n1xwwqqqxxxxxblobdataList.getSystemBlobDataInstance("blobdata",position,theme,2);
             if (blobdata == null){
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("nothing")+" "+bundle.getString("to")+" "+bundle.getString("load")+" "+bundle.getString("from")+" "+theme+" "+", "+position+" "+bundle.getString("seq 2"),""));
              return "";
             }
             Yxxxuq1n1xwwqqqxxxxxblobdata current = yxxxuq1n1xwwqqqxxxxxblobdataList.getUserBlobDataInstance("blobdata",position,"PIC",2);
             if (current == null){
              // create if does not exist
              this.clearInstance();
	      current=this.getInstance(); 
              current.setB1xxuzbxbvxxxxxxxxxxdata(blobdata.getB1xxuzbxbvxxxxxxxxxxdata());
              current.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata");
              current.setA1xxuxxxbv49xxxxxxxxfromkey(position.substring(1));
              current.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
              current.setA3xxexnsbvxxxxxxxxxxsequence(2);
              current.setA4xxexxxbvxxxxxxxxxxtype(blobdata.getA4xxexxxbvxxxxxxxxxxtype());
              current.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
              current.setZ3xxutoxlhxxxxxxxxxxowner(ownerCode);
              current.setZzxxu2oxxhxxxxxxxxxxowner2(owner2Code);
              this.setInstance(current);
              this.persist();
             }else{
              current.setB1xxuzbxbvxxxxxxxxxxdata(blobdata.getB1xxuzbxbvxxxxxxxxxxdata());
              current.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
              this.setInstance(current);
              superdotupdate();
             }
             timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss z").format(new Date());
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("copied")+" "+bundle.getString("image2")+" "+bundle.getString("reference")+" "+bundle.getString("as")+" ("+position+") "+"at"+" "+timeStamp,""));
             return "";
            }
            catch ( Exception e){
            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("load")+" "+bundle.getString("theme")+" "+bundle.getString("graphics")+" "+bundle.getString("error")+" "+e.getMessage(),""));
             return "";
            }  

    }

    // SYSTEM record 0 is shared, so tenants own record 0 must be used 
    // create if tenant record does not exist, blobdata refers to the mockUp row being copied and position contains key with _M ie mockUp
    //not used
  
    public String makeTempGraphics(Yxxxuq1n1xwwqqqxxxxxblobdata blobdata, String position) {
            Yxxxuq1n1xwwqqqxxxxxblobdata current = yxxxuq1n1xwwqqqxxxxxblobdataList.getUserBlobDataInstance("blobdata",position,"PIC",0);
            try{
             if (current == null){
              // create under tenant 1st time only
              this.clearInstance();
	         current=this.getInstance(); 
              current.setB1xxuzbxbvxxxxxxxxxxdata(blobdata.getB1xxuzbxbvxxxxxxxxxxdata());
              current.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata");
              current.setA1xxuxxxbv49xxxxxxxxfromkey(position.substring(1));
              current.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
              current.setA3xxexnsbvxxxxxxxxxxsequence(0);
              current.setA4xxexxxbvxxxxxxxxxxtype(blobdata.getA4xxexxxbvxxxxxxxxxxtype());
              current.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
              current.setZ3xxutoxlhxxxxxxxxxxowner(ownerCode);
              current.setZzxxu2oxxhxxxxxxxxxxowner2(owner2Code);
              //current.setY3xxuxznbvxxxxxxxxxxnotes("\u2605"+ blobdata.getA3xxexnsbvxxxxxxxxxxsequence());
              this.persist();
              customIdentity.setMsgTempKey(position);
              customIdentity.setMsgPermKey(position.substring(0,position.length()-1)+"C");
              this.position=position;
              return "";
             }else{
              current.setB1xxuzbxbvxxxxxxxxxxdata(blobdata.getB1xxuzbxbvxxxxxxxxxxdata());
              current.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
              current.setY3xxuxznbvxxxxxxxxxxnotes(current.getY3xxuxznbvxxxxxxxxxxnotes()+ "\u2605"+ blobdata.getA3xxexnsbvxxxxxxxxxxsequence());
              superdotupdate();
              customIdentity.setMsgTempKey(position);
              customIdentity.setMsgPermKey(position.substring(0,position.length()-1)+"C");
              this.position=position;
              return "";
             }
            }
            catch ( Exception e){
        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("make")+" "+bundle.getString("temp")+" "+bundle.getString("graphics")+" "+bundle.getString("error")+" "+e.getMessage(),""));

             return "";
            }  

    }
    public String makePermGraphicsAll(String position) {
     //getAllResultListSeqs for -M and use for loop
     // call makePermGraphics(Yxxxuq1n1xwwqqqxxxxxblobdata blobdata,String position)
     // blobdata is -M and position has -C
     return "";
    }

    // create if tenant record does not exist  but position contains key with _C ie Current record for display outside MockUp
    // postion has -C and blobdata has -M 
    public String makePermGraphics(Yxxxuq1n1xwwqqqxxxxxblobdata blobdata, String position) {
            Yxxxuq1n1xwwqqqxxxxxblobdata current = yxxxuq1n1xwwqqqxxxxxblobdataList.getUserBlobDataInstance("blobdata",position,"PIC",blobdata.getA3xxexnsbvxxxxxxxxxxsequence());
            try{
             if (current == null){
              // create under tenant 1st time only
              this.clearInstance();
	      current=this.getInstance(); 
              current.setB1xxuzbxbvxxxxxxxxxxdata(blobdata.getB1xxuzbxbvxxxxxxxxxxdata());
              current.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata");
              current.setA1xxuxxxbv49xxxxxxxxfromkey(position.substring(1));
              current.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
              current.setA3xxexnsbvxxxxxxxxxxsequence(blobdata.getA3xxexnsbvxxxxxxxxxxsequence());
              current.setA4xxexxxbvxxxxxxxxxxtype(blobdata.getA4xxexxxbvxxxxxxxxxxtype());
              current.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
              current.setZ3xxutoxlhxxxxxxxxxxowner(ownerCode);
              current.setZzxxu2oxxhxxxxxxxxxxowner2(owner2Code);
              this.persist();
              customIdentity.setMsgTempKey(position);
              this.position=position;
             }else{
              current.setB1xxuzbxbvxxxxxxxxxxdata(blobdata.getB1xxuzbxbvxxxxxxxxxxdata());
              current.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
              this.setInstance(current);
              superdotupdate();
              customIdentity.setMsgTempKey(position);
              this.position=position;
             }
             customIdentity.setMsgPermKey(position.substring(0,position.length()-1)+"C");
             return "";
            }
            catch ( Exception e){
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("make")+" "+bundle.getString("permanent")+" "+bundle.getString("graphics")+" "+bundle.getString("error")+" "+e.getMessage(),""));

             return "";
            }  
    }
    //not used
    public void setAsPermTempMsgKeys(String position) {
      customIdentity.setMsgPermKey(position.substring(0,position.length()-1)+"C");
      customIdentity.setMsgTempKey(position.substring(0,position.length()-1)+"M");
    }


    public String makeNoPreviewImageAll(String position) {
     //getAllResultListSeqs for -M and use for loop
     // call makeNoPrevieImage(Yxxxuq1n1xwwqqqxxxxxblobdata blobdata,String position)
     // blobdata is -M and position has -C
     return "";
    }
    // remove data for both -M and -C , blobdata has -M remove it first, position has -C so fetch it and remove it next
    public String makeNoPreviewImage(Yxxxuq1n1xwwqqqxxxxxblobdata blobdata,String position) {
            // remove param1 which points to _M  and remove it first
            int jay=blobdata.getA3xxexnsbvxxxxxxxxxxsequence();
            this.clearInstance();
            this.setInstance(blobdata);
            superdotremove();
            Yxxxuq1n1xwwqqqxxxxxblobdata current = yxxxuq1n1xwwqqqxxxxxblobdataList.getUserBlobDataInstance("blobdata",position,"PIC",jay);
            try{
             if (current == null){
        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("cannot")+" "+bundle.getString("find")+" "+position+" "+bundle.getString("sequence")+" "+jay,""));

               return "";
             }else{
              this.clearInstance();
              this.setInstance(current);
              superdotremove();
              return "";
             }
            }
            catch ( Exception e){
        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("remove")+" "+bundle.getString("preview")+" "+bundle.getString("error")+" "+e.getMessage(),""));
             return "";
            }  

    
    }
    //not used makeNoPreview does both now
    public String makeNoImage(Yxxxuq1n1xwwqqqxxxxxblobdata blobdata,String position) {
            Yxxxuq1n1xwwqqqxxxxxblobdata current = yxxxuq1n1xwwqqqxxxxxblobdataList.getUserBlobDataInstance("blobdata",position,"PIC",blobdata.getA3xxexnsbvxxxxxxxxxxsequence());
            try{
             if (current == null){
              FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("cannot")+" "+bundle.getString("find")+" "+position+" "+bundle.getString("sequence")+" "+blobdata.getA3xxexnsbvxxxxxxxxxxsequence(),""));
               return "";
             }else{
               current.setB1xxuzbxbvxxxxxxxxxxdata(null);
               current.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
               superdotupdate();
               customIdentity.setMsgTempKey(position);
               this.position=position;
               return "";
             }
            }
            catch ( Exception e){
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("make")+" "+bundle.getString("no")+" "+bundle.getString("preview")+" "+bundle.getString("error")+" "+e.getMessage(),""));
             return "";
            }  
   
    }



    /**
    * The following method creates a new preview instance
    * @param args position and from. postion refers to key like B3R-NEWS-1-M and from is used to return back to from page (not     * used)
    * @return blobedit page or empty if error
    * @exception instance creation error.
    * @see 
    * added logic to check and add -M if only -C exists
    */ 
    public String newEntry(String position, String from) {
            Yxxxuq1n1xwwqqqxxxxxblobdata current = null;
            try{
              this.clearInstance();
              current=this.getInstance(); 
              current.setB1xxuzbxbvxxxxxxxxxxdata(null);
              current.setA0xxukbdlvxxxxxxxxxxfromtable("blobdata");
              current.setA1xxuxxxbv49xxxxxxxxfromkey(position.substring(1));
              current.setA2xxuxxxbv50xxxxxxxxqualifier("PIC");
              int jay=0;
              if(position.contains("3R-TOP-BKGR")){
               jay=  yxxxuq1n1xwwqqqxxxxxblobdataList.getNextSeqAvailable("blobdata",position,"PIC",1);
              }else{
               jay=  yxxxuq1n1xwwqqqxxxxxblobdataList.getNextSeqAvailable("blobdata",position,"PIC",0);
              }
              if(jay <0 ){
               FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                 FacesMessage.SEVERITY_WARN,bundle.getString("invalid")+" "+ bundle.getString("sequence")+" "+Integer.toString(jay),""));
               return "";
              }
              if(position.contains("3R-TOP-BKGR")){
               if(jay ==0 || (jay >0 && !(jay ==1 || jay ==2))){
                FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                   FacesMessage.SEVERITY_WARN,bundle.getString("invalid")+" "+ bundle.getString("sequence")+" "+Integer.toString(jay),""));

                FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                   FacesMessage.SEVERITY_INFO,bundle.getString("use")+" "+ bundle.getString("sequence")+" 1 "+bundle.getString("or")+" "+bundle.getString("sequence")+" 2 "+" "+bundle.getString("only"),""));
                return "";
               }else{
                FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                   FacesMessage.SEVERITY_INFO,bundle.getString("for")+" "+ bundle.getString("fadeout")+" "+ bundle.getString("effect")+" "+ bundle.getString("put")+" "+ bundle.getString("type")+" "+ bundle.getString("as")+" "+bundle.getString("asis"),""));
               }
              }else{
               if(jay <0 || jay > 4  ){
                FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("use")+" "+ bundle.getString("sequence")+" 0 "+bundle.getString("to")+" 4 ",""));

                return "";
               }
              }

              current.setA3xxexnsbvxxxxxxxxxxsequence(jay);
              if(current.getA4xxexxxbvxxxxxxxxxxtype()!=null && !current.getA4xxexxxbvxxxxxxxxxxtype().isEmpty()){
               current.setA4xxexxxbvxxxxxxxxxxtype("jpg");
              }
              current.setZ2xxcztxlxxxxxxxxxxxstatusfldt(Calendar.getInstance().getTime());
              current.setZ3xxutoxlhxxxxxxxxxxowner(ownerCode);
              current.setZzxxu2oxxhxxxxxxxxxxowner2(owner2Code);
              //set this here as well so that persist knows request came from here
              yxxxuq1n1xwwqqqxxxxxblobdataFrom="homeMockUp";
              this.persist();
              this.upLoadPurpose="re";
              return "/blobdataEdit.xhtml?faces-redirect=true&includeViewParams=true";
            }
            catch ( Exception e){
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                FacesMessage.SEVERITY_ERROR,bundle.getString("create")+" "+ bundle.getString("new")+" "+bundle.getString("error")+" "+e.getMessage(),""));
             return "";
            }  

    }




         public byte[] getSystemBlobdata(String table,String keyWPrefix,String keyQualifier,int keySequence) {
           //no need to use since system default images are not used switching to client images preinstalled
           // based on type
           String actualTable=table;
           if(keyWPrefix.length() > 0){
            slobkeyhash = keyWPrefix.substring(1);
           }else{
            return null;
           }
           String qualifier = keyQualifier;
           int sequence = keySequence;
           try {
               Yxxxuq1n1xwwqqqxxxxxblobdata blobdata=null;
		    List<Yxxxuq1n1xwwqqqxxxxxblobdata> results = entityManager
					.createQuery(
							"select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where cc.a0xxukbdlvxxxxxxxxxxfromtable=:blobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:blobdatafromkey and cc.a2xxuxxxbv50xxxxxxxxqualifier=:blobdataqualifier and cc.a3xxexnsbvxxxxxxxxxxsequence = :blobdatasequence and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
					           .setParameter("blobdatafromtable", actualTable).setParameter(
							"blobdatafromkey", slobkeyhash).setParameter(
							"blobdataqualifier", qualifier).setParameter(
							"blobdatasequence", sequence).setParameter("owner2", "SYSTEM").getResultList();
		     if(!results.isEmpty()){
                 return results.get(0).getB1xxuzbxbvxxxxxxxxxxdata();
                }
                 return null;
           } catch (NoResultException nre) {
			return null;
          }
         }




public boolean isBitSet(Integer a, Integer n){ 
 if (a == null){
  a=0;
 }
 return (a & (1 << n)) != 0; 
}





// set initCap via client, make it true now
        public boolean initCap() {
         //jay add logic to check client table if initCap is on or not
            return true;
        }




public boolean duplicateClobBlobExists(String entityName,String key,String qualifier,int sequence){
 //clobblob allows same key but different qualifier or seq. example multiple images for an item
 //should be used before calling superdotPersist
	try {
                   if (entityName.equals("blobdata")){
                        List<Yxxxuq1n1xwwqqqxxxxxblobdata> results= entityManager
                         .createQuery(
                          "select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where lower(cc.a0xxukbdlvxxxxxxxxxxfromtable) = :keyOfEntity   AND cc.a2xxuxxxbv50xxxxxxxxqualifier=:qualifier AND cc.a3xxexnsbvxxxxxxxxxxsequence=:sequence AND cc.zzxxu2oxxhxxxxxxxxxxowner2=:owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
                          .setParameter("keyOfEntity", key).setParameter("qualifier", qualifier).setParameter("sequence", sequence).setParameter("owner2", owner2Code)
                          .getResultList();
                        if(!results.isEmpty()){
                         return true;
                        }else{
                         return false;
                        }
                   }
                   if (entityName.equals("clobdata")){
                        List<Yxxxuq1n1xwwqqqxxxxxblobdata> results= entityManager
                         .createQuery(
                          "select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where lower(cc.a0xxukbdlvxxxxxxxxxxfromtable) = :keyOfEntity   AND cc.a2xxuxxxbv50xxxxxxxxqualifier=:qualifier AND cc.a3xxexnsbvxxxxxxxxxxsequence=:sequence AND cc.zzxxu2oxxhxxxxxxxxxxowner2=:owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
                          .setParameter("keyOfEntity", key).setParameter("qualifier", qualifier).setParameter("sequence", sequence).setParameter("owner2", owner2Code)
                          .getResultList();
                        if(!results.isEmpty()){
                         return true;
                        }else{
                         return false;
                        }
                   }
                   return false;
                  } catch (NoResultException e) {
                   FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                    FacesMessage.SEVERITY_WARN,bundle.getString("key")+" "+ key+" "+bundle.getString("error")+" "+bundle.getString("in")+" "+bundle.getString("key")+" "+bundle.getString("exists")+" "+bundle.getString("check")+", "+ bundle.getString("cause")+" "+ e.getMessage(),""));

                   return true;
                  }

 
}

public boolean keyExists(String key){
                //key has companyName or lastname+random or companyName or lastname+firstName+random, so if say first 8 chrs match to existing key then possible dupl
                // first 8 chosen rather than 16 to avoid short last and first names having random ss in key 
                // but need to check farther using email if present or phone # 
                // in case of import we need more checking
                String jay="";
                 key=key.substring(0,7).toLowerCase();
                 Yxxxuq1n1xwwqqqxxxxxblobdata cc = this.getInstance();
	try {
                        List<Yxxxuq1n1xwwqqqxxxxxblobdata> results= entityManager
                         .createQuery(
                          "select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where lower(cc.a0xxukbdlvxxxxxxxxxxfromtable) like :keyOfEntity AND cc.zzxxu2oxxhxxxxxxxxxxowner2=:owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
                          .setParameter("keyOfEntity", key+"%").setParameter("owner2", owner2Code)
                          .getResultList();
                        if(!results.isEmpty()){
                         // loop through and pick most likely one ie check last name and first name
                         for (Yxxxuq1n1xwwqqqxxxxxblobdata yxxxuq1n1xwwqqqxxxxxblobdatak : results) {
                          if (yxxxuq1n1xwwqqqxxxxxblobdatak != null) {
                           // cannot be sure yet can add other phones later
                            return false;
                           }
                         }
			}
                       } catch (NoResultException nre) {
                         // that's fine - It should not exist.
                         // added extra logic to check other fields like say email exist 
                          
                } catch ( Exception e){
                  // error consider as dupilcate and skip   
                  FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                   FacesMessage.SEVERITY_WARN,bundle.getString("key")+" "+ key+" "+bundle.getString("error")+" "+bundle.getString("in")+" "+bundle.getString("key")+" "+bundle.getString("exists")+" "+bundle.getString("check")+", "+ bundle.getString("cause")+" "+ e.getMessage(),""));

                  return true;
                }
                return false;

}



//yxxxuq1n1xwwqqqxxxxxblobdata
	public void validateKeyDuplicateFromtable(FacesContext context,UIComponent toValidate,Object value) {

            String enteredValue = (String) value;
            Yxxxuq1n1xwwqqqxxxxxblobdata cc = this.getInstance();
            if (this.isManaged()){
             return;
            }
            // if composite natural key like in resource we need multiple field check
            // rate table do not check via jsf
            // check for dup stepname, if dupl and step also dupl then reject in persist logic
            // jay to add
 
	      try {
			Yxxxuq1n1xwwqqqxxxxxblobdata cc1 = (Yxxxuq1n1xwwqqqxxxxxblobdata) entityManager.createQuery("select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where cc.a0xxukbdlvxxxxxxxxxxfromtable = :keyOfEntity AND cc.zzxxu2oxxhxxxxxxxxxxowner2=:owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
				.setParameter("keyOfEntity", enteredValue).setParameter("owner2", owner2Code).getSingleResult();
			if (cc1 != null ) {
                         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                            FacesMessage.SEVERITY_WARN,bundle.getString("entered")+" "+bundle.getString("key")+" "+ bundle.getString("already")+" "+ bundle.getString("exists"),""));

			 throw new ValidatorException(msg);

			     // that's bad - It should not exist if add ie not managed
			}
	      } catch (NoResultException nre) {
		// Ok		throw new ValidatorException(new FacesMessage("Does not exist"));
              } catch (Exception e) {
                  FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                    FacesMessage.SEVERITY_ERROR,bundle.getString("duplicate")+" "+bundle.getString("key")+" "+bundle.getString("check")+" "+bundle.getString("failed")+" " + e.getMessage(),""));
                throw new ValidatorException(msg);
              }

	}









    public String more() {
    
  // 1N now a new item may be selected, so clear the old item values

     totaldel=new BigDecimal("0.0");
     totalmis=new BigDecimal("0.0");
     // make a new method describeStatus(int status)
       if(!isBitSet(this.instance.getZ1xxzzfxhhxxxxxxxxxxstatusfl(),_mactive) && this.getLastItemLine() == 2){ 
        if (customIdentity.isDebug()){ 
         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          FacesMessage.SEVERITY_INFO,bundle.getString("Further")+ " "+bundle.getString("edit")+ " "+bundle.getString("not")+" "+bundle.getString("allowed")+ ", "+bundle.getString("current")+ " "+bundle.getString("status")+" "+describeStatus(this.instance.getZ1xxzzfxhhxxxxxxxxxxstatusfl()),""));
        }  
        return null;
       }
     totalbaseamt=new BigDecimal("0.0");
     moreActive=true;
     nextShow=true;
     if(!restEntity && !cartPoStatus.equals("e")){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_INFO,bundle.getString("Manual")+ " "+bundle.getString("adjustment")+ " "+bundle.getString("fields")+" "+bundle.getString("like")+ " "+bundle.getString("MiscCharges")+ " "+bundle.getString("under")+" "+bundle.getString("More")+" "+bundle.getString("Fields")+ " "+bundle.getString("can")+ " "+bundle.getString("be")+", "+bundle.getString("used")+" "+bundle.getString("now")+", "+bundle.getString("if")+ " "+bundle.getString("needed")+" "+bundle.getString("before"),""));
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_INFO,bundle.getString("using")+ " "+bundle.getString("save")+ " "+bundle.getString("next")+" "+bundle.getString("line")+ " "+bundle.getString("button")+" "+bundle.getString("to")+" "+bundle.getString("add")+" "+bundle.getString("this")+" "+bundle.getString("item"),""));
     }
     return null;
    }




    





/*
currentClientClass 
*/


/*
currentUserClass 
*/
/*
acperiodClass Y
*/
        private Yxxxch621xwwqqhxxxxxacperiod acperiod;
	public String getAcperiodFieldValue(String p) {
            String result="";
            //dont use owner2Code until genApp finished  needs try catch
            try{
             acperiod =(Yxxxch621xwwqqhxxxxxacperiod) entityManager
		.createQuery(
		 "select cc from Yxxxch621xwwqqhxxxxxacperiod cc where cc.a0xxukwpbv47xxxxxxxxrowid = :nKeyName  AND cc.zzxxu2oxxhxxxxxxxxxxowner2=:owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
		.setParameter("nKeyName","01").setParameter("owner2", owner2Code)
		.getSingleResult();
            }catch(Exception exc){
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
               FacesMessage.SEVERITY_INFO,bundle.getString("account")+ " "+bundle.getString("period")+ " "+bundle.getString("01")+ " "+bundle.getString("read")+ " "+bundle.getString("failed")+", "+exc.getMessage(),""));
             acperiod=null;
            }

	    if (acperiod != null) {
                  if (p.equals("cp")){
                    if(acperiod.getA1xxuxwpbv47xxxxxxxxcurrperiod() != null){
                     return acperiod.getA1xxuxwpbv47xxxxxxxxcurrperiod();
                    }else{
                     return "12";//assume period 12
                    }
                  }
                  else {
                    if(acperiod.getB2xxdwerbvxxxxxxxxxxcurrbusdate() !=null){
                     return acperiod.getB2xxdwerbvxxxxxxxxxxcurrbusdate().toString();
                    }else{
                      SimpleDateFormat ss = new SimpleDateFormat("yyyy-MM-dd");

                     return ss.format(calendar.getTime()).toString();// assume toDay
                    }
                  }
            }
	    else{
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                  FacesMessage.SEVERITY_INFO,bundle.getString("account")+ " "+bundle.getString("period")+ " "+bundle.getString("table")+ " "+bundle.getString("not")+ " "+bundle.getString("accessible"),""));

                  bcontinue=false;
			return null;
			
           }
      }
	public Date getAcperiodDateFieldValue(String p) {
            String result="";
             Yxxxch621xwwqqhxxxxxacperiod acperiod =(Yxxxch621xwwqqhxxxxxacperiod) entityManager
					.createQuery(
							"select cc from Yxxxch621xwwqqhxxxxxacperiod cc where cc.a0xxukwpbv47xxxxxxxxrowid = :nKeyName  AND cc.zzxxu2oxxhxxxxxxxxxxowner2=:owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
					.setParameter("nKeyName","01").setParameter("owner2", owner2Code)
					.getSingleResult();

		if (acperiod != null) {
                  if (p.equals("cbd")){
                    return acperiod.getB2xxdwerbvxxxxxxxxxxcurrbusdate();
                  }
                  else{
			   return null;
                  }
           }
		else{
                  FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("accounting")+ " "+bundle.getString("period")+ " "+bundle.getString("table")+ " "+bundle.getString("not")+" "+bundle.getString("accessible"),""));

                  bcontinue=false;
			return null;
			
		}
      }


	public void setShowKeyFields() {
	}
        //cartPoPicked is a flag to allow/suppress key generation and is set to true in cartpersist if po already exists  
        private boolean cartPoPicked=false;
        private boolean restEntity =false;
     // vendor invoice uses key from supplier , add more logic to handle it
	private boolean picked = false;
	private boolean multipicked = false;

     //jay document purpose of using last and show. last may be to reuse what was used recently
     // and show may be for dynamic rendering look at useraux as well 
     // note the lastItemEntity is used in forum to hold replyTo , others are not used
	private boolean bcontinue = true;
	private boolean moreActive = false;
	private boolean includeNext = false;
/*The following needs to be defined only if we need an instance of an entity which is not already generated via default seam gen. example if the entity is not a foreign key like Journal entity.
For the Foreign key instance, use the variables used in wire() where a getInstance is issued.For others use the variable defined below and issue a getInstance later.
*/
	@Inject
	Yxxxch621xwwqqhxxxxxacperiodHome yxxxch621xwwqqhxxxxxacperiodHome;




      private Integer lastItemLine=new Integer(0);
      //@Begin(join=true)

	public BigDecimal getKeyedQuantity() {
		return keyedQuantity;
	}

	public void setKeyedQuantity(BigDecimal keyedQuantity) {
		this.keyedQuantity = keyedQuantity;
      }

	public BigDecimal getTotalbaseamt() {
		return totalbaseamt;
	}

	public void setTotalbaseamt(BigDecimal totalbaseamt) {
		this.totalbaseamt = totalbaseamt;
	}
        //
	public BigDecimal getChange() {
		return change;
	}

	public void setChange(BigDecimal change) {
		this.change = change;
	}

	public BigDecimal getTotalmis() {
		return totalmis;
	}

	public void setTotalmis(BigDecimal totalmis) {
		this.totalmis = totalmis;
	}

	public void setDetailMis(BigDecimal detailMis) {
		this.detailMis = detailMis;
	}

	public void setDetailDel(BigDecimal detailDel) {
		this.detailDel = detailDel;
	}

	public void setDetailTax1(BigDecimal detailTax1) {
		this.detailTax1 = detailTax1;
	}


	public void setTotaltax1(BigDecimal totaltax1) {
		this.totaltax1 = totaltax1;
	}

	public BigDecimal getTotaltax1() {
		return totaltax1;
	}

	public void setTotalamountTotal(BigDecimal amountTotal) {
		this.amountTotal = amountTotal;
	}

	public BigDecimal getTotalamountTotal() {
		return amountTotal;
	}

	public void setTotalqtyTotal(BigDecimal qtyTotal) {
		this.qtyTotal = qtyTotal;
	}

	public BigDecimal getTotalqtyTotal() {
		return qtyTotal;
	}
	public void setTotaltax2(BigDecimal totaltax2) {
		this.totaltax2 = totaltax2;
	}

	public BigDecimal getTotaltax2() {
		return totaltax2;
	}

	public void setTotaltax3(BigDecimal totaltax3) {
		this.totaltax3 = totaltax3;
	}

	public BigDecimal getTotaltax3() {
		return totaltax3;
	}

	public BigDecimal getTotaldel() {
		return totaldel;
	}

	public void setTotaldel(BigDecimal totaldel) {
		this.totaldel = totaldel;
	}

	public BigDecimal getTotalqty() {
		return totalqty;
	}
	public void setTotalqty(BigDecimal totalqty) {
		this.totalqty = totalqty;
	}

      public Integer getLastItemLine() {
       return lastItemLine;
      }

	public void setLastItemLine(Integer lastItemLine) {

		this.lastItemLine = lastItemLine;
	}

//jay look into automating the below logic using related property values
// getShow does not seem to be used?? may be future security
// The below is useed to handle foreign fields which are dropdown and the value cannot point to instance.foreign entity
// since the entity does not exist yet if create, list works
// enhance remembering last value by using userprofile table the way row and option value is used
	private boolean showyxxxuq1n1xwwqqqxxxxxblobdata = false;
	 private String  lastyxxxuq1n1xwwqqqxxxxxblobdata = " ";
	 private String  lastyxxxuq1n1xwwqqqxxxxxblobdataP = " ";
	public boolean getShowyxxxuq1n1xwwqqqxxxxxblobdata() {
		return this.showyxxxuq1n1xwwqqqxxxxxblobdata;
	}
	public void setShowyxxxuq1n1xwwqqqxxxxxblobdata(boolean showyxxxuq1n1xwwqqqxxxxxblobdata) {
		 this.showyxxxuq1n1xwwqqqxxxxxblobdata=showyxxxuq1n1xwwqqqxxxxxblobdata;
	}

	public String getLastyxxxuq1n1xwwqqqxxxxxblobdata() {
                if(this.instance !=null && this.instance.getA0xxukbdlvxxxxxxxxxxfromtable() !=null){
                 lastyxxxuq1n1xwwqqqxxxxxblobdata= this.instance.getA0xxukbdlvxxxxxxxxxxfromtable();
                }
		return this.lastyxxxuq1n1xwwqqqxxxxxblobdata;
	}

	public void setLastyxxxuq1n1xwwqqqxxxxxblobdata(String lastyxxxuq1n1xwwqqqxxxxxblobdata) {
		 this.lastyxxxuq1n1xwwqqqxxxxxblobdata=lastyxxxuq1n1xwwqqqxxxxxblobdata;
	}
	public String getLastyxxxuq1n1xwwqqqxxxxxblobdataP() {
                //if(this.instance !=null && this.instance.getYxxxuq1n1xwwqqqxxxxxblobdata().getA0xxukbdlvxxxxxxxxxxfromtable() !=null){
                 //lastyxxxuq1n1xwwqqqxxxxxblobdataP= this.instance.getYxxxuq1n1xwwqqqxxxxxblobdata().getA0xxukbdlvxxxxxxxxxxfromtable();
                //}
		return this.lastyxxxuq1n1xwwqqqxxxxxblobdataP;
	}

	public void setLastyxxxuq1n1xwwqqqxxxxxblobdataP(String lastyxxxuq1n1xwwqqqxxxxxblobdata) {
		 this.lastyxxxuq1n1xwwqqqxxxxxblobdataP=lastyxxxuq1n1xwwqqqxxxxxblobdata;
	}















	public boolean isPicked() {
		return picked;
	}
	public void setPicked(boolean picked) {
		this.picked= picked;
	}
	public boolean isMultipicked() {
		return multipicked;
	}


	public boolean isMoreActive() {
		return moreActive;
	}
	public boolean isEntityUpdated() {
		return entityUpdated;
	}


	public boolean isEntityDeleted() {
		return entityDeleted;
	}
     public Date getCurrentTime() {
        return new Date();
     }



































            public boolean addAnyAttachment(){
            return true;
            }
            public boolean updateShipmentOrPickUp(){
            return true;
            }







public void markAll() {
 // this needs to be here rather than xxxList bean because of persitence
 try {
                List<Yxxxuq1n1xwwqqqxxxxxblobdata> listofStatus=yxxxuq1n1xwwqqqxxxxxblobdataList.getResultList() ;
	Iterator<Yxxxuq1n1xwwqqqxxxxxblobdata> itr = listofStatus.iterator();
	while (itr.hasNext()) {
	  yxxxuq1n1xwwqqqxxxxxblobdatali = itr.next();
                    yxxxuq1n1xwwqqqxxxxxblobdatali.setZ1xxzzfxhhxxxxxxxxxxstatusfl(yxxxuq1n1xwwqqqxxxxxblobdatali.getZ1xxzzfxhhxxxxxxxxxxstatusfl()|mmark);
	}
                  FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                  FacesMessage.SEVERITY_INFO,bundle.getString("marking")+ " "+bundle.getString("done"),""));
 } catch (Exception e) {
	log.severe("Mark iterator error " + e.getMessage());
 }
 
}
	public void unmarkAll() {
		// this needs to be here rather than xxxList bean because of persitence
		try {
			List<Yxxxuq1n1xwwqqqxxxxxblobdata> listofStatus = yxxxuq1n1xwwqqqxxxxxblobdataList
					.getResultList();
			Iterator<Yxxxuq1n1xwwqqqxxxxxblobdata> itr = listofStatus.iterator();
			while (itr.hasNext()) {
				yxxxuq1n1xwwqqqxxxxxblobdatali = itr.next();
				yxxxuq1n1xwwqqqxxxxxblobdatali.setZ1xxzzfxhhxxxxxxxxxxstatusfl(yxxxuq1n1xwwqqqxxxxxblobdatali
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						& _mmark);
			}
                        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("un")+" "+bundle.getString("marking")+ " "+bundle.getString("done"),""));
		} catch (Exception e) {
			log.severe("UnMark iterator error " + e.getMessage());
		}

	}

	public void toggleRowEditable(Integer id) {
          setYxxxuq1n1xwwqqqxxxxxblobdataA0xxuobxbxxxxxxxxxxxsid(id);
		getDefinedInstance();
		if (this.instance != null) {
			if (!isBitSet(this.instance.getZ1xxzzfxhhxxxxxxxxxxstatusfl(), _mclosed)) {
				this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(this.instance
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						& ~(1<<_mconsign));
			} else {
				this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(this.instance
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						| mconsign);
			}

                        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("edit")+ " "+bundle.getString("toggle")+ " "+bundle.getString("done"),""));

		} else {
			log.severe("toggleRowEditable error-this.instance null value ");
		}
	}


	public void toggleRowDeleteable(Integer id) {
           setYxxxuq1n1xwwqqqxxxxxblobdataA0xxuobxbxxxxxxxxxxxsid(id);
		getDefinedInstance();
		if (this.instance != null) {
			if (isBitSet(this.instance.getZ1xxzzfxhhxxxxxxxxxxstatusfl(), _mdel)) {
				this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(this.instance
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						& ~(1<<_mdel));
			} else {
				this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(this.instance
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						| mdel);
			}

                        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("delete")+ " "+bundle.getString("toggle")+ " "+bundle.getString("done"),""));

		} else {
			log.severe("toggleRowDeleteable error-this.instance null value ");
		}
	}


public boolean gethideAllMarked() {
 if (hideChosen){
                return true;
 }
 else {
             return false;
 }
}

public void sethideAllMarked(boolean chosen){
      this.hideChosen=chosen;
     }




public void deleteAllHidden() {
           // this needs to be here because of perstence
           // jay add more logic to check association ie referential integrity
                Integer count=0;

 try {
                List<Yxxxuq1n1xwwqqqxxxxxblobdata> listofStatus=yxxxuq1n1xwwqqqxxxxxblobdataList.getResultList() ;
	Iterator<Yxxxuq1n1xwwqqqxxxxxblobdata> itr = listofStatus.iterator();
         while (itr.hasNext()) {
	  yxxxuq1n1xwwqqqxxxxxblobdatali = itr.next();
                  if(isBitSet(yxxxuq1n1xwwqqqxxxxxblobdatali.getZ1xxzzfxhhxxxxxxxxxxstatusfl(),_mmark)){
                   count++;
                  }
                  
			}
                listofStatus=yxxxuq1n1xwwqqqxxxxxblobdataList.getResultList() ;
			itr = listofStatus.iterator();
			while (itr.hasNext()) {
			  yxxxuq1n1xwwqqqxxxxxblobdatali = itr.next();
                  if(isBitSet(yxxxuq1n1xwwqqqxxxxxblobdatali.getZ1xxzzfxhhxxxxxxxxxxstatusfl(),_mmark)){
		        // yxxxuq1n1xwwqqqxxxxxblobdatali.remove();
                  }
          }
 } catch (Exception e) {
    log.severe(" status field iterator error " + e.getMessage());
 }

}
 public void copyAllMarked() {
 // rename it to copyAllFlagged 
  //35

      try{
        // jay should reuse ComponentName rather than many variables like   itemChecked, listofstatus takes memory
        String oldKey="";
        String oldDescr="";
        int index = 0;
        for (Yxxxuq1n1xwwqqqxxxxxblobdata itemChecked : yxxxuq1n1xwwqqqxxxxxblobdataList.getResultList()) {
            this.clearInstance();
            if (checked.get(index)) {
                entityManager.detach(itemChecked);
                      itemChecked.setA0xxuobxbxxxxxxxxxxxsid(null);
                       // add copy(1) etc using a variable to natural key field assign natural key itemChecked.setdollar{keyField?cap_first}(null);
                       oldKey=itemChecked.getA0xxukbdlvxxxxxxxxxxfromtable();
                       if (oldKey.length()+5 <= 35){
                        oldKey=oldKey.substring(0,oldKey.length()-5);
                        itemChecked.setA0xxukbdlvxxxxxxxxxxfromtable(oldKey+"-copy");
                       }
                       else{
                        itemChecked.setA0xxukbdlvxxxxxxxxxxfromtable("c"+oldKey.substring(1));
                       } 
                      itemChecked.setZ1xxzzfxhhxxxxxxxxxxstatusfl(0);
                      itemChecked.setZ1xxzzfxhhxxxxxxxxxxstatusfl(itemChecked.getZ1xxzzfxhhxxxxxxxxxxstatusfl()| mcopy);
                       itemChecked.setZ2xxcztxlxxxxxxxxxxxstatusfldt(calendar.getTime());
                       itemChecked.setZ3xxutoxlhxxxxxxxxxxowner(ownerCode);
                      this.setInstance(itemChecked);
                      //is this a copy of SYSTEM record
                      if (this.instance.getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM")){
                       this.instance.setZzxxu2oxxhxxxxxxxxxxowner2(owner2Code);
                      }
                     this.persist();
                      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("copy")+ " "+bundle.getString("done"),""));

            }
            index++;
        }

        checked.clear(); 
      }
      catch ( Exception e){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("checked")+ " "+bundle.getString("items")+ " "+bundle.getString("update")+ " "+bundle.getString("error")+" "+e.getMessage(),""));
      }

 }

 public void updateAllFlagged() {
 // this needs to be here because of perstence jay5 enhance this using getallflagged 
        int index = 0;

      try{
        // jay should reuse ComponentName rather than many variables like   itemChecked, listofstatus takes memory
        for (Yxxxuq1n1xwwqqqxxxxxblobdata itemChecked : yxxxuq1n1xwwqqqxxxxxblobdataList.getResultList()) {
            this.clearInstance();
            if (checked.get(index)) {
                this.setInstance(itemChecked);
                this.update();
            }
            index++;
        }

        checked.clear(); 
                        FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("update")+ " "+bundle.getString("done"),""));

      }
      catch ( Exception e){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("checked")+ " "+bundle.getString("items")+ " "+bundle.getString("update")+ " "+bundle.getString("error")+" "+e.getMessage(),""));
      }


    }

	public void writeAsIcalText() {
		// this needs to be here because of perstence jay5 enhance this using getallflagged 

      try{
        // jay should reuse ComponentName rather than many variables like   itemChecked, listofstatus takes memory
        int index = 0;
        for (Yxxxuq1n1xwwqqqxxxxxblobdata itemChecked : yxxxuq1n1xwwqqqxxxxxblobdataList.getResultList()) {
            this.clearInstance();
            if (checked.get(index)) {
                this.setInstance(itemChecked);
                //this.update() put logic here
            }
            index++;
        }

        checked.clear(); 
      }
      catch ( Exception e){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("checked")+ " "+bundle.getString("items")+ " "+bundle.getString("update")+ " "+bundle.getString("error")+" "+e.getMessage(),""));
      }


    }
   public void deleteAllRecentCopied() {
      // uses todays date and stausfl 2 so includes imported, scope is group members,item,customer etc 
      int index=0;
      try{
        index=0;
        count=0;
        calendar.add(Calendar.DATE, -5);
        Date toDay = calendar.getTime();
        for (Yxxxuq1n1xwwqqqxxxxxblobdata itemChecked : yxxxuq1n1xwwqqqxxxxxblobdataList.getFlaggedAsList(mcopy)) {
            //
            this.clearInstance();
            // extra check needed if duplicate keys need to check using sid?
            if (isBitSet(itemChecked.getZ1xxzzfxhhxxxxxxxxxxstatusfl(),_mcopy)
             && itemChecked.getZ2xxcztxlxxxxxxxxxxxstatusfldt().after( toDay)) {
             this.setInstance(itemChecked);
	     superdotremove();
             count++;


            }
            index++;
        }
             timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
              FacesMessage.SEVERITY_INFO,bundle.getString("deleted")+" "+count+", "+bundle.getString("of")+" "+index+" "+"at"+" "+timeStamp,""));
             this.clearInstance();
      }
      catch ( Exception e){
       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
        FacesMessage.SEVERITY_INFO,bundle.getString("checked")+ " "+bundle.getString("items")+ " "+bundle.getString("delete")+ " "+bundle.getString("error")+" "+e.getMessage(),""));
      }


   }

   public void closeRecord(Yxxxuq1n1xwwqqqxxxxxblobdata entity) {

      String key="";    
      //not all entities have key value 
      try{
            this.clearInstance();
            this.setInstance(entity);
            this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(mclosed);
            superdotupdate();//dont change statusfldt
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
              FacesMessage.SEVERITY_INFO,bundle.getString("Marked")+" "+bundle.getString("as")+" "+bundle.getString("closed")+", "+" "+bundle.getString("key")+" "+key,""));

      }catch ( Exception e){
       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
        FacesMessage.SEVERITY_INFO,bundle.getString("Status")+ " "+bundle.getString("update")+ " "+bundle.getString("error")+ ", "+bundle.getString("key")+" "+key+" "+e.getMessage(),""));
      }


   }


   public void closeOldRecords(int days) {
      // uses todays date 
      int index=0;
      try{
        index=0;
        count=0;
        Date toDay = calendar.getTime();
        for (Yxxxuq1n1xwwqqqxxxxxblobdata itemChecked : yxxxuq1n1xwwqqqxxxxxblobdataList.getOldByList(days)) {
            //
            this.clearInstance();
            if (!isBitSet(itemChecked.getZ1xxzzfxhhxxxxxxxxxxstatusfl(),_mclosed)){
             itemChecked.setZ1xxzzfxhhxxxxxxxxxxstatusfl(mclosed);
             this.setInstance(itemChecked);
	     superdotupdate();//dont change statusfldt
             count++;
            }
            index++;
        }
             timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
              FacesMessage.SEVERITY_INFO,bundle.getString("updated")+" "+count+", "+bundle.getString("of")+" "+index+" "+"at"+" "+timeStamp,""));

      }
      catch ( Exception e){
       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
        FacesMessage.SEVERITY_INFO,bundle.getString("checked")+ " "+bundle.getString("items")+ " "+bundle.getString("delete")+ " "+bundle.getString("error")+" "+e.getMessage(),""));
      }


   }
   public void csvZapOldRecords(int days) {
      // uses todays date 
      int index=0;
      try{
        index=0;
        count=0;
        Date toDay = calendar.getTime();
        for (Yxxxuq1n1xwwqqqxxxxxblobdata itemChecked : yxxxuq1n1xwwqqqxxxxxblobdataList.getOldByList(days)) {
            // if we produce csv then they can be downloaded to local machine
            this.clearInstance();
            itemChecked.setZ1xxzzfxhhxxxxxxxxxxstatusfl(mclosed);
             this.setInstance(itemChecked);
	     superdotremove();//give msg about creating csv to download
             count++;

            index++;
        }
             timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
              FacesMessage.SEVERITY_INFO,bundle.getString("updated")+" "+count+", "+bundle.getString("of")+" "+index+" "+"at"+" "+timeStamp,""));

      }
      catch ( Exception e){
       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
        FacesMessage.SEVERITY_INFO,bundle.getString("checked")+ " "+bundle.getString("items")+ " "+bundle.getString("delete")+ " "+bundle.getString("error")+" "+e.getMessage(),""));
      }


   }




   public void deleteAllFlagged() {
  // this needs to be here because of perstence jay5 enhance this using getallflagged 
      int index=0;
      try{
        // jay should reuse ComponentName rather than many variables like   itemChecked, listofstatus takes memory
        for (Yxxxuq1n1xwwqqqxxxxxblobdata itemChecked : yxxxuq1n1xwwqqqxxxxxblobdataList.getResultList()) {
            if (checked.get(index)) {
             index++;
            }
        }
        if(index > 5){
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
             FacesMessage.SEVERITY_INFO,bundle.getString("Please")+" "+bundle.getString("select")+" "+bundle.getString("upto")+" "+bundle.getString("five"),""));
             return;
        }
        index=0;
        count=0;
        for (Yxxxuq1n1xwwqqqxxxxxblobdata itemChecked : yxxxuq1n1xwwqqqxxxxxblobdataList.getResultList()) {
            // restrict to 5 at a time to avoid UT000047 excceding max parameters 
            this.clearInstance();
            // extra check needed if duplicate keys need to check using sid?
            if (checked.get(index)) {

             this.setInstance(itemChecked);
	     superdotremove();
             count++;



            }
            index++;
        }
        checked.clear(); 
             timeStamp = new SimpleDateFormat("yyyy.MM.dd.HH.mm.ss").format(new Date());
             FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
             FacesMessage.SEVERITY_INFO,bundle.getString("deleted")+" "+count+" "+bundle.getString("selected")+" "+"Blobdata"+" "+bundle.getString("and")+" "+bundle.getString("related")+" "+countB+" "+bundle.getString("and")+" "+bundle.getString("details")+" "+countD+" "+bundle.getString("entries")+" "+"at"+" "+timeStamp,""));

      }
      catch ( Exception e){
       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("checked")+ " "+bundle.getString("items")+ " "+bundle.getString("delete")+ " "+bundle.getString("error")+" "+e.getMessage(),""));
      }


   }




     public void deleteDetails(Integer sid) {
      try{

        // get all details for this sid as parent, use entityLessStatusDetailedList not entityDetailedList to get all includind -1
      

      }
      catch ( Exception e){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("detail")+ " "+bundle.getString("remove")+ " "+bundle.getString("error")+" "+e.getMessage(),""));
      }
    }



 public void toggleAllFlagged() {
 // this needs to be here because of perstence jay5 enhance this using getallflagged 
      try{
        // jay should reuse ComponentName rather than many variables like   itemChecked, listofstatus takes memory
        for (Yxxxuq1n1xwwqqqxxxxxblobdata itemChecked : yxxxuq1n1xwwqqqxxxxxblobdataList.getResultList()) {
            this.clearInstance();
            if (checked.get(itemChecked.getA0xxuobxbxxxxxxxxxxxsid())) {
                this.setInstance(itemChecked);
			if (isBitSet(this.instance.getZ1xxzzfxhhxxxxxxxxxxstatusfl(), _mmark)) {
				this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(this.instance
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						& ~(1<<_mmark));
			} else {
				this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(this.instance
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						| mmark);
             
			}
                this.update();
            }
        }
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("marking")+ " / "+bundle.getString("un")+" "+bundle.getString("marking")+ " "+bundle.getString("done"),""));
        checked.clear(); 
      }
      catch ( Exception e){
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("checked")+ " "+bundle.getString("items")+" "+ " "+bundle.getString("update")+ " "+bundle.getString("error")+" "+e.getMessage(),""));
      }


 }




	public void toggleRowMarked(Integer id) {
           setYxxxuq1n1xwwqqqxxxxxblobdataA0xxuobxbxxxxxxxxxxxsid(id);
		getDefinedInstance();
		if (this.instance != null) {
			if (isBitSet(this.instance.getZ1xxzzfxhhxxxxxxxxxxstatusfl(), _mmark)) {
				this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(this.instance
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						& ~(1<<_mmark));
                     // unmark should reset del and update tags as well
				this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(this.instance
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						& ~(1<<_mdel));
				this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(this.instance
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						& ~(1<<_mconsign));
			} else {
				this.instance.setZ1xxzzfxhhxxxxxxxxxxstatusfl(this.instance
						.getZ1xxzzfxhhxxxxxxxxxxstatusfl()
						| mmark);
             
			}
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("marking")+ " / "+bundle.getString("un")+bundle.getString("marking")+ " "+bundle.getString("done"),""));
		} else {
			log.severe("markThis error-this.instance null value,id is "+id);
		}

	}





 public void downloadThis(Integer id) {
           // made changes needed for jsf2.2, zd means data in clob/blob ex item,customer zb means blob and za means clob
         try{

	   // mime type
           String mime="";
           String extension="";
           setYxxxuq1n1xwwqqqxxxxxblobdataA0xxuobxbxxxxxxxxxxxsid(id);
           this.setInstance(getDefinedInstance()); 
           if(this.instance.getB1xxuzbxbvxxxxxxxxxxdata()==null){
            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("no")+ " "+bundle.getString("data"),""));

            return;
           }
                //blob itself
                extension =this.instance.getA4xxexxxbvxxxxxxxxxxtype();
           //need to stripoff asis from type
           if(extension != null && extension.contains("asis")){
            extension=extension.substring(4);
           }
    FacesContext fc = FacesContext.getCurrentInstance();
    ExternalContext ec = fc.getExternalContext();

    ec.responseReset(); // Some JSF component library or some Filter might have set some headers in the buffer beforehand. We want to get rid of them, else it may collide.

    OutputStream output = ec.getResponseOutputStream();
			if ("bmp".equals(extension)) {
				mime = "image/bmp";
			} else if ("jpg".equals(extension)) {
				mime = "image/jpeg";
			} else if ("gif".equals(extension)) {
				mime = "image/gif";
			} else if ("png".equals(extension)) {
				mime = "image/png";
			} else if ("xml".equals(extension)) {
				mime = "text/xml";
			} else if ("doc".equals(extension)) {
				mime = "application/msword";
                                resp.setHeader("Cache-Control", "Public");  
			} else if ("txt".equals(extension)) {
				mime = "text/plain";
			} else if ("html".equals(extension)) {
				mime = "text/html";
			} else if ("pdf".equals(extension)) {
				mime = "application/pdf";
			} else if ("xls".equals(extension)) {
				mime = "application/vnd.ms-excel";
                                resp.setHeader("Cache-Control", "Public");  
			} else if ("ppt".equals(extension)) {
				mime = "application/vnd.ms-powerpoint";
                                resp.setHeader("Cache-Control", "Public");  
			} else if ("mp3".equals(extension)) {
				mime = "audio/mpeg";
			} else if ("mp4".equals(extension)) {
				mime = "video/mp4";
			} else {
				mime = "image/unknown";
			}

          byte[] bytes = null;

          bytes=this.instance.getB1xxuzbxbvxxxxxxxxxxdata();
           if(bytes == null){
            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
             FacesMessage.SEVERITY_ERROR,"Blobdata"+" "+bundle.getString("no")+" "+bundle.getString("data")+" "+bundle.getString("found"),""));
             return;
           }
                String fileName="mydownload." + extension;
    ec.setResponseContentType(mime); // Check http://www.iana.org/assignments/media-types for all types. Use if necessary ExternalContext#getMimeType() for auto-detection based on filename.
    ec.setResponseContentLength(bytes.length); // Set it with the file size. This header is optional. It will work if it's omitted, but the download progress will be unknown.
    ec.setResponseHeader("Content-Disposition", "attachment; filename=\"" + fileName + "\""); // The Save As popup magic is done here. You can give it any file name you want, this only won't work in MSIE, it will use current request URL as file name instead.
    OutputStream outputStream = ec.getResponseOutputStream();
		outputStream.write(bytes, 0, bytes.length);
		outputStream.flush();
		outputStream.close();
    fc.responseComplete();
         }catch ( Exception e){
          FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
           FacesMessage.SEVERITY_ERROR,"Blobdata"+" "+bundle.getString("key")+" "+bundle.getString("error")+" "+e.getMessage(),""));

         }


      


 }



// same as checking for "1B"



	

	public String getCleaned(String strHTML) {
         String cleanedHTML = Jsoup.clean(strHTML, Whitelist.none());  
         String text= cleanedHTML.replace("&nbsp;"," "); 
         text= text.replace("&amp;","&"); 
         return text;
        }



     // it seems you cannot call the following get methods directly from clob or blob home, so local method are
     // created , otherwise compile error about calling non static method
    /**
    * The following method gets clobdata and for geeral usage
    * if both a site and SYSTEM records exist, site record is returned 
    * Return value if null will show drop down menu, otherwise the content
    * @param 5 args String table,keyWPrefix,String keyQualifier,int keySequence,int size
    * @return String
    * @exception No Record Exists
    * @see "getClobdata(String theme,String vendor,String table,String keyWPrefix,String keyQualifier,int keySequence,int size) for theme content"
    * 
    */

     public String getClobdata(String table,String keyWPrefix,String keyQualifier,int keySequence,int size) {
           String actualTable=table;
           if(keyWPrefix.length() > 0){
            slobkeyhash = keyWPrefix.substring(1);
           }else{
            return null;
           }
          String qualifier = keyQualifier;
          int sequence = keySequence;
           try {
               Yxxxuq1m1xwwqqqxxxxxclobdata clobdata=null;
		    List<Yxxxuq1m1xwwqqqxxxxxclobdata> results =  entityManager
					.createQuery(
							"select cc from Yxxxuq1m1xwwqqqxxxxxclobdata cc where cc.a0xxukcdlvxxxxxxxxxxfromtable=:clobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:clobdatafromkey and cc.a2xxuxxxbv50xxxxxxxxqualifier=:clobdataqualifier and a3xxexnsbvxxxxxxxxxxsequence = :clobdatasequence and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2  ")
					.setParameter("clobdatafromtable", actualTable).setParameter(
							"clobdatafromkey", slobkeyhash).setParameter(
							"clobdataqualifier", qualifier).setParameter(
							"clobdatasequence", sequence).setParameter("owner2", owner2Code).getResultList();
                if(!results.isEmpty()){
                 if ( !results.get(0).getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM")) {
                  clobdata= results.get(0);
                 }else{
                  if (results.size() > 1){
                   clobdata= results.get(1);
                  }else{
                   clobdata= results.get(0);
                  }
                 }
                 if(clobdata==null){
                  return null; 
                 }
                }
                else{
                 return null;
                }
                if(clobdata.getB1xxuzaxbvxxxxxxxxxxdata()==null){
                 return null;
                }
                else{
                 int dl=clobdata.getB1xxuzaxbvxxxxxxxxxxdata().length();
                 if (dl > size){
	  return clobdata.getB1xxuzaxbvxxxxxxxxxxdata().substring(0,size);
                 }else {
	  return clobdata.getB1xxuzaxbvxxxxxxxxxxdata();
                 }
                } 
           } catch (NoResultException nre) {
             return null;
          } catch (Exception e) {
                   FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                     FacesMessage.SEVERITY_INFO,bundle.getString("clobdata")+ " "+bundle.getString("unexpcted")+ " "+bundle.getString("error")+ " "+e.getMessage(),""));
             return null;
          }
     }

    /**
    * The following method gets clobdata from SYSTEM if qualifier matches theme name 
    * No logic yet to use vendor and clob type hdr
    * Quick check and return null if no SYSTEM record for the key, if key exists then key qualifier part is
    * changed to theme name and searched again. If found String data returned (why two passes?) 
    * @param 7 args String theme,vendor,table,keyWPrefix,String keyQualifier,int keySequence,int size
    * theme comes from session variable value skinBean.previewTh
    * @return byte[] image stream
    * @exception No Record Exists
    * @see "getClobdata(String table,String keyWPrefix,String keyQualifier,int keySequence,int size) for non theme content"
    * 
    */


     public String getClobdata(String theme,String vendor,String table,String keyWPrefix,String keyQualifier,int keySequence,int size) {
           String actualTable=table;
           if(theme.isEmpty()){
            theme="Service-Lan";
           }
           if(vendor.isEmpty()){
            vendor="3R";
           }
           
           if(keyWPrefix.length() > 0){
	     	 slobkeyhash = keyWPrefix.substring(1);
           }else{
            return null;
           }
		String qualifier = keyQualifier;
		int sequence = keySequence;
                //first check if any system record exists for the key.if txt not hdr then change qualifier to theme
                // and search again 
		try {
                 Yxxxuq1m1xwwqqqxxxxxclobdata clobdata=null;
		    List<Yxxxuq1m1xwwqqqxxxxxclobdata> results =  entityManager
					.createQuery(
							"select cc from Yxxxuq1m1xwwqqqxxxxxclobdata cc where cc.a0xxukcdlvxxxxxxxxxxfromtable=:clobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:clobdatafromkey and cc.a2xxuxxxbv50xxxxxxxxqualifier LIKE :clobdataqualifier and a3xxexnsbvxxxxxxxxxxsequence = :clobdatasequence and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 ")
					.setParameter("clobdatafromtable", actualTable).setParameter(
							"clobdatafromkey", slobkeyhash).setParameter(
							"clobdataqualifier", qualifier).setParameter(
							"clobdatasequence", sequence).setParameter("owner2", "SYSTEM").getResultList();

	} catch (NoResultException nre) {
	return null;
	} catch (Exception e) {
                  FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                   FacesMessage.SEVERITY_ERROR,bundle.getString("text")+ " "+bundle.getString("data")+ " "+bundle.getString("unexpcted")+ " "+bundle.getString("error")+ " "+e.getMessage(),""));
	return null;
	}
                // if HDR then dont show anything, may be in future. if TXT show vendor theme if any otherwise null
                // if multiple returns last one, enhance logic to avoid first 10 ?? chrs being same
                if(qualifier.equals("HDR")){
                 return null;
                }
                //qualifier=theme.substring(0,10)+"%"; can have same first 10 
                qualifier=theme;// 
		try {
                 Yxxxuq1m1xwwqqqxxxxxclobdata clobdata=null;
		    List<Yxxxuq1m1xwwqqqxxxxxclobdata> results =  entityManager
					.createQuery(
							"select cc from Yxxxuq1m1xwwqqqxxxxxclobdata cc where cc.a0xxukcdlvxxxxxxxxxxfromtable=:clobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:clobdatafromkey and cc.a2xxuxxxbv50xxxxxxxxqualifier LIKE :clobdataqualifier and a3xxexnsbvxxxxxxxxxxsequence = :clobdatasequence and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 ")
					.setParameter("clobdatafromtable", actualTable).setParameter(
							"clobdatafromkey", slobkeyhash).setParameter(
							"clobdataqualifier", qualifier).setParameter(
							"clobdatasequence", sequence).setParameter("owner2", "SYSTEM").getResultList();
                if(!results.isEmpty()){
                 if ( !results.get(0).getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM")) {
                  clobdata= results.get(0);
                 }else{
                  if (results.size() > 1){
                   clobdata= results.get(1);
                  }else{
                   clobdata= results.get(0);
                  }
                 }
                 if(clobdata==null){
                  return null; 
                 }
                }
                else{
                 return null;
                }
                if(clobdata.getB1xxuzaxbvxxxxxxxxxxdata()==null){
                 return null;
                }
                else{
                 int dl=clobdata.getB1xxuzaxbvxxxxxxxxxxdata().length();
                 if (dl > size){
			  return clobdata.getB1xxuzaxbvxxxxxxxxxxdata().substring(0,size);
                 }else {
			  return clobdata.getB1xxuzaxbvxxxxxxxxxxdata();
                 }
                } 
		} catch (NoResultException nre) {
			return null;
		} catch (Exception e) {
                  FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                   FacesMessage.SEVERITY_ERROR,bundle.getString("text")+ " "+bundle.getString("data")+ " "+bundle.getString("unexpcted")+ " "+bundle.getString("error")+ " "+e.getMessage(),""));
		   return null;
		}
	}

    /**
    * The following method used by non faces env like servlet or rest and needs set the owner2Code SYSTEM or new site etc
    * @param args String table,keyWPrefix,String keyQualifier,int keySequence,String owner2Code
    * @return byte[] image stream
    * @exception None 
    * @see 
    * 
    */

     public byte[] getBlobdata(String table,String keyWPrefix,String keyQualifier,int keySequence,String owner2Code) {
         this.owner2Code=owner2Code;
         return getBlobdata(table,keyWPrefix,keyQualifier,keySequence); 
        }


    /**
    * The following method gets blobdata from both user for a specific key
    * @param args String table,keyWPrefix,String keyQualifier,int keySequence
    * @return byte[] image stream
    * @exception No Record Exists 
    * @see 
    * 
    */

	public byte[] getBlobdata(String table,String keyWPrefix,String keyQualifier,int keySequence) {
           String actualTable=table;
           if(keyWPrefix.length() > 0){
	     	 slobkeyhash = keyWPrefix.substring(1);
           }else{
            return null;
           }
		String qualifier = keyQualifier;
		int sequence = keySequence;

		try {
               Yxxxuq1n1xwwqqqxxxxxblobdata blobdata=null;
		    List<Yxxxuq1n1xwwqqqxxxxxblobdata> results = entityManager
					.createQuery(
							"select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where cc.a0xxukbdlvxxxxxxxxxxfromtable=:blobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:blobdatafromkey and cc.a2xxuxxxbv50xxxxxxxxqualifier=:blobdataqualifier and a3xxexnsbvxxxxxxxxxxsequence = :blobdatasequence and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2  ")
					           .setParameter("blobdatafromtable", actualTable).setParameter(
							"blobdatafromkey", slobkeyhash).setParameter(
							"blobdataqualifier", qualifier).setParameter(
							"blobdatasequence", sequence).setParameter("owner2", owner2Code).getResultList();
                if(!results.isEmpty()){
                 if ( !results.get(0).getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM")) {
                  return results.get(0).getB1xxuzbxbvxxxxxxxxxxdata();
                 }else{
                  if (results.size() > 1){
                   return results.get(1).getB1xxuzbxbvxxxxxxxxxxdata();
                  }else{
                   return results.get(0).getB1xxuzbxbvxxxxxxxxxxdata();
                  }
                 }
                }else{
                 // use bkgr color richSkin.headerGradientColor if no image supplied , which is default
                  return null; 
                }
         } catch (NoResultException e) {
               return null;
	 } catch (Exception e) {
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("unexpcted")+ " "+bundle.getString("error")+ " "+e.getMessage(),""));
               return null;
         }
	}

/**
 get system blobs, harcode qualifier using theme, owner2 as SYSTEM. add vendor matching blob type ??
*/
	public byte[] getBlobdata(String theme,String vendor,String table,String keyWPrefix,String keyQualifier,int keySequence) {
           String actualTable=table;
           if(theme.isEmpty()){
            theme="Service-Lan";
           }
           if(vendor.isEmpty()){
            vendor="3R";
           }
           if(keyWPrefix.length() > 0){
	     	 slobkeyhash = keyWPrefix.substring(1);
           }else{
            return null;
           }
		String qualifier = keyQualifier;
                //qualifier=theme.substring(0,10)+"%";
                qualifier=theme;

		int sequence = keySequence;

		try {
               Yxxxuq1n1xwwqqqxxxxxblobdata blobdata=null;
		    List<Yxxxuq1n1xwwqqqxxxxxblobdata> results = entityManager
					.createQuery(
							"select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where cc.a0xxukbdlvxxxxxxxxxxfromtable=:blobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:blobdatafromkey and cc.a2xxuxxxbv50xxxxxxxxqualifier LIKE :blobdataqualifier and a3xxexnsbvxxxxxxxxxxsequence = :blobdatasequence and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2  ")
					           .setParameter("blobdatafromtable", actualTable).setParameter(
							"blobdatafromkey", slobkeyhash).setParameter(
							"blobdataqualifier", qualifier).setParameter(
							"blobdatasequence", sequence).setParameter("owner2", "SYSTEM").getResultList();
                if(!results.isEmpty()){
                 if ( !results.get(0).getZzxxu2oxxhxxxxxxxxxxowner2().equals("SYSTEM")) {
                  return results.get(0).getB1xxuzbxbvxxxxxxxxxxdata();
                 }else{
                  if (results.size() > 1){
                   return results.get(1).getB1xxuzbxbvxxxxxxxxxxdata();
                  }else{
                   return results.get(0).getB1xxuzbxbvxxxxxxxxxxdata();
                  }
                 }
                }else{
                 // use bkgr color richSkin.headerGradientColor if no image supplied , which is default
                  return null; 
                }
         } catch (NoResultException e) {
               return null;
	 } catch (Exception e) {
           FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("unexpcted")+ " "+bundle.getString("error")+ " "+e.getMessage(),""));
               return null;
         }
	}


	public String getBlobdataType(String table,String keyWPrefix, String keyQualifier, int keySequence) {
           //  type like jpg etc not formal mime type
           //String table="YXXXUQ1N1XWWQQQXXXXXBLOBDATA";
           String actualTable=table;
           if(keyWPrefix.length() > 0){
	     	 slobkeyhash = keyWPrefix.substring(1);
           }else{
            return null;
           }
		String qualifier = keyQualifier;
		int sequence = keySequence;

		Yxxxuq1n1xwwqqqxxxxxblobdata blobdata;

		try {
			blobdata = (Yxxxuq1n1xwwqqqxxxxxblobdata) entityManager
					.createQuery(
							"select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where cc.a0xxukbdlvxxxxxxxxxxfromtable=:blobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:blobdatafromkey and cc.a2xxuxxxbv50xxxxxxxxqualifier=:blobdataqualifier and a3xxexnsbvxxxxxxxxxxsequence = :blobdatasequence and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
					.setParameter("blobdatafromtable", actualTable).setParameter(
							"blobdatafromkey", slobkeyhash).setParameter(
							"blobdataqualifier", qualifier).setParameter(
							"blobdatasequence", sequence).setParameter("owner2", owner2Code).getSingleResult();
			return blobdata.getA4xxexxxbvxxxxxxxxxxtype();
		} catch (NoResultException nre) {
			return null;
		} catch (NonUniqueResultException e) {
                 FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                  FacesMessage.SEVERITY_ERROR,bundle.getString("blobdata")+" "+bundle.getString("key")+" "+slobkeyhash+" "+bundle.getString("error")+" "+e.getMessage(),""));
                 return null;
		}
	}
 
     //jay look into changing the name to just getDataTypeMime as it applies to both clob and blob
	public String getBlobdataTypeMime(String table,String keyWPrefix, String keyQualifier, int keySequence) {
           // mime type
           String mime="x";
           String extension="";
           //String table="YXXXUQ1N1XWWQQQXXXXXBLOBDATA";
           String actualTable=table;
           if(keyWPrefix == null  || keyWPrefix.length() < 2){
            return mime;
           }
           if(keyWPrefix.length() > 0){
	     	 slobkeyhash = keyWPrefix.substring(1);
           }else{
            return null;
           }
		String qualifier = keyQualifier;
		int sequence = keySequence;

		Yxxxuq1n1xwwqqqxxxxxblobdata blobdata;

		try {
		    List<Yxxxuq1n1xwwqqqxxxxxblobdata> results = entityManager
					.createQuery(
							"select cc from Yxxxuq1n1xwwqqqxxxxxblobdata cc where cc.a0xxukbdlvxxxxxxxxxxfromtable=:blobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey=:blobdatafromkey and cc.a2xxuxxxbv50xxxxxxxxqualifier=:blobdataqualifier and a3xxexnsbvxxxxxxxxxxsequence = :blobdatasequence and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
					.setParameter("blobdatafromtable", actualTable).setParameter(
							"blobdatafromkey", slobkeyhash).setParameter(
							"blobdataqualifier", qualifier).setParameter(
							"blobdatasequence", sequence).setParameter("owner2", owner2Code).getResultList();
                if(!results.isEmpty()){
                 blobdata=results.get(0);
                 extension =blobdata.getA4xxexxxbvxxxxxxxxxxtype();
                }else{
                 return mime;
                } 
			if ("bmp".equals(extension)) {
				mime = "image/bmp";
			} else if ("jpg".equals(extension)) {
				mime = "image/jpeg";
			} else if ("gif".equals(extension)) {
				mime = "image/gif";
			} else if ("png".equals(extension)) {
				mime = "image/png";
			} else if ("xml".equals(extension)) {
				mime = "text/xml";
			} else if ("doc".equals(extension)) {
				mime = "application/msword";
			} else if ("txt".equals(extension)) {
				mime = "text/plain";
			} else if ("txt".equals(extension)) {
				mime = "text/plain";
			} else if ("pdf".equals(extension)) {
				mime = "application/pdf";
			} else if ("xls".equals(extension)) {
				mime = "application/vnd.ms-excel";
			} else if ("ppt".equals(extension)) {
				mime = "application/vnd.ms-powerpoint";
			} else if ("mp3".equals(extension)) {
				mime = "audio/mpeg";
			} else {
				mime = "image/unknown";
			}

			return mime;
		} catch (NoResultException nre) {
			return null;
		}
	}




 public int getSize() {
   if (this.getFiles().size()>0){
    return this.getFiles().size();
  }else 
  {
   return 0;
  }
 }

 public static String padRight(String s, int n) {
  // s is string, n number of padding 
  //format(String format, Object... args) 
  //%[argument number] [flags] [width] [.precision] type
  return String.format("%1$-" + n + "s", s);
 }
 public static String padLeft(String s, int n) {
    return String.format("%1$" + n + "s", s);  
}


    




 public String clearUploadData() {
  if(this.getFiles() !=null){
   yxxxuq1n1xwwqqqxxxxxblobdataHome.getFiles().clear();
   setUploadsAvailable(1);
  }
  return null;
 }

 public long getTimeStamp(){
  return System.currentTimeMillis();
 }


 public int getUploadsAvailable() {
  return uploadsAvailable;
 }

 public void setUploadsAvailable(int uploadsAvailable) {
  this.uploadsAvailable = uploadsAvailable;
 }

 public boolean isAutoUpload() {
 return autoUpload;
 }

 public void setAutoUpload(boolean autoUpload) {
  this.autoUpload = autoUpload;
 }

 public boolean isUseFlash() {
 return useFlash;
 }

 public void setUseFlash(boolean useFlash) {
 this.useFlash = useFlash; 
 }




	public boolean getButtonPressed() {

		if (buttonPressed){
                return true;
           }
		else {
             return false;
          }
     }

     public void setButtonPressed(boolean pressed){
      this.buttonPressed=pressed;
     }


	public String getButtonPressedLabel() {

          return buttonPressedLabel;
     }

     public void setButtonPressedLabel(){
     }

     public String getupLoadPurpose() {

          return upLoadPurpose;
     }

     public void setupLoadPurpose(String upLoadPurpose){
      this.upLoadPurpose=upLoadPurpose;
     }

     public int getuseSeq() {

          return useSeq;
     }

     public void setuseSeq(int useSeq){
      this.useSeq=useSeq;
     }
	public String getdiscountType() {

          return discountType;
     }

     public void setupDiscountType(String discountType){
      this.discountType=discountType;
     }

	public int getUploadsDoneCount() {

          return uploadsDoneCount;
     }

     public void setUploadsDoneCount(){
     }

     public void makeButtonPressed(){
      if (buttonPressedLabel.equals("+ Upload")){
       this.buttonPressed=true;
       this.buttonPressedLabel="- Upload";
      }
      else{
       this.buttonPressed=false;
       this.buttonPressedLabel="+ Upload";
      }
     }

     public void makeButtonPressedPlusB(){
      Integer maxAttach=5;
      makeButtonPressed();
      /**
       used by basketOut,basketOutCast and in mailingSend
      */
      // 3r-attachment records are reused seq 1 to max say 5. if record count = max then get oldest record and update that record
      // if record count is less than max then add a record and set seq to record count+1 
      // since records are reused within a client, we need to change owner to restrict view as needed in case item mgmt
      // but can be ignored for mailing attachment
      // also in jsf render the attachment records    
                 temps=file.getMime();
			 if ("image/bmp".equals(temps)) {
				lobDataType = "bmp";
			 } else if ("image/jpeg".equals(temps)) {
				lobDataType = "jpg";
			 } else if ("image/gif".equals(temps)) {
				lobDataType = "gif";
			 } else if ("image/png".equals(temps)) {
				lobDataType = "png";
			 } else if ("text/xml".equals(temps)) {
				lobDataType = "xml";
			 } else if ("application/msword".equals(temps)) {
				lobDataType = "doc";
			 } else if ("text/plain".equals(temps)) {
				lobDataType = "txt";
			 } else if ("text/html".equals(temps)) {
				lobDataType = "html";
			 } else if ("application/pdf".equals(temps)) {
				lobDataType = "pdf";
			 } else if ("application/vnd.ms-excel".equals(temps)) {
				lobDataType = "xls";
			 } else if ("application/vnd.ms-powerpoint".equals(temps)) {
				lobDataType = "ppt";
			 } else if ("audio/mpeg".equals(temps)) {
				lobDataType = "mp3";
			 } else if ("video/mp4".equals(temps)) {
				lobDataType = "mp4";
			 } else {
				lobDataType = "unkn";
			 }
      if (lobDataType.equals("txt") || lobDataType.equals("xml") || lobDataType.equals("html")) {
       makeButtonPressedPlusC();
       return;
      }       

      if(yxxxuq1n1xwwqqqxxxxxblobdataList.getAttachCount() == maxAttach){
       yxxxuq1n1xwwqqqxxxxxblobdata=yxxxuq1n1xwwqqqxxxxxblobdataList.getOldest();
       yxxxuq1n1xwwqqqxxxxxblobdata.setY3xxuxznbvxxxxxxxxxxnotes(yxxxuq1n1xwwqqqxxxxxblobdataHome.getFiles().get(0).getName());
       yxxxuq1n1xwwqqqxxxxxblobdata.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
       yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
       yxxxuq1n1xwwqqqxxxxxblobdata.setZ3xxutoxlhxxxxxxxxxxowner(ownerCode);
       yxxxuq1n1xwwqqqxxxxxblobdataHome.setInstance(yxxxuq1n1xwwqqqxxxxxblobdata);
       // ready to persist, use superUpdate
       yxxxuq1n1xwwqqqxxxxxblobdataHome.superUpdate();
       clearUploadData();
      }else{
       yxxxuq1n1xwwqqqxxxxxblobdataHome.clearInstance();
       yxxxuq1n1xwwqqqxxxxxblobdata=yxxxuq1n1xwwqqqxxxxxblobdataHome.getInstance();
       //already has blobdata and PIC
       yxxxuq1n1xwwqqqxxxxxblobdata.setA1xxuxxxbv49xxxxxxxxfromkey("3R-ATTACHMENT-1-C");
       yxxxuq1n1xwwqqqxxxxxblobdata.setA3xxexnsbvxxxxxxxxxxsequence( yxxxuq1n1xwwqqqxxxxxblobdataList.getAttachCount()+1);
       yxxxuq1n1xwwqqqxxxxxblobdata.setY3xxuxznbvxxxxxxxxxxnotes(this.getFiles().get(0).getName());
       yxxxuq1n1xwwqqqxxxxxblobdata.setB1xxuzbxbvxxxxxxxxxxdata(file.getData());
       yxxxuq1n1xwwqqqxxxxxblobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
       yxxxuq1n1xwwqqqxxxxxblobdataHome.persist();
       clearUploadData();
      }
     }
     public void makeButtonPressedPlusC(){
      Integer maxAttach=5;
      makeButtonPressed();
      // 3r-attachment records are reused seq 1 to max say 5. if record count = max then get oldest record and update that record
      // if record count is less than max then add a record and set seq to record count+1 
      // also in jsf render the attachment records    
      if(yxxxuq1m1xwwqqqxxxxxclobdataList.getAttachCount() == maxAttach){
       yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataList.getOldest();
       yxxxuq1m1xwwqqqxxxxxclobdata.setY3xxuxznbvxxxxxxxxxxnotes(this.getFiles().get(0).getName());
       yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(new String(file.getData()));
       yxxxuq1m1xwwqqqxxxxxclobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
       yxxxuq1m1xwwqqqxxxxxclobdata.setZ3xxutoxlhxxxxxxxxxxowner(ownerCode);
       yxxxuq1m1xwwqqqxxxxxclobdataHome.update();
       clearUploadData();
      }else{
       yxxxuq1m1xwwqqqxxxxxclobdataHome.clearInstance();
       yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataHome.getInstance();
       //already has clobdata but not qualifier since it could be TXT or HDR
       yxxxuq1m1xwwqqqxxxxxclobdata.setA2xxuxxxbv50xxxxxxxxqualifier("TXT");
       yxxxuq1m1xwwqqqxxxxxclobdata.setA1xxuxxxbv49xxxxxxxxfromkey("3R-ATTACHMENT-1-C");
       yxxxuq1m1xwwqqqxxxxxclobdata.setA3xxexnsbvxxxxxxxxxxsequence(yxxxuq1m1xwwqqqxxxxxclobdataList.getAttachCount()+1);
       yxxxuq1m1xwwqqqxxxxxclobdata.setY3xxuxznbvxxxxxxxxxxnotes(this.getFiles().get(0).getName());
                   String uploadedText=file.getText();
                   String jay=uploadedText;
                   try{
                    uploadedText=this.sanitize(uploadedText);//
                    uploadedText=jay;
                   } catch ( Exception e){
                    FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                    FacesMessage.SEVERITY_INFO," "+"invalid"+" "+" "+bundle.getString("content")+",  "+e.getMessage(),""));
                    return;
                   }
                   yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(uploadedText);

       yxxxuq1m1xwwqqqxxxxxclobdata.setA4xxexxxbvxxxxxxxxxxtype(lobDataType);
       yxxxuq1m1xwwqqqxxxxxclobdataHome.persist();
       clearUploadData();
      }
     }




 public String sanitizeApply(String unsafe) throws IOException{
         String safe = Jsoup.clean(unsafe, Whitelist.relaxed().addTags("iframe").addAttributes("p", "style"));
         return unsafe;

 }

    /**
    * The following method sanitizes ie drops unwanted html tags to reduce xss attack 
    * called by xxxlist.send (email)  and clobdataEdit and theme pages etc
    * @param args unsafe data entered by untrusted user 
    * @return safe string
    * @exception IOException
    * @see 
    *  use sanitize wherever clbdata is used or in future used 
    *  default is is ignore sanitize but added a new method sanitizeApply
    */  

 public String sanitize(String unsafe) throws IOException{
         //String safe = Jsoup.clean(unsafe, Whitelist.relaxed().addTags("iframe").addAttributes("p", "style"));
         return unsafe;

 }

/*      addTags for tag, addAttributes for attribute within a specific tag only
	.addTags("meta", "title", "script", "iframe")
	.addAttributes("meta", "charset")
	.addAttributes("iframe", "src")
	.addProtocols("iframe", "src", "http", "https");
*/


     // generate 





//called by this and other EntityHomes 
//supports multiple uploaded files which can be either clob or blob 
 public String addToFiles(File file) {
  files.add(file);
  return null;
 }
        //files are raaspi subset file objects holding scaled down images or text data

        public List<File> getFiles() {
         return files;
        }

        public void setFiles(List<File> files) {
         this.files = files;
        }




     //copy defaults like stock images to blobdata under owner=sss owner2=SYSTEM and both -C and -M key suffix and sequesnce 1,2 etc
     // images take more space so discourage storing under owner2
     // a4j:repeat in jsf pages is used to show all the sequences but seq 0 is the one to be shown on the home and home mockup pages.
     // tenant may change the image using mockUp page and then it will create a new record under its own owner2 value
     // so getblobdata needs to query on both SYSTEM and owner2 and if owner2 not there use SYSTEM.
     // 
     // add logic to store image based on product code
     // copy HDR and TXT to clobdata as well which tenant is expected to change via mockUp
     public String copyDefaultsToSYSTEM_1() {
     //System template Images and a fewer texts.
     // in cloud images take longer time, so split this method to avoid time outs 
     // this needs to be done once only ie if  and not to be repeated for each tenant
      int deletedCount =  entityManager.createQuery("DELETE FROM Yxxxuq1m1xwwqqqxxxxxclobdata a WHERE a.zzxxu2oxxhxxxxxxxxxxowner2 = :p").setParameter("p", "SYSTEM").executeUpdate();
      deletedCount =  entityManager.createQuery("DELETE FROM Yxxxuq1n1xwwqqqxxxxxblobdata a WHERE a.zzxxu2oxxhxxxxxxxxxxowner2 = :p").setParameter("p", "SYSTEM").executeUpdate();
	if (yxxxuq1m1xwwqqqxxxxxclobdata == null) {
	    yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataHome.getInstance();
	}
	if (yxxxuq1n1xwwqqqxxxxxblobdata == null) {
	    yxxxuq1n1xwwqqqxxxxxblobdata=yxxxuq1n1xwwqqqxxxxxblobdataHome.getInstance();
	}

      //rtemplate top-left
      // pictures and txts are saved as sequences starting at 0 but seq 0 for -C (actual) is extra because
      // its content gets overwritten
      // so initially seq 0 and 1 will be the same picture and seq 2 and up holds different pictures 
      // for each seq the picture will be saved under XX-C as well as under XX-M ie actual and for mockup
      // Please note that sequences are used for slide show in certain context


      bcontinue=true;
      owner2Code="";
      // resource ie message entries not done yet
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_ERROR,bundle.getString("copy")+" "+bundle.getString("images")+" "+bundle.getString("set")+"1"+" "+bundle.getString("done"),""));
  
	 return "copy Images set 1 done";
     }

     public String copyDefaultsToSYSTEM_2() {
      // pictures and txts are saved as sequences starting at 0 but seq 0 for -C (actual) is extra because
      // its content gets overwritten
      // so initially seq 0 and 1 will be the same picture and seq 2 and up holds different pictures 
      // for each seq the picture will be saved under XX-C as well as under XX-M ie actual and for mockup
      // Please note that sequences are used for slide show in certain context
      //mid-top
	if (yxxxuq1m1xwwqqqxxxxxclobdata == null) {
	    yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataHome.getInstance();
	}
	if (yxxxuq1n1xwwqqqxxxxxblobdata == null) {
	    yxxxuq1n1xwwqqqxxxxxblobdata=yxxxuq1n1xwwqqqxxxxxblobdataHome.getInstance();
	}
  







      bcontinue=true;
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("copy")+" "+bundle.getString("images")+" "+bundle.getString("part2")+" "+bundle.getString("done"),""));

	 return "copy Images set 2 done";
     }

     public String backUpPublishToUSER(String jowner,String themeName) {
      /**
      *@param 1 owner ie theme supplier/vendor code,@param2 theme name both ignored
      */
      // put mockups for clob header and texts
      // add more sequences similar to images
      // record to record copy ie theme -M to client -M since preview shows -M and -C if no -M content
      // get all clob data for a theme, then loop and copy each
      // note in theme gallery, images are part of clob using url, no blob data directly used 
      // need to take care of fading images so include 3R-TOP-BKGR-X as clob and blob 
      // backup will have key xx-M, theme name -B and owner2 as owner2Code not SYSTEM like other themes because backups are not shared 
      int index=0;
      String jjowner="";
       try {
            List<Yxxxuq1m1xwwqqqxxxxxclobdata> results=null;
               results = entityManager
        	.createQuery(
			"select cc from Yxxxuq1m1xwwqqqxxxxxclobdata cc where cc.a0xxukcdlvxxxxxxxxxxfromtable=:clobdatafromtable and cc.a1xxuxxxbv49xxxxxxxxfromkey like '%-C' and cc.a2xxuxxxbv50xxxxxxxxqualifier=:qualifier and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
		           .setParameter("clobdatafromtable", "clobdata").setParameter("qualifier", "TXT")
                            .setParameter("owner2", owner2Code).getResultList();
		          if(!results.isEmpty()){
                           index = 0;
                           for (Yxxxuq1m1xwwqqqxxxxxclobdata itemChecked : results) {
                            //for each itemChecked (owner2Code),get or create corresponding client clob -M user record with qualifier -B and replace the data part
                            if(jowner.equals("ignored")){
                             yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataList.getclobDataInstance("clobdata","A"+itemChecked.getA1xxuxxxbv49xxxxxxxxfromkey(),"-B",0);
                             jjowner=owner2Code;
                            }else{
                             owner2Code=jowner;
                             jjowner=jowner;
                             yxxxuq1m1xwwqqqxxxxxclobdata=null;
                            }

                            //check update or persist client -M with qualifier -B  added clearInstance()
                            if(yxxxuq1m1xwwqqqxxxxxclobdata == null){
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.clearInstance();
                             yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataHome.getInstance();
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA0xxukcdlvxxxxxxxxxxfromtable("clobdata"); // persist not query removed prefix
                             //yxxxuq1m1xwwqqqxxxxxclobdata.setA1xxuxxxbv49xxxxxxxxfromkey("A"+itemChecked.getA1xxuxxxbv49xxxxxxxxfromkey());
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA1xxuxxxbv49xxxxxxxxfromkey(itemChecked.getA1xxuxxxbv49xxxxxxxxfromkey());
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA2xxuxxxbv50xxxxxxxxqualifier("-B");
                             yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(itemChecked.getB1xxuzaxbvxxxxxxxxxxdata());
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA3xxexnsbvxxxxxxxxxxsequence(0);
                             yxxxuq1m1xwwqqqxxxxxclobdata.setZzxxu2oxxhxxxxxxxxxxowner2(jjowner);
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.setInstance(yxxxuq1m1xwwqqqxxxxxclobdata);
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.persist(jjowner);//clob/blob persist does not give msg
                            }else{
                             yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(itemChecked.getB1xxuzaxbvxxxxxxxxxxdata());
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.setInstance(yxxxuq1m1xwwqqqxxxxxclobdata);
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.superUpdate();
                            }
                            index++;
                            yxxxuq1m1xwwqqqxxxxxclobdataHome.clearInstance();
                           }
                          }else{
                           //FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     //FacesMessage.SEVERITY_INFO,bundle.getString("text")+" "+bundle.getString("data")+" "+bundle.getString("list")+" "+bundle.getString("empty"),""));
                           log.info(bundle.getString("text")+" "+bundle.getString("data")+" "+bundle.getString("list")+" "+bundle.getString("empty"));

                           upLoadPurpose="ad";

                          }
       } catch (NoResultException nre) {
                            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("no")+" "+bundle.getString("theme")+" "+bundle.getString("data")+" "+bundle.getString("for")+" "+themeName,""));

                            return null;
       } catch (Exception e) {
			      log.severe("Error persisting clob"+ e);
                            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("clob")+" "+bundle.getString("save")+" "+bundle.getString("error")+" "+ e.getMessage(),""));

                      return null;
       }


         //FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          //FacesMessage.SEVERITY_INFO,bundle.getString("copied")+" "+index+" "+bundle.getString("records"),""));
          log.info(bundle.getString("copied")+" "+index+" "+bundle.getString("records"));
	 return "copy Images-Texts set1 done";
     }



     public String copyThemeToUSER(String jowner,String themeName) {
      /**
      * called from homePageEditor,homeOtherPagesEditor but can come from any page like register
      *@param 1 owner ie theme supplier/vendor code (ignored") or client site name ,@param2 theme name
      */
      // put mockups for clob header and texts
      // add more sequences similar to images
      //record to record copy ie theme -M to client -M since preview shows -M and -C if no -M content
      // get all clob data for a theme, then loop and copy each
      // note in theme gallery, images are part of clob using url, no blob data directly used 
      // need to take care of fading images so include 3R-TOP-BKGR-X as clob and blob 
      // backup will have key xx-M, theme name -B and owner2 as owner2Code not SYSTEM like other themes because backups are not shared 
      int index=0;
      String jjowner="";

       try {
            List<Yxxxuq1m1xwwqqqxxxxxclobdata> results=null;
            if(themeName.equals("-B")){
               results = entityManager
        	.createQuery(
			"select cc from Yxxxuq1m1xwwqqqxxxxxclobdata cc where cc.a0xxukcdlvxxxxxxxxxxfromtable=:clobdatafromtable and cc.a2xxuxxxbv50xxxxxxxxqualifier=:qualifier and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
		           .setParameter("clobdatafromtable", "clobdata").setParameter("qualifier", themeName)
                            .setParameter("owner2", owner2Code).getResultList();
            }else{
               results = entityManager
        	.createQuery(
			"select cc from Yxxxuq1m1xwwqqqxxxxxclobdata cc where cc.a0xxukcdlvxxxxxxxxxxfromtable=:clobdatafromtable and cc.a2xxuxxxbv50xxxxxxxxqualifier=:qualifier and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
		           .setParameter("clobdatafromtable", "clobdata").setParameter("qualifier", themeName)
                            .setParameter("owner2", "SYSTEM").getResultList();
            }
		          if(!results.isEmpty()){
                           index = 0;
                           for (Yxxxuq1m1xwwqqqxxxxxclobdata itemChecked : results) {
                            //for each itemChecked (SYSTEM),get or create corresponding client clob -M user record and replace the data part
                            if(jowner.equals("ignored")){
                             yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataList.getclobDataInstance("clobdata","A"+itemChecked.getA1xxuxxxbv49xxxxxxxxfromkey(),"TXT",0);
                             jjowner=owner2Code;
                            }else{
                             owner2Code=jowner;
                             jjowner=jowner;
                             yxxxuq1m1xwwqqqxxxxxclobdata=null;
                            }
                            //check update or persist client -M , for new client clobdata is null but for copytheme
                            // it can be either null or some value
                            if(yxxxuq1m1xwwqqqxxxxxclobdata == null){
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.clearInstance();
                             yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataHome.getInstance();
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA0xxukcdlvxxxxxxxxxxfromtable("clobdata"); 
                             //  going for persist, not query so dont append prefix
                             //yxxxuq1m1xwwqqqxxxxxclobdata.setA1xxuxxxbv49xxxxxxxxfromkey(itemChecked.getA1xxuxxxbv49xxxxxxxxfromkey());
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA1xxuxxxbv49xxxxxxxxfromkey(itemChecked.getA1xxuxxxbv49xxxxxxxxfromkey());
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA2xxuxxxbv50xxxxxxxxqualifier("TXT");
                             yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(itemChecked.getB1xxuzaxbvxxxxxxxxxxdata());
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA3xxexnsbvxxxxxxxxxxsequence(0);
                             yxxxuq1m1xwwqqqxxxxxclobdata.setZzxxu2oxxhxxxxxxxxxxowner2(jjowner);
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.setInstance(yxxxuq1m1xwwqqqxxxxxclobdata);
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.persist(jjowner);//clob/blob persist does not give msg
                            }else{
                             yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(itemChecked.getB1xxuzaxbvxxxxxxxxxxdata());
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.setInstance(yxxxuq1m1xwwqqqxxxxxclobdata);
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.superUpdate();
                            }
                            index++;
                            yxxxuq1m1xwwqqqxxxxxclobdataHome.clearInstance();
                           }
                          }else{
                           //FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                            //FacesMessage.SEVERITY_INFO,bundle.getString("text")+" "+bundle.getString("data")+" "+bundle.getString("list")+" "+bundle.getString("empty"),""));
                           log.info(bundle.getString("text")+" "+bundle.getString("data")+" "+bundle.getString("list")+" "+bundle.getString("empty"));

                           upLoadPurpose="ad";

                          }
        //if (customIdentity.isDebug()){ need to give feedback
         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          FacesMessage.SEVERITY_INFO,bundle.getString("copied")+" "+index+" "+bundle.getString("records"),""));
        //}
         if(urlName.contains("homePageEditor.")){    
          String jay="/homePageEditor.wflow#home_all";
          externalContext = facesContext.getCurrentInstance().getExternalContext();
          externalContext.redirect(jay);// use new externalContext to avoid response committed
         }
          // may also come from register, so check view
         return "";


       } catch (NoResultException nre) {
          FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
           FacesMessage.SEVERITY_INFO,bundle.getString("no")+" "+bundle.getString("theme")+" "+bundle.getString("data")+" "+bundle.getString("for")+" "+themeName,""));

                            return null;
       } catch (Exception e) {
         log.severe("Error persisting clob"+ e);
         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          FacesMessage.SEVERITY_INFO,bundle.getString("clob")+" "+bundle.getString("save")+" "+bundle.getString("error")+" "+ e.getMessage(),""));

          return null;
       }


     }

     public String publishThemeToUSER(String jowner,String themeName) {
      /**
      *@param 1 owner ie theme supplier/vendor code,@param2 theme name, both ignored unless theme is -B ie last backup
      */
      // put mockups for clob header and texts
      // add more sequences similar to images
      // record to record copy ie client -M to client -C since preview shows -M and -C if no -M content
      // get all clob data for a theme, then loop and copy each
      // note in theme gallery, images are part of clob using url, no blob data directly used 
      int index=0;
      String jjowner="";

       try {
            List<Yxxxuq1m1xwwqqqxxxxxclobdata> results=null;
            if(themeName.equals("-B")){
               results = entityManager
        	.createQuery(
			"select cc from Yxxxuq1m1xwwqqqxxxxxclobdata cc where cc.a0xxukcdlvxxxxxxxxxxfromtable=:clobdatafromtable and cc.a2xxuxxxbv50xxxxxxxxqualifier=:qualifier and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
		           .setParameter("clobdatafromtable", "clobdata").setParameter("qualifier", themeName)
                            .setParameter("owner2", owner2Code).getResultList();
            }else{
               if(jowner.equals("ignored")){
               }else{
                owner2Code=jowner;// new site -M already exists
               }

               results = entityManager
        	.createQuery(
			"select cc from Yxxxuq1m1xwwqqqxxxxxclobdata cc where cc.a0xxukcdlvxxxxxxxxxxfromtable=:clobdatafromtable and cc.a2xxuxxxbv50xxxxxxxxqualifier=:qualifier and cc.a1xxuxxxbv49xxxxxxxxfromkey like concat('%','-M','%') and cc.a3xxexnsbvxxxxxxxxxxsequence = 0 and cc.zzxxu2oxxhxxxxxxxxxxowner2 = :owner2 order by cc.a0xxuobxbxxxxxxxxxxxsid asc")
		           .setParameter("clobdatafromtable", "clobdata").setParameter("qualifier", "TXT")
                            .setParameter("owner2", owner2Code).getResultList();
            }
		          if(!results.isEmpty()){
                           index = 0;
                           for (Yxxxuq1m1xwwqqqxxxxxclobdata itemChecked : results) {
                            //for each itemChecked (-M),get or create corresponding client clob -C user record and replace the data part
                            String mKey="A"+itemChecked.getA1xxuxxxbv49xxxxxxxxfromkey(); 
                            String mKeyNoPrefix=itemChecked.getA1xxuxxxbv49xxxxxxxxfromkey(); 
                            if(jowner.equals("ignored")){
                             yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataList.getclobDataInstance("clobdata",mKey.substring(0,mKey.length()-1)+"C","TXT",0);
                             jjowner=owner2Code;
                            }else{
                             owner2Code=jowner;
                             jjowner=jowner;
                             yxxxuq1m1xwwqqqxxxxxclobdata=null;// new site -C does not exist
                            }
                            //check update or persist client -C
                            if(yxxxuq1m1xwwqqqxxxxxclobdata == null){
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.clearInstance();
                             yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataHome.getInstance();
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA0xxukcdlvxxxxxxxxxxfromtable("clobdata"); 
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA1xxuxxxbv49xxxxxxxxfromkey(mKeyNoPrefix.substring(0,mKeyNoPrefix.length()-1)+"C");
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA2xxuxxxbv50xxxxxxxxqualifier("TXT");
                             yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(itemChecked.getB1xxuzaxbvxxxxxxxxxxdata());
                             yxxxuq1m1xwwqqqxxxxxclobdata.setA3xxexnsbvxxxxxxxxxxsequence(0);
                             yxxxuq1m1xwwqqqxxxxxclobdata.setZzxxu2oxxhxxxxxxxxxxowner2(jjowner);
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.setInstance(yxxxuq1m1xwwqqqxxxxxclobdata);
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.persist(jjowner);//clob/blob persist does not give msg
                            }else{
                             yxxxuq1m1xwwqqqxxxxxclobdata.setB1xxuzaxbvxxxxxxxxxxdata(itemChecked.getB1xxuzaxbvxxxxxxxxxxdata());
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.setInstance(yxxxuq1m1xwwqqqxxxxxclobdata);
                             yxxxuq1m1xwwqqqxxxxxclobdataHome.superUpdate();
                            }
                            index++;
                            yxxxuq1m1xwwqqqxxxxxclobdataHome.clearInstance();
                           }
                          }else{
                           //FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                            //         FacesMessage.SEVERITY_INFO,bundle.getString("text")+" "+bundle.getString("data")+" "+bundle.getString("list")+" "+bundle.getString("empty"),""));
                           log.info(bundle.getString("text")+" "+bundle.getString("data")+" "+bundle.getString("list")+" "+bundle.getString("empty"));

                           upLoadPurpose="ad";

                          }
       } catch (NoResultException nre) {
                            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("no")+" "+bundle.getString("theme")+" "+bundle.getString("data")+" "+bundle.getString("for")+" "+themeName,""));

                            return null;
       } catch (Exception e) {
			      log.severe("Error persisting clob"+ e);
                            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("clob")+" "+bundle.getString("save")+" "+bundle.getString("error")+" "+ e.getMessage(),""));

                      return null;
       }


        if (customIdentity.isDebug()){
         FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
          FacesMessage.SEVERITY_INFO,bundle.getString("copied")+" "+index+" "+bundle.getString("records"),""));
        }
	 return "copy Images-Texts set1 done";
     }


      /**
      * called by both r3rest shopify backoffice create and by raaspi siteCreate or fatjar > Authenticator.java > doMasterSite
      *important-owner2Code within the scope of this method is used for persist and should be owner2Code client
      * not raaspi. 
      *@param 6 params, theme vendor,theme Name, jowner owner2CodeClient ie site name,2 client Name ie company,
      * site contact email, client App function prod+subProd like eerb
      */
     public String copyDefaultsToUSER(String vendor,String themeName,String jowner,String clName,String clEmail,String clSiteTheme) {
      // we may have to pass theme item key and vendor to this method
      //called by restclient quickRegister,doMasterSite and doregister siteTheme is interpreted from applicationfunction/usage 2ch usage and 2ch type of usage
      //Menu related Graphics and Texts like Product, News and also Pop Ups which are different for each user
      // added messages based on prod code like service, org etc which are different from default system messages
      // pictures and txts are saved as say 3R-TOP-LEFT-M and 3R-TOP-LEFT-C and sequence can be 0 to 4
      // 
      // so seq 1 and up holds different pictures and initially seq 0 and 1 will be the same picture or text
      // for each seq the picture/text will be saved under XX-C as well as under XX-M ie actual and for mockup
      // Please note that sequences are used for slide show in certain context
      //  added logic to select images and rext based on theme chosen during site create
      // selecting agency can now select insurance,travel,
        owner2Code=jowner;
	if (yxxxuq1m1xwwqqqxxxxxclobdata == null) {
	    yxxxuq1m1xwwqqqxxxxxclobdata=yxxxuq1m1xwwqqqxxxxxclobdataHome.getInstance();
	}
	if (yxxxuq1n1xwwqqqxxxxxblobdata == null) {
	    yxxxuq1n1xwwqqqxxxxxblobdata=yxxxuq1n1xwwqqqxxxxxblobdataHome.getInstance();
	}
        // came from r3restclient?
        if(clSiteTheme.equals("eest")){
         yxxxuh566xwwqqwxxxxxuserHome.setClientApplicationFunction("eest");
        }
      try{
       // in new design no blobs involved as html pages loaded from clobs can have both images(via imageServlet) and text, owner2Code has client site code
       // Note: the actual image data is still an image in a file or as binary data in blob data and is loaded via imageServlet
       // copy theme clobs to new client xxx-M clobs. themeName is unique across vendors, we can ignore vendor code
       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
        FacesMessage.SEVERITY_INFO,bundle.getString("copy")+" "+bundle.getString("site")+" "+bundle.getString("content")+" "+bundle.getString("images")+" / "+bundle.getString("text")+" "+bundle.getString("started"),""));
       //clobdata fromkey has key to section of the html page ex 3R-MID-TOP-M and qualifier has themeName ex Nature/Gene7.023544634959 
       yxxxuq1n1xwwqqqxxxxxblobdataHome.copyThemeToUSER(jowner,themeName);

       // copy theme clobs to new client xxx-C clobs by iterating over the clob records for a theme
       yxxxuq1n1xwwqqqxxxxxblobdataHome.publishThemeToUSER(jowner,themeName);

       // copy new site -C clobs to -B clobs
       yxxxuq1n1xwwqqqxxxxxblobdataHome.backUpPublishToUSER(jowner,themeName);

      } catch (Exception e) {
       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
        FacesMessage.SEVERITY_INFO,bundle.getString("theme")+" "+bundle.getString("copy")+" "+bundle.getString("failed")+" "+e.getMessage(),""));
       FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
        FacesMessage.SEVERITY_INFO,bundle.getString("but")+", "+bundle.getString("you")+" "+bundle.getString("can")+" "+bundle.getString("copy")+" "+bundle.getString("theme")+" "+bundle.getString("later"),""));
      }
      bcontinue=true;
      // need to check where the req is coming from 
      FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
       FacesMessage.SEVERITY_INFO,bundle.getString("copy")+" "+bundle.getString("site")+" "+bundle.getString("content")+" "+bundle.getString("images")+" / "+bundle.getString("text")+" "+bundle.getString("done"),""));

	 return "copy Images-Texts set1 done";
     }


















/**
*  cartpersist can be used where detail items are iterated over as in shopping cart or back office order processing for one or more items
*  this method is called for one item at a time
*  it has 3 flavours- o if a new item is added, u if existing item is removed , c if some change like qty for any of the items
*  o a new item is added
*    Po null means say a new order as well
*    Po not null means a new item for say an existing order
*  u existing item removed from say order
*  c change existing item from say order or invoice ...
*   call update
*    updatecdetailsetValues
*    showrunt recalcultes and updates variables
*    persistrunt copies the variable values into instance property values
*    superdotupdate to persist
*see R3RestClient SyncDataOrders 
*
*/
    Integer currentDetailLine=0;

    public String cartpersist(Integer cpoId,String cposts,Integer currentCount, BigDecimal quantity) {
       return "persisted";
    }








    public EntityManager getEntityManager()
    {
        //return emf.createEntityManager();
        return entityManager;
    }


    public String createValueExpression(String st){
     return st;
    }
    
    public void setId(Integer id){
      this.id=id;
    }
    public Integer getId(){
     //if(id==null){
      //id=0;// avoid null exception in edit viewparam, null is needed if new entity
     //}
     return id;
    }
    public Yxxxuq1n1xwwqqqxxxxxblobdata getInstance(){
        if (instance == null) {
            if (id == null) {
                return createInstance();
            }
            else {
                instance=entityManager.find(Yxxxuq1n1xwwqqqxxxxxblobdata.class,id);
                return instance;
            }
        }
        else {
            return instance;
        }
   }

   /**
    * Set/change the entity being managed.
    */
   public void setInstance(Yxxxuq1n1xwwqqqxxxxxblobdata instance)
   {
      ///setDirty(this.instance, instance);
      this.instance = instance;
   }
   /**
    * Clear the managed entity (and id), allowing the {@link EntityHome} to be
    * reused.
    */
   public void clearInstance()
   {
      setInstance(null);
      setId(null);
   }
   /**
    * Load the instance if the id is defined otherwise create a new instance
    * <br />
    * Utility method called by {@link #getInstance()} to load the instance from 
    * the Persistence Context if the id is defined. Otherwise a new instance is 
    * created.
    * 
    * @see "#find()"
    * @see "#createInstance() at top of this source"
    */
   protected void initInstance()
   {
      if ( isIdDefined() )
      {
         if ( !isTransactionMarkedRollback() )
         {
            //we cache the instance so that it does not "disappear"
            //after remove() is called on the instance
            //is this really a Good Idea??
            //setInstance( find() );
            setInstance(null);
         }
      }
      else
      {
         setInstance( createInstance() );
      }
   }
   public boolean isTransactionMarkedRollback(){
    return false;
   }
   /**
    * Flush any changes made to the managed entity instance to the underlying
    * database. 
    * <br />
    * If the update is successful, a log message is printed, a 
    * {@link javax.faces.application.FacesMessage} is added and a transaction 
    * success event raised.
    * 
    * @see "Home#updatedMessage()"
    * @see "Home#raiseAfterTransactionSuccessEvent()"
    * 
    * @return "updated" if the update is successful
    */
   @Transactional
   public String superdotupdate()
   {
      ///joinTransaction();
      ///getEntityManager().flush();
      ///updatedMessage();
      ///raiseAfterTransactionSuccessEvent();
           // if SH or EH then log changes (except editlog changes) to Xxxxch82bxhhhhhxxxxxeditlog  
           if(customIdentity.hasRole("SH") ||customIdentity.hasRole("EH")){
            xxxxch82bxhhhhhxxxxxeditlogHome.clearInstance();
            xxxxch82bxhhhhhxxxxxeditlog=xxxxch82bxhhhhhxxxxxeditlogHome.getInstance();
            xxxxch82bxhhhhhxxxxxeditlog.setA0xxukxxbvxxxxxxxxxxdatabasenm("Blobdata");
            xxxxch82bxhhhhhxxxxxeditlog.setZ1xxzxxrbvxxxxxxxxxxrecordno(this.instance.getA0xxuobxbxxxxxxxxxxxsid());
            xxxxch82bxhhhhhxxxxxeditlog.setZexxcxxrlxxxxxxxxxxxnewdate(Calendar.getInstance().getTime());
            xxxxch82bxhhhhhxxxxxeditlogHome.superdotupdate();
            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
             FacesMessage.SEVERITY_WARN,bundle.getString("Blobdata")+" "+bundle.getString("updated")+" "+bundle.getString("and")+", "+bundle.getString("logged")+" "+bundle.getString("in")+" "+bundle.getString("editlog"),""));
            FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
             FacesMessage.SEVERITY_WARN,bundle.getString("Remember")+", "+bundle.getString("journal")+" "+bundle.getString("entries")+" "+bundle.getString("created")+", "+bundle.getString("need")+" "+bundle.getString("to")+" "+bundle.getString("be")+" "+bundle.getString("deleted"),""));
           }
      this.instance=entityManager.merge(this.instance);
      ///id=this.instance.getA0xxuobxbxxxxxxxxxxxsid();
      /// why ? jpa merge should be ok entityManager.persist(this.instance);
      return "updated";
   }

   /**
    * Persist unmanaged entity instance to the underlying database. 
    * If the persist is successful, a log message is printed, a 
    * {@link javax.faces.application.FacesMessage } is added and a transaction 
    * success event raised.
    * 
    * @see "Home#createdMessage()"
    * @see "Home#raiseAfterTransactionSuccessEvent()"
    * 
    * @return "persisted" if the persist is successful
    */
   @Transactional
   public String superdotpersist()
   {
      ///getEntityManager().persist( getInstance() );
      ///getEntityManager().flush();
      ///assignId( PersistenceProvider.instance().getId( getInstance(), getEntityManager() ) );
      ///createdMessage();
      ///raiseAfterTransactionSuccessEvent();
      //added sanitize if clob data
      //duplicatexxxExists should be called, as needed, before calling this method to avoid duplicate keys     
      entityManager.persist(this.instance);
      id=this.instance.getA0xxuobxbxxxxxxxxxxxsid();
      return "persisted";
   }
   
   /**
    * Remove managed entity instance from the Persistence Context and the 
    * underlying database.
    * If the remove is successful, a log message is printed, a 
    * {@link javax.faces.application.FacesMessage} is added and a transaction 
    * success event raised.
    * 
    * @see "Home#deletedMessage()"
    * @see "Home#raiseAfterTransactionSuccessEvent()"
    * 
    * @return "removed" if the remove is successful
    */
   @Transactional
   public String superdotremove()
   {
      ///getEntityManager().remove( getInstance() );
      ///getEntityManager().flush();
      ///deletedMessage();
      ///raiseAfterTransactionSuccessEvent();
     try{
      this.instance=entityManager.merge(this.instance);
      id=this.instance.getA0xxuobxbxxxxxxxxxxxsid();
      entityManager.remove(this.instance);
      // to catch runtime integrity violation exception, flush does immediate remove
      entityManager.flush();
      id=null;
     } catch ( Exception e){
          FacesContext.getCurrentInstance().addMessage(null,new FacesMessage(
                                     FacesMessage.SEVERITY_INFO,bundle.getString("delete")+" "+ bundle.getString("error")+" "+e.getMessage(),""));
           bcontinue=false;
           return null;
     }

      return "removed";
   }
   /**
    * Returns true if the entity instance is managed
    */
   @Transactional
   public boolean isManaged()
   {
     /// return getInstance()!=null && 
     ///       getEntityManager().contains( getInstance() );
     return id != null;
   }

   /**
    * Invokes this action method via f:viewaction entry on a page, replaces seam pages.xml action 
    * called by web pages like login.xhtml, checkout, unsc etc, which in turns are invoked via activation link entries
    * in emails .
    * there is a takeAction method in r3cart bean(shopping cart ) to take care of checkout.xhtml viewAction
    * viewId is checked to pick the submethod and request parameters are  used to call appropriate action method. 
    * no method parameter but url parameters are used 
    * no exception caught here .
    * 
    * @return "null" 
    */
   public String takeAction(){
    // all pages invoke this method and there can be error pages when rq can be null
    if(req==null){
     return null;
    }

    String viewId = facesContext.getViewRoot().getViewId();
/*
    if (viewId.contains("shoauthverify.")){
     if (req.getParameter("hmac") != null ){
      r3RestClient.shoauthverify(req.getParameter("code"),req.getParameter("hmac"),req.getParameter("shop"),req.getParameter("state"),req.getParameter("timestamp"));
     }
    }
    if (viewId.contains("shwebhook.")){
     if (req.getParameter("hmac") != null ){
      r3RestClient.shoauthverify(req.getParameter("code"),req.getParameter("hmac"),req.getParameter("shop"),req.getParameter("state"),req.getParameter("timestamp"));
     }
*/
     return null;
    }



   
    /**
    * The following method puts restrictions on bean access on top of menu render protection or url entered outside menue
    * @param none
    * @return none or error page
    * @exception none
    * @see 
    *  added logic to allow public schedule as calendar
    */ 
   public String restrict(){

    if (!identity.isLoggedIn()) {
     return "error.xhtml?faces-redirect=true";
    }
    String r2=customIdentity.getRestrict2();//forces to refresh hibernate query cache, usefl for debug
    String a1=customIdentity.getAllow1();
    String viewId = facesContext.getViewRoot().getViewId();
    // jay add logic to make sure these are not null and saved as lower case in useredit
    if (!customIdentity.getRestrict2().isEmpty() && customIdentity.getRestrict2().equals("all")){
     if ((!customIdentity.getAllow1().isEmpty() && viewId.contains(customIdentity.getAllow1())) 
          || (!customIdentity.getAllow2().isEmpty() && viewId.contains(customIdentity.getAllow2())) || 
          (!customIdentity.getAllow3().isEmpty() && viewId.contains(customIdentity.getAllow3())) ){
          return null;
         }else{
          return "error.xhtml?faces-redirect=true";
         }
    }
    if ((!customIdentity.getRestrict2().isEmpty() && viewId.contains(customIdentity.getRestrict2()))
          || (!customIdentity.getRestrict3().isEmpty() && viewId.contains(customIdentity.getRestrict3())) ){
          return "error.xhtml?faces-redirect=true";
    }
    // admin
    if ((viewId.contains("userList") || viewId.contains("userEdit")) && customIdentity.hasRole("IH")){
     return null;
    } 
    if (viewId.contains("SqlAdmin")){
     if (customIdentity.hasRole("UH")){
      if ( (viewId.contains("SqlAdmin.") && customIdentity.isMasterSite()) || viewId.contains("SqlAdmin-") ){
      /* if ((viewId.contains("SqlAdmin.") && ((req.getServerName().contains("raaspi.com") && !req.getServerName().contains(".raaspi.com") && !req.getServerName().contains(".lraaspi.com"))
                  || req.getServerName().contains(masterSiteCode)
                  ||  (req.getServerName().contains("www.raaspi.com") ||  req.getServerName().contains("raaspi.lraaspi.com")))) || viewId.contains("SqlAdmin-")){
      */   
    return null;
      }else{
       return "error.xhtml?faces-redirect=true";
      }
     }else{
      return "error.xhtml?faces-redirect=true";
     }
    }
    //quikfix later change clobdataentity name to use f instead of u
    if (viewId.contains("clobdataEdit") || viewId.contains("homeThemePreview")){
     if ((req.getServerName().startsWith("myflow") || req.getServerName().contains(masterSiteCode)) && (customIdentity.hasRole("PH") 
         || customIdentity.hasRole("UH") || customIdentity.hasRole("UQ"))) {
         return null;
     }else{
      if ((customIdentity.getProduct().equals("f") && customIdentity.getSubProduct().equals("s")) && (customIdentity.hasRole("PH") 
        || customIdentity.hasRole("VH") || customIdentity.hasRole("UH") || customIdentity.hasRole("UQ"))) {
         return null;
      }else{
        if ( customIdentity.hasRole("UH") || customIdentity.hasRole("UQ") ) {
         return null;
        }
      }
     }
     return "error.xhtml?faces-redirect=true";
    }
    // check for xxxedit. to avoid checking for editEasy
    // allow PH to delete/edit but own records, existing logic checks for own records unless UH
    if (viewId.contains("blobdataEdit.") ){
      if ((customIdentity.getProduct().equals("f") && customIdentity.getSubProduct().equals("s")) && (customIdentity.hasRole("PH") 
         || customIdentity.hasRole("VH") || customIdentity.hasRole("UH") || customIdentity.hasRole("UQ"))) {
         return null;
      }else{
        if ( customIdentity.hasRole("UH") || customIdentity.hasRole("UQ") || customIdentity.hasRole("PH")) {
         return null;
        }
      }
     return "error.xhtml?faces-redirect=true";
    }


    if (viewId.contains("blobdataEditEasy") ){
     //test for raaspi site, EditEasy does not allow edit/delete only in above edit 
     // check if master site, a subdomain serverName can also include master site name 
     if( customIdentity.isMasterSite() 
           && (customIdentity.hasRole("PH") || customIdentity.hasRole("UH") || customIdentity.hasRole("UQ")) ) {
         return null;
     }
     return "error.xhtml?faces-redirect=true";
    }
    // this overides menue Role/level only if url is directly typed in, since menue will not show if role/level wrong

    if ((!customIdentity.getAllow1().isEmpty() && viewId.contains(customIdentity.getAllow1())) 
          || (!customIdentity.getAllow2().isEmpty() && viewId.contains(customIdentity.getAllow2())) || 
          (!customIdentity.getAllow3().isEmpty() && viewId.contains(customIdentity.getAllow3())) ){
          return null;
    }
    // this overides menue Role/level only if url is directly typed in, since menue will not show if role/level wrong

    if ((!customIdentity.getAllow1().isEmpty() && viewId.contains(customIdentity.getAllow1())) 
          || (!customIdentity.getAllow2().isEmpty() && viewId.contains(customIdentity.getAllow2())) || 
          (!customIdentity.getAllow3().isEmpty() && viewId.contains(customIdentity.getAllow3())) ){
          return null;
    }

    //this checks menue rules to render or not
                             if(!((customIdentity.hasRole("UH")||customIdentity.hasRole("UQ") ) )){
                              return "error.xhtml?faces-redirect=true";
                             }else{
                              return null;
                             }
   }


}




